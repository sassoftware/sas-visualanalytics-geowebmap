{"version":3,"sources":["../node_modules/@arcgis/core/layers/support/ElevationTile.js","../node_modules/@arcgis/core/layers/support/ElevationQuery.js"],"names":["e","a","this","tile","t","extent","samplerData","pixelData","values","width","height","safeWidth","noDataValue","dx","dy","x0","y1","s","h","l","o","r","n","d","u","f","i","c","p","Math","floor","x","D","m","w","y","V","g","v","ignoreInvisibleLayers","filter","visible","slice","length","fromGeometry","returnSampleInfo","R","query","_queryAllContinue","geometry","export","sampleInfo","type","spatialReference","signal","load","_createGeometryDescriptor","_selectTiles","_populateElevationTiles","_sampleGeometryWithElevation","_createQueryResult","_createSampler","_createSamplerAllContinue","tileInfo","equals","source","dest","_","elevationTiles","layer","options","pop","samplers","map","concat","coordinates","demResolution","push","clone","forEach","z","project","outSpatialReference","_extractSampleInfo","elevationTile","wkid","_preselectOutsideLayerExtent","_selectTilesClosestResolution","_selectTilesFinestContiguous","_selectTilesAuto","T","sample","outsideExtentTile","fullExtent","xmin","xmax","ymin","ymax","_findNearestDemResolutionLODIndex","selectTilesAtLOD","lods","abs","resolution","E","minDemResolution","_selectTilesFinestContiguousAt","tilemapCache","getTilesToFetch","Promise","all","fetchAvailability","level","row","col","allElevationTilesFetched","clearElevationTiles","cache","uid","id","get","fetchTile","put","populateElevationTiles","_selectTilesAutoFinest","_reduceTilesForMaximumRequests","_selectTilesAutoPrefetchUpsample","fetchAvailabilityUpsample","ok","error","remapTiles","forEachTileToFetch","maximumAutoTileRequests","upsampleTile","lodAt","_exporter","_cloneCoordinate","points","hasZ","hasM","spatiaReference","paths","tileAt","some","candidateTiles","fetchedCandidates","Set","intersection","maskExtents","_maximumLodForRequests","min","_selectCandidateTilesCoveringExtentAt","size","ceil","clear","add","_uniqueNonOverlappingTiles","has","sort","updateTileInfo","_tileIsMasked","findIndex"],"mappings":"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","file":"static/js/16.89ae1437.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as t,isNone as a}from\"../../core/maybe.js\";class e{constructor(a,e=null){if(this.tile=a,t(e)){const t=a.extent;this.samplerData={pixelData:e.values,width:e.width,height:e.height,safeWidth:.99999999*(e.width-1),noDataValue:e.noDataValue,dx:(e.width-1)/(t[2]-t[0]),dy:(e.width-1)/(t[3]-t[1]),x0:t[0],y1:t[3]}}}sample(t,e){if(a(this.samplerData))return;const{safeWidth:s,width:h,pixelData:l,noDataValue:o,dx:r,dy:n,y1:d,x0:u}=this.samplerData,f=i(n*(d-e),0,s),c=i(r*(t-u),0,s),p=Math.floor(f),x=Math.floor(c),D=p*h+x,m=D+h,w=l[D],y=l[m],V=l[D+1],g=l[m+1];if(w!==o&&y!==o&&V!==o&&g!==o){const t=c-x,a=w+(V-w)*t;return a+(y+(g-y)*t-a)*(f-p)}}}function i(t,a,e){return t<a?a:t>e?e:t}export{e as ElevationTile,e as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{result as e}from\"../../core/asyncUtils.js\";import t from\"../../core/Error.js\";import{isSome as i,isNone as o}from\"../../core/maybe.js\";import{whenOrAbort as s,throwIfAbortError as l,eachAlways as n}from\"../../core/promiseUtils.js\";import{getMetersPerUnitForSR as a}from\"../../core/unitUtils.js\";import r from\"../../geometry/Multipoint.js\";import c from\"../../geometry/Point.js\";import u from\"../../geometry/Polyline.js\";import{initializeProjection as h,project as p}from\"../../geometry/projection.js\";import{fromExtent as m,create as f,contains as d}from\"../../geometry/support/aaBoundingRect.js\";import{MultiTileElevationSampler as y}from\"./ElevationSampler.js\";import{ElevationTile as T}from\"./ElevationTile.js\";class v{async queryAll(e,i,o){if(!(e=o&&o.ignoreInvisibleLayers?e.filter((e=>e.visible)):e.slice()).length)throw new t(\"elevation-query:invalid-layer\",\"Elevation queries require at least one elevation layer to fetch tiles from\");const s=x.fromGeometry(i);let l=!1;o&&o.returnSampleInfo||(l=!0);const n={...R,...o,returnSampleInfo:!0},a=await this.query(e[e.length-1],s,n),r=await this._queryAllContinue(e,a,n);return r.geometry=r.geometry.export(),l&&delete r.sampleInfo,r}async query(e,i,o){if(!e)throw new t(\"elevation-query:invalid-layer\",\"Elevation queries require an elevation layer to fetch tiles from\");if(!i||!(i instanceof x)&&\"point\"!==i.type&&\"multipoint\"!==i.type&&\"polyline\"!==i.type)throw new t(\"elevation-query:invalid-geometry\",\"Only point, polyline and multipoint geometries can be used to query elevation\");const s={...R,...o},l=new w(e,i.spatialReference,s),n=s.signal;return await e.load({signal:n}),await this._createGeometryDescriptor(l,i,n),await this._selectTiles(l,n),await this._populateElevationTiles(l,n),this._sampleGeometryWithElevation(l),this._createQueryResult(l,n)}async createSampler(e,i,o){if(!e)throw new t(\"elevation-query:invalid-layer\",\"Elevation queries require an elevation layer to fetch tiles from\");if(!i||\"extent\"!==i.type)throw new t(\"elevation-query:invalid-extent\",\"Invalid or undefined extent\");const s={...R,...o};return this._createSampler(e,i,s)}async createSamplerAll(e,i,o){if(!(e=o&&o.ignoreInvisibleLayers?e.filter((e=>e.visible)):e.slice()).length)throw new t(\"elevation-query:invalid-layer\",\"Elevation queries require at least one elevation layer to fetch tiles from\");if(!i||\"extent\"!==i.type)throw new t(\"elevation-query:invalid-extent\",\"Invalid or undefined extent\");const s={...R,...o,returnSampleInfo:!0},l=await this._createSampler(e[e.length-1],i,s);return this._createSamplerAllContinue(e,i,l,s)}async _createSampler(e,t,i,o){const s=i.signal;await e.load({signal:s});const l=t.spatialReference,n=e.tileInfo.spatialReference;l.equals(n)||(await h([{source:l,dest:n}],{signal:s}),t=p(t,n));const a=new _(e,t,i,o);return await this._selectTiles(a,s),await this._populateElevationTiles(a,s),new y(a.elevationTiles,a.layer.tileInfo,a.options.noDataValue)}async _createSamplerAllContinue(e,t,i,o){if(e.pop(),!e.length)return i;const s=i.samplers.map((e=>m(e.extent))),l=await this._createSampler(e[e.length-1],t,o,s);if(0===l.samplers.length)return i;const n=i.samplers.concat(l.samplers),a=new y(n,o.noDataValue);return this._createSamplerAllContinue(e,t,a,o)}async _queryAllContinue(e,t,i){const o=e.pop(),s=t.geometry.coordinates,l=[],n=[];for(let c=0;c<s.length;c++){const i=t.sampleInfo[c];i.demResolution>=0?i.source||(i.source=o):e.length&&(l.push(s[c]),n.push(c))}if(!e.length||0===l.length)return t;const a=t.geometry.clone(l),r=await this.query(e[e.length-1],a,i);return n.forEach(((e,i)=>{s[e].z=r.geometry.coordinates[i].z,t.sampleInfo[e].demResolution=r.sampleInfo[i].demResolution})),this._queryAllContinue(e,t,i)}async _createQueryResult(e,t){const i={geometry:(await e.geometry.project(e.outSpatialReference,t)).export(),noDataValue:e.options.noDataValue};return e.options.returnSampleInfo&&(i.sampleInfo=this._extractSampleInfo(e)),e.geometry.coordinates.forEach((e=>{e.tile=null,e.elevationTile=null})),i}async _createGeometryDescriptor(e,i,o){let s;const l=e.layer.tileInfo.spatialReference;if(i instanceof x?s=await i.project(l,o):(await h([{source:i.spatialReference,dest:l}],{signal:o}),s=p(i,l)),!s)throw new t(\"elevation-query:spatial-reference-mismatch\",`Cannot query elevation in '${i.spatialReference.wkid}' on an elevation service in '${l.wkid}'`);e.geometry=x.fromGeometry(s)}async _selectTiles(e,i){const o=e.options.demResolution;if(\"geometry\"===e.type&&this._preselectOutsideLayerExtent(e),\"number\"==typeof o)this._selectTilesClosestResolution(e);else if(\"finest-contiguous\"===o)await this._selectTilesFinestContiguous(e,i);else{if(\"auto\"!==o)throw new t(\"elevation-query:invalid-dem-resolution\",`Invalid dem resolution value '${o}', expected a number, \"finest-contiguous\" or \"auto\"`);await this._selectTilesAuto(e,i)}}_preselectOutsideLayerExtent(e){const t=new T(null);t.sample=()=>e.options.noDataValue,e.outsideExtentTile=t;const i=e.layer.fullExtent;e.geometry.coordinates.forEach((e=>{const o=e.x,s=e.y;(o<i.xmin||o>i.xmax||s<i.ymin||s>i.ymax)&&(e.elevationTile=t)}))}_selectTilesClosestResolution(e){const t=e.layer.tileInfo,i=this._findNearestDemResolutionLODIndex(t,e.options.demResolution);e.selectTilesAtLOD(i)}_findNearestDemResolutionLODIndex(e,t){const i=t/a(e.spatialReference);let o=e.lods[0],s=0;for(let l=1;l<e.lods.length;l++){const t=e.lods[l];Math.abs(t.resolution-i)<Math.abs(o.resolution-i)&&(o=t,s=l)}return s}async _selectTilesFinestContiguous(e,t){const i=E(e.layer.tileInfo,e.options.minDemResolution);await this._selectTilesFinestContiguousAt(e,i,t)}async _selectTilesFinestContiguousAt(e,i,o){const n=e.layer;if(e.selectTilesAtLOD(i),i<0)return;const a=n.tilemapCache,r=e.getTilesToFetch();try{if(a)await s(Promise.all(r.map((e=>a.fetchAvailability(e.level,e.row,e.col,{signal:o})))),o);else if(await this._populateElevationTiles(e,o),!e.allElevationTilesFetched())throw e.clearElevationTiles(),new t(\"elevation-query:has-unavailable-tiles\")}catch(c){l(c),await this._selectTilesFinestContiguousAt(e,i-1,o)}}async _populateElevationTiles(e,t){const o=e.getTilesToFetch(),l={},a=e.options.cache,r=e.options.noDataValue,c=o.map((async o=>{const s=`${e.layer.uid}:${o.id}:${r}`,n=i(a)?a.get(s):null,c=i(n)?n:await e.layer.fetchTile(o.level,o.row,o.col,{noDataValue:r,signal:t});i(a)&&a.put(s,c),l[o.id]=new T(o,c)}));await s(n(c),t),e.populateElevationTiles(l)}async _selectTilesAuto(t,i){this._selectTilesAutoFinest(t),this._reduceTilesForMaximumRequests(t);const o=t.layer.tilemapCache;if(!o)return this._selectTilesAutoPrefetchUpsample(t,i);const n=t.getTilesToFetch(),a={},r=n.map((async t=>{const s={id:null,level:0,row:0,col:0,extent:f()},n=await e(o.fetchAvailabilityUpsample(t.level,t.row,t.col,s,{signal:i}));!1===n.ok?l(n.error):a[t.id]=s}));await s(Promise.all(r),i),t.remapTiles(a)}_reduceTilesForMaximumRequests(e){const t=e.layer.tileInfo;let i=0;const o={},s=e=>{e.id in o?o[e.id]++:(o[e.id]=1,i++)},l=e=>{const t=o[e.id];1===t?(delete o[e.id],i--):o[e.id]=t-1};e.forEachTileToFetch(s,l);let n=!0;for(;n&&(n=!1,e.forEachTileToFetch((o=>{i<=e.options.maximumAutoTileRequests||(l(o),t.upsampleTile(o)&&(n=!0),s(o))}),l),n););}_selectTilesAutoFinest(e){const t=E(e.layer.tileInfo,e.options.minDemResolution);e.selectTilesAtLOD(t,e.options.maximumAutoTileRequests)}async _selectTilesAutoPrefetchUpsample(e,t){const i=e.layer.tileInfo;await this._populateElevationTiles(e,t);let o=!1;e.forEachTileToFetch(((e,t)=>{i.upsampleTile(e)?o=!0:t()})),o&&await this._selectTilesAutoPrefetchUpsample(e,t)}_sampleGeometryWithElevation(e){e.geometry.coordinates.forEach((t=>{const o=t.elevationTile;let s=e.options.noDataValue;if(o){const e=o.sample(t.x,t.y);i(e)?s=e:t.elevationTile=null}t.z=s}))}_extractSampleInfo(e){const t=e.layer.tileInfo,i=a(t.spatialReference);return e.geometry.coordinates.map((o=>{let s=-1;if(o.elevationTile&&o.elevationTile!==e.outsideExtentTile){s=t.lodAt(o.elevationTile.tile.level).resolution*i}return{demResolution:s}}))}}class x{export(){return this._exporter(this.coordinates,this.spatialReference)}clone(e){const t=new x;return t.geometry=this.geometry,t.spatialReference=this.spatialReference,t.coordinates=e||this.coordinates.map((e=>this._cloneCoordinate(e))),t._exporter=this._exporter,t}async project(e,t){if(this.spatialReference.equals(e))return this.clone();await h([{source:this.spatialReference,dest:e}],{signal:t});const i=new r({spatialReference:this.spatialReference,points:this.coordinates.map((e=>[e.x,e.y]))}),o=p(i,e);if(!o)return null;const s=this.coordinates.map(((e,t)=>{const i=this._cloneCoordinate(e),s=o.points[t];return i.x=s[0],i.y=s[1],i})),l=this.clone(s);return l.spatialReference=e,l}_cloneCoordinate(e){return{x:e.x,y:e.y,z:e.z,m:e.m,tile:null,elevationTile:null}}static fromGeometry(e){const t=new x;if(t.geometry=e,t.spatialReference=e.spatialReference,e instanceof x)t.coordinates=e.coordinates.map((e=>t._cloneCoordinate(e))),t._exporter=(t,i)=>{const o=e.clone(t);return o.spatialReference=i,o};else switch(e.type){case\"point\":{const i=e,{hasZ:o,hasM:s}=i;t.coordinates=o&&s?[{x:i.x,y:i.y,z:i.z,m:i.m}]:o?[{x:i.x,y:i.y,z:i.z}]:s?[{x:i.x,y:i.y,m:i.m}]:[{x:i.x,y:i.y}],t._exporter=(t,i)=>e.hasM?new c(t[0].x,t[0].y,t[0].z,t[0].m,i):new c(t[0].x,t[0].y,t[0].z,i);break}case\"multipoint\":{const i=e,{hasZ:o,hasM:s}=i;t.coordinates=o&&s?i.points.map((e=>({x:e[0],y:e[1],z:e[2],m:e[3]}))):o?i.points.map((e=>({x:e[0],y:e[1],z:e[2]}))):s?i.points.map((e=>({x:e[0],y:e[1],m:e[2]}))):i.points.map((e=>({x:e[0],y:e[1]}))),t._exporter=(t,i)=>e.hasM?new r({points:t.map((e=>[e.x,e.y,e.z,e.m])),hasZ:!0,hasM:!0,spatiaReference:i}):new r(t.map((e=>[e.x,e.y,e.z])),i);break}case\"polyline\":{const i=e,o=[],s=[],{hasZ:l,hasM:n}=e;let a=0;for(const e of i.paths)if(s.push([a,a+e.length]),a+=e.length,l&&n)for(const t of e)o.push({x:t[0],y:t[1],z:t[2],m:t[3]});else if(l)for(const t of e)o.push({x:t[0],y:t[1],z:t[2]});else if(n)for(const t of e)o.push({x:t[0],y:t[1],m:t[2]});else for(const t of e)o.push({x:t[0],y:t[1]});t.coordinates=o,t._exporter=(t,i)=>{const o=e.hasM?t.map((e=>[e.x,e.y,e.z,e.m])):t.map((e=>[e.x,e.y,e.z])),l=s.map((e=>o.slice(e[0],e[1])));return new u({paths:l,hasM:e.hasM,hasZ:!0,spatialReference:i})};break}}return t}}class g{constructor(e,t){this.layer=e,this.options=t}}class w extends g{constructor(e,t,i){super(e,i),this.outSpatialReference=t,this.type=\"geometry\"}selectTilesAtLOD(e){if(e<0)this.geometry.coordinates.forEach((e=>e.tile=null));else{const t=this.layer.tileInfo,i=t.lods[e].level;this.geometry.coordinates.forEach((e=>{e.tile=t.tileAt(i,e.x,e.y)}))}}allElevationTilesFetched(){return!this.geometry.coordinates.some((e=>!e.elevationTile))}clearElevationTiles(){for(const e of this.geometry.coordinates)e.elevationTile!==this.outsideExtentTile&&(e.elevationTile=null)}populateElevationTiles(e){for(const t of this.geometry.coordinates)!t.elevationTile&&t.tile&&(t.elevationTile=e[t.tile.id])}remapTiles(e){for(const t of this.geometry.coordinates)t.tile=e[t.tile.id]}getTilesToFetch(){const e={},t=[];for(const i of this.geometry.coordinates){const o=i.tile;i.elevationTile||!i.tile||e[o.id]||(e[o.id]=o,t.push(o))}return t}forEachTileToFetch(e){for(const t of this.geometry.coordinates)t.tile&&!t.elevationTile&&e(t.tile,(()=>t.tile=null))}}class _ extends g{constructor(e,t,i,o){super(e,i),this.type=\"extent\",this.elevationTiles=[],this.candidateTiles=[],this.fetchedCandidates=new Set,this.extent=t.intersection(e.fullExtent),this.maskExtents=o}selectTilesAtLOD(e,t){const i=this._maximumLodForRequests(t),o=Math.min(i,e);o<0?this.candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(o)}_maximumLodForRequests(e){const t=this.layer.tileInfo;if(!e)return t.lods.length-1;const i=this.extent;if(o(i))return-1;for(let o=t.lods.length-1;o>=0;o--){const s=t.lods[o],l=s.resolution*t.size[0],n=s.resolution*t.size[1];if(Math.ceil(i.width/l)*Math.ceil(i.height/n)<=e)return o}return-1}allElevationTilesFetched(){return this.candidateTiles.length===this.elevationTiles.length}clearElevationTiles(){this.elevationTiles.length=0,this.fetchedCandidates.clear()}populateElevationTiles(e){for(const t of this.candidateTiles){const i=e[t.id];i&&(this.fetchedCandidates.add(t),this.elevationTiles.push(i))}}remapTiles(e){this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles.map((t=>e[t.id])))}getTilesToFetch(){return this.candidateTiles}forEachTileToFetch(e,t){const i=this.candidateTiles;this.candidateTiles=[],i.forEach((i=>{if(this.fetchedCandidates.has(i))return void(t&&t(i));let o=!1;e(i,(()=>o=!0)),o?t&&t(i):this.candidateTiles.push(i)})),this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles,t)}_uniqueNonOverlappingTiles(e,t){const i={},o=[];for(const l of e)i[l.id]?t&&t(l):(i[l.id]=l,o.push(l));const s=o.sort(((e,t)=>e.level-t.level));return s.filter(((e,i)=>{for(let o=0;o<i;o++)if(d(s[o].extent,e.extent))return t&&t(e),!1;return!0}))}_selectCandidateTilesCoveringExtentAt(e){this.candidateTiles.length=0;const t=this.extent;if(o(t))return;const i=this.layer.tileInfo,s=i.lods[e],l=i.tileAt(s.level,t.xmin,t.ymin),n=s.resolution*i.size[0],a=s.resolution*i.size[1],r=Math.ceil((t.xmax-l.extent[0])/n),c=Math.ceil((t.ymax-l.extent[1])/a);for(let o=0;o<c;o++)for(let e=0;e<r;e++){const t={id:null,level:l.level,row:l.row-o,col:l.col+e};i.updateTileInfo(t),this._tileIsMasked(t)||this.candidateTiles.push(t)}}_tileIsMasked(e){return!!this.maskExtents&&this.maskExtents.some((t=>d(t,e.extent)))}}function E(e,t){let i=e.lods.length-1;if(t>0){const o=e.lods.findIndex((e=>e.resolution<t));0===o?i=0:o>0&&(i=o-1)}return i}const R={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:\"auto\",minDemResolution:0};export{v as ElevationQuery,x as GeometryDescriptor,v as default,E as getFinestLodIndex};\n"],"sourceRoot":""}