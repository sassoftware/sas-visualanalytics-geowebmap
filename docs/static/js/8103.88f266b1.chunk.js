"use strict";(globalThis.webpackChunkgeowebmap=globalThis.webpackChunkgeowebmap||[]).push([[8103],{8103:(e,t,l)=>{l.r(t),l.d(t,{previewSymbol2D:()=>b});var a=l(51995),n=l(10064),o=l(17842),i=l(79563),s=l(37817),u=l(69157);const c="picture-fill",m=s.b_.size,r=s.b_.maxSize,h=s.b_.maxOutlineSize,d=s.b_.lineWidth,p=document.createElement("canvas");function v(e,t){const l=p.getContext("2d"),a=[];return t&&(t.weight&&a.push(t.weight),t.size&&a.push(t.size+"px"),t.family&&a.push(t.family)),l.font=a.join(" "),l.measureText(e).width}function f(e){if(0===e.length)return 0;if(e.length>2){const t=(0,o.Wz)(1),l=parseFloat(e);switch(e.slice(-2)){case"px":return l;case"pt":return l*t;case"in":return 72*l*t;case"pc":return 12*l*t;case"mm":return 2.8346456692913384*l*t;case"cm":return 28.346456692913385*l*t}}return parseFloat(e)}function y(e){const t=null==e?void 0:e.size;return{width:null!=t&&"object"==typeof t&&"width"in t?(0,o.F2)(t.width):null,height:null!=t&&"object"==typeof t&&"height"in t?(0,o.F2)(t.height):null}}function b(e,t){var l,p;const b="number"==typeof(null==t?void 0:t.size)?null==t?void 0:t.size:null,w=null!=b?(0,o.F2)(b):null,g=null!=(null==t?void 0:t.maxSize)?(0,o.F2)(t.maxSize):null,M=null!=(null==t?void 0:t.opacity)?t.opacity:null,k=null!=(null==t?void 0:t.rotation)?t.rotation:"angle"in e?e.angle:null,x=(0,i._M)(e);let L=(0,i.mx)(e);if(x&&!L){const e="type"in x?null:new a.Z(x);"#ffffff"===(e?e.toHex():null)&&(L={color:"#bdc3c7",width:.75})}const z={shape:null,fill:null,stroke:L,offset:[0,0]};null!=(l=L)&&l.width&&(L.width=Math.min(L.width,h));const F=(null==(p=L)?void 0:p.width)||0;let C=null!=(null==t?void 0:t.size)&&(null==(null==t?void 0:t.scale)||(null==t?void 0:t.scale)),S=0,Z=0,j=!1;switch(e.type){case"simple-marker":{const t=e.style,l=Math.min(null!=w?w:(0,o.F2)(e.size),g||r);switch(S=l,Z=l,t){case"circle":z.shape={type:"circle",cx:0,cy:0,r:.5*l},C||(S+=F,Z+=F);break;case"cross":z.shape={type:"path",path:[{command:"M",values:[0,.5*Z]},{command:"L",values:[S,.5*Z]},{command:"M",values:[.5*S,0]},{command:"L",values:[.5*S,Z]}]};break;case"diamond":z.shape={type:"path",path:[{command:"M",values:[0,.5*Z]},{command:"L",values:[.5*S,0]},{command:"L",values:[S,.5*Z]},{command:"L",values:[.5*S,Z]},{command:"Z",values:[]}]},C||(S+=F,Z+=F);break;case"square":z.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[S,0]},{command:"L",values:[S,Z]},{command:"L",values:[0,Z]},{command:"Z",values:[]}]},C||(S+=F,Z+=F),k&&(j=!0);break;case"triangle":z.shape={type:"path",path:[{command:"M",values:[.5*S,0]},{command:"L",values:[S,Z]},{command:"L",values:[0,Z]},{command:"Z",values:[]}]},C||(S+=F,Z+=F),k&&(j=!0);break;case"x":z.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[S,Z]},{command:"M",values:[S,0]},{command:"L",values:[0,Z]}]},k&&(j=!0);break;case"path":z.shape={type:"path",path:e.path||""},C||(S+=F,Z+=F),k&&(j=!0),C=!0}break}case"simple-line":{var _;const{width:e,height:l}=y(t),a=null!=l?l:Math.min(null!=w?w:F,g||h),n=null!=e?e:d;L.width=a,S=n,Z=a;const o=(null==z||null==(_=z.stroke)?void 0:_.cap)||"butt",i="round"===o;C=!0,z.stroke.cap="butt"===o?"square":o,z.shape={type:"path",path:[{command:"M",values:[i?a/2:0,Z/2]},{command:"L",values:[i?S-a/2:S,Z/2]}]};break}case c:case"simple-fill":{const e="object"==typeof(null==t?void 0:t.symbolConfig)&&(null==t?void 0:t.symbolConfig.isSquareFill),{width:l,height:a}=y(t);S=e&&null!=l?l:null!=w?w:m,Z=e&&null!=a?a:S,C||(S+=F,Z+=F),C=!0,z.shape=e?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[S,0]},{command:"L",values:[S,Z]},{command:"L",values:[0,Z]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:s.JZ.fill[0];break}case"picture-marker":{let t=(0,o.F2)(e.width),l=(0,o.F2)(e.height);const a=null!=w?w:Math.max(t,l),n=t/l;t=n<=1?Math.ceil(a*n):a,l=n<=1?a:Math.ceil(a/n),S=Math.min(t,g||r),Z=Math.min(l,g||r),z.shape={type:"image",x:-Math.round(S/2),y:-Math.round(Z/2),width:S,height:Z,src:e.url||""},k&&(j=!0);break}case"text":{const t=e,l=t.text||"Aa",a=t.font,n=Math.min(null!=w?w:(0,o.F2)(a.size),g||r),i=v(l,{weight:a.weight,size:n,family:a.family}),s=/[\uE600-\uE6FF]/.test(l);S=s?n:i,Z=n;let u=.25*f((a?n:0).toString());s&&(u+=5),z.shape={type:"text",text:l,x:0,y:u,align:"middle",decoration:a&&a.decoration,rotated:t.rotated,kerning:t.kerning},z.font=a&&{size:n,style:a.style,decoration:a.decoration,weight:a.weight,family:a.family};break}}if(!z.shape)return Promise.reject(new n.Z("symbolPreview: renderPreviewHTML2D","symbol not supported."));const P=x,T=e.color;let q=null;return P&&"pattern"===P.type&&T&&e.type!==c?q=(0,i.Od)(P.src,T.toCss(!0)).then((e=>(P.src=e,z.fill=P,z))):(z.fill=x,q=Promise.resolve(z)),q.then((e=>{const l=[[e]];if("object"==typeof(null==t?void 0:t.symbolConfig)&&null!=t&&t.symbolConfig.applyColorModulation){const t=.6*S;l.unshift([{...e,offset:[-t,0],fill:(0,s.dc)(x,-.3)}]),l.push([{...e,offset:[t,0],fill:(0,s.dc)(x,.3)}]),S+=2*t,C=!1}return(0,u.w)(l,[S,Z],{node:t&&t.node,scale:C,opacity:M,rotation:k,useRotationSize:j,effectView:null==t?void 0:t.effectView})}))}}}]);
//# sourceMappingURL=8103.88f266b1.chunk.js.map