(this.webpackJsonpgeowebmap=this.webpackJsonpgeowebmap||[]).push([[77],{1150:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i(3),n=i(4),s=i(6),a=i(7),u=i(0),o=i(185),c=i(1),h=(i(17),i(18),i(16),i(9)),l=function(e){Object(s.a)(i,e);var t=Object(a.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).tiles=new Map,n}return Object(n.a)(i,[{key:"destroy",value:function(){this.tiles.clear(),this.layer=this.layerView=this.tileInfoView=this.tiles=null}},{key:"updating",get:function(){return this.isUpdating()}},{key:"acquireTile",value:function(e){var t=this,i=this.createTile(e);return i.once("isReady",(function(){return t.notifyChange("updating")})),this.tiles.set(e.id,i),i}},{key:"forceAttributeTextureUpload",value:function(){}},{key:"forEachTile",value:function(e){this.tiles.forEach(e)}},{key:"releaseTile",value:function(e){this.tiles.delete(e.key.id),this.disposeTile(e)}},{key:"isUpdating",value:function(){var e=!0;return this.tiles.forEach((function(t){e=e&&t.isReady})),!e}},{key:"setHighlight",value:function(){}},{key:"invalidateLabels",value:function(){}},{key:"requestUpdate",value:function(){this.layerView.requestUpdate()}}]),i}(o.a);Object(u.a)([Object(c.b)()],l.prototype,"layer",void 0),Object(u.a)([Object(c.b)()],l.prototype,"layerView",void 0),Object(u.a)([Object(c.b)()],l.prototype,"tileInfoView",void 0),Object(u.a)([Object(c.b)()],l.prototype,"updating",null);var f=l=Object(u.a)([Object(h.a)("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],l)},1371:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return W}));var r=i(8),n=i.n(r),s=i(15),a=i(3),u=i(4),o=i(47),c=i(44),h=i(6),l=i(7),f=i(0),d=i(17),_=(i(1),i(18),i(16),i(9)),v=i(45),y=i(12),p=i(992),b=i(2),k=i(145),g=i(494),x=i(33),O=i(283),m=i(882),j=i(885),w=i(949),E=4294967296,R=function(){function e(t){Object(a.a)(this,e),this._head=t,this._cursor=t}return Object(u.a)(e,[{key:"id",get:function(){return this._cursor.id}},{key:"baseZoom",get:function(){return this._cursor.baseZoom}},{key:"anchorX",get:function(){return this._cursor.anchorX}},{key:"anchorY",get:function(){return this._cursor.anchorY}},{key:"directionX",get:function(){return this._cursor.directionX}},{key:"directionY",get:function(){return this._cursor.directionY}},{key:"size",get:function(){return this._cursor.size}},{key:"materialKey",get:function(){return this._cursor.materialKey}},{key:"boundsCount",get:function(){return this._cursor.boundsCount}},{key:"computedMinZoom",value:function(){return this._cursor.computedMinZoom()}},{key:"setComputedMinZoom",value:function(e){return this._cursor.setComputedMinZoom(e)}},{key:"boundsComputedAnchorX",value:function(e){return this._cursor.boundsComputedAnchorX(e)}},{key:"boundsComputedAnchorY",value:function(e){return this._cursor.boundsComputedAnchorY(e)}},{key:"setBoundsComputedAnchorX",value:function(e,t){return this._cursor.setBoundsComputedAnchorX(e,t)}},{key:"setBoundsComputedAnchorY",value:function(e,t){return this._cursor.setBoundsComputedAnchorY(e,t)}},{key:"boundsX",value:function(e){return this._cursor.boundsX(e)}},{key:"boundsY",value:function(e){return this._cursor.boundsY(e)}},{key:"boundsWidth",value:function(e){return this._cursor.boundsWidth(e)}},{key:"boundsHeight",value:function(e){return this._cursor.boundsHeight(e)}},{key:"link",value:function(e){if(Object(b.k)(e._head))return this._cursor.link(e._head)}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var t,i=new e(null==(t=this._head)?void 0:t.copy());if(!i._head)return i;for(var r=i._head,n=i._head._link;n;)r._link=n.copy(),n=(r=n)._link;return i}},{key:"peekId",value:function(){var e;return null!=(e=this._cursor.peekId())?e:this._cursor._link.peekId()}},{key:"nextId",value:function(){for(var e=this.id;e===this.id;)if(!this.next())return!1;return!0}},{key:"save",value:function(){this._savedCursor=this._cursor,this._savedOffset=this._cursor._offset}},{key:"restore",value:function(){this._cursor=this._savedCursor,this._cursor._offset=this._savedOffset}},{key:"next",value:function(){if(!this._cursor)return!1;if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link,this._cursor._offset=0}return!0}},{key:"lookup",value:function(e){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(e);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}},{key:"delete",value:function(e){for(var t=this._head,i=null;t;){if(t.delete(e))return t.isEmpty()&&Object(b.k)(i)&&(i._link=t._link),!0;i=t,t=t._link}return!1}}],[{key:"from",value:function(t){return new e(S.from(new Float32Array(t)))}}]),e}(),S=function(){function e(t){Object(a.a)(this,e),this._offset=-1,this._link=null,this._count=0,this._deletedCount=0,this._offsets={instance:null},this._buffer=t}return Object(u.a)(e,[{key:"isEmpty",value:function(){return this._deletedCount===this.count}},{key:"count",get:function(){return this._count||(this._count=this._computeCount()),this._count}},{key:"id",get:function(){return this._buffer[this._offset+0]},set:function(e){this._buffer[this._offset+0]=e}},{key:"baseZoom",get:function(){return this._buffer[this._offset+1]}},{key:"anchorX",get:function(){return this._buffer[this._offset+2]}},{key:"anchorY",get:function(){return this._buffer[this._offset+3]}},{key:"directionX",get:function(){return this._buffer[this._offset+4]}},{key:"directionY",get:function(){return this._buffer[this._offset+5]}},{key:"size",get:function(){return this._buffer[this._offset+6]}},{key:"materialKey",get:function(){return this._buffer[this._offset+7]}},{key:"computedMinZoom",value:function(){return this._buffer[this._offset+8]}},{key:"setComputedMinZoom",value:function(e){this._buffer[this._offset+8]=e}},{key:"boundsCount",get:function(){return this._buffer[this._offset+9]}},{key:"boundsComputedAnchorX",value:function(e){return this._buffer[this._offset+10+6*e+0]}},{key:"boundsComputedAnchorY",value:function(e){return this._buffer[this._offset+10+6*e+1]}},{key:"setBoundsComputedAnchorX",value:function(e,t){this._buffer[this._offset+10+6*e+0]=t}},{key:"setBoundsComputedAnchorY",value:function(e,t){this._buffer[this._offset+10+6*e+1]=t}},{key:"boundsX",value:function(e){return this._buffer[this._offset+10+6*e+2]}},{key:"boundsY",value:function(e){return this._buffer[this._offset+10+6*e+3]}},{key:"boundsWidth",value:function(e){return this._buffer[this._offset+10+6*e+4]}},{key:"boundsHeight",value:function(e){return this._buffer[this._offset+10+6*e+5]}},{key:"link",value:function(e){for(var t=this;t._link;)t=t._link;t._link=e}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this._buffer);return t._link=this._link,t._offset=this._offset,t._deletedCount=this._deletedCount,t._offsets=this._offsets,t._count=this._count,t}},{key:"peekId",value:function(){var e=this._offset+10+6*this.boundsCount+0;return e>=this._buffer.length?0:this._buffer[e]}},{key:"next",value:function(){for(var e=0;this._offset<this._buffer.length&&e++<100&&(-1===this._offset?this._offset=0:this._offset+=10+6*this.boundsCount,this.id===E););return this.id!==E&&this._offset<this._buffer.length}},{key:"delete",value:function(e){var t=this._offset,i=this.lookup(e);if(i)for(this.id=4294967295,++this._deletedCount;this.next()&&this.id===e;)this.id=4294967295,++this._deletedCount;return this._offset=t,i}},{key:"lookup",value:function(e){var t=this._offset;if(Object(b.j)(this._offsets.instance)){this._offsets.instance=new Map;var i=this.copy();i._offset=-1;for(var r=0;i.next();)i.id!==r&&(this._offsets.instance.set(i.id,i._offset),r=i.id)}return!!this._offsets.instance.has(e)&&(this._offset=this._offsets.instance.get(e),this.id!==E||(this._offset=t,!1))}},{key:"_computeCount",value:function(){var e=this._offset,t=0;for(this._offset=-1;this.next();)t++;return this._offset=e,t}}],[{key:"from",value:function(t){return new e(new Float32Array(t))}}]),e}(),T=i(92),C=(i(113),i(142),i(129),i(284),i(40),i(65),i(115)),M=function(){function e(t){if(Object(a.a)(this,e),Array.isArray(t)){this.data=t[0];for(var i=this,r=1;r<t.length;r++)i.next=new e([t[r]]),i=i.next}else this.data=t}return Object(u.a)(e,[{key:"values",value:n.a.mark((function e(){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this;case 1:if(!t){e.next=7;break}return e.next=4,t.data;case 4:t=t.next;case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"forEach",value:function(e){for(var t=this;t;)e(t.data),t=t.next}},{key:"find",value:function(e){var t;return e(this.data)?this:null==(t=this.next)?void 0:t.find(e)}},{key:"max",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,i=e(this.data)>e(t.data)?this:t;return this.next?this.next.max(e,i):i}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this===e?t?(t.next=this.next,t):this.next:this.next.remove(e,this)}},{key:"last",get:function(){return this.next?this.next.last:this}}]),e}(),z=function(){function e(t){Object(a.a)(this,e),this._head=null,Object(b.j)(t)||(this._head=new M(t))}return Object(u.a)(e,[{key:"head",get:function(){return this._head}},{key:"maxAvailableSpace",value:function(){if(Object(b.j)(this._head))return 0;var e=this._head.max((function(e){return e.end-e.start}));return e.data.end-e.data.start}},{key:"firstFit",value:function(e){if(Object(b.j)(this._head))return null;for(var t=null,i=this._head;i;){var r=i.data.end-i.data.start;if(r===e)return t?t.next=i.next:this._head=i.next,i.data.start;if(r>e){var n=i.data.start;return i.data.start+=e,n}t=i,i=i.next}return null}},{key:"free",value:function(e,t){var i=e+t;if(Object(b.j)(this._head)){var r=new M({start:e,end:i});this._head=r}else{if(i<=this._head.data.start){if(i===this._head.data.start)return void(this._head.data.start-=t);var n=new M({start:e,end:i});return n.next=this._head,void(this._head=n)}for(var s=this._head,a=s.next;a;){if(a.data.start>=i){if(s.data.end===e)return void(s.data.end+=t);if(a.data.start===i)return void(a.data.start-=t);var u=new M({start:e,end:i});return u.next=s.next,void(s.next=u)}s=a,a=a.next}if(e!==s.data.end){var o=new M({start:e,end:i});s.next=o}else s.data.end+=t}}}]),e}(),I=function(){function e(t,i,r,n,s){Object(a.a)(this,e),this.target=t,this.geometryType=i,this.materialKey=r,this.indexFrom=n,this.indexCount=s}return Object(u.a)(e,[{key:"indexEnd",get:function(){return this.indexFrom+this.indexCount}},{key:"extend",value:function(e){this.indexCount+=e}},{key:"draw",value:function(e,t,i){this.target.draw(e,t,i,this.indexFrom,this.indexCount)}}]),e}(),A=function(){function e(t,i){Object(a.a)(this,e),this.geometryType=0,this._target=t,this.geometryType=i}return Object(u.a)(e,[{key:"addRecord",value:function(e){var t=this._target,i=this.geometryType,r=e.materialKey,n=e.indexFrom,s=e.indexCount;if(Object(b.j)(this._head)){var a=new I(t,i,r,n,s);this._head=new M(a)}else{for(var u=null,o=this._head;o;){if(n<o.data.indexFrom)return this._insert(r,n,s,u,o);u=o,o=o.next}this._insert(r,n,s,u,null)}}},{key:"forEach",value:function(e){Object(b.k)(this._head)&&this._head.forEach(e)}},{key:"infos",value:n.a.mark((function e(){var t,i,r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(b.k)(this._head)){e.next=18;break}t=Object(y.a)(this._head.values()),e.prev=2,t.s();case 4:if((i=t.n()).done){e.next=10;break}return r=i.value,e.next=8,r;case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),t.e(e.t0);case 15:return e.prev=15,t.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))},{key:"_insert",value:function(e,t,i,r,n){if(Object(b.j)(r)&&Object(b.j)(n)){var s=new I(this._target,this.geometryType,e,t,i);this._head=new M(s)}return Object(b.j)(r)&&Object(b.k)(n)?this._insertAtHead(e,t,i,n):Object(b.k)(r)&&Object(b.j)(n)?this._insertAtEnd(e,t,i,r):Object(b.k)(r)&&Object(b.k)(n)?this._insertAtMiddle(e,t,i,r,n):void 0}},{key:"_insertAtHead",value:function(e,t,i,r){var n=t+i;if(e===r.data.materialKey&&n===r.data.indexFrom)r.data.indexFrom=t,r.data.indexCount+=i;else{var s=new I(this._target,this.geometryType,e,t,i);this._head=new M(s),this._head.next=r}}},{key:"_insertAtEnd",value:function(e,t,i,r){if(r.data.materialKey===e&&r.data.indexEnd===t)r.data.indexCount+=i;else{var n=new I(this._target,this.geometryType,e,t,i),s=new M(n);r.next=s}}},{key:"_insertAtMiddle",value:function(e,t,i,r,n){var s=t+i;if(r.data.materialKey===e&&r.data.indexEnd===t)r.data.indexCount+=i,r.data.materialKey===n.data.materialKey&&r.data.indexEnd===n.data.indexFrom&&(r.data.indexCount+=n.data.indexCount,r.next=n.next);else if(e===n.data.materialKey&&s===n.data.indexFrom)n.data.indexFrom=t,n.data.indexCount+=i;else{var a=new I(this._target,this.geometryType,e,t,i),u=new M(a);r.next=u,u.next=n}}}],[{key:"from",value:function(t,i,r,n){var s=new e(t,i);if(Object(b.k)(n)){var a,u=Object(y.a)(n);try{for(u.s();!(a=u.n()).done;){var o=a.value;r.seekIndex(o),s.addRecord(r)}}catch(c){u.e(c)}finally{u.f()}}else for(;r.next();)s.addRecord(r);return s}}]),e}(),V=function(){function e(t,i,r){Object(a.a)(this,e);var n=new Uint32Array(i*r);this.strideInt=r,this.bufferType=t,this.dirty={start:1/0,end:0},this.gpu=null,this._cpu=n,this.clear()}return Object(u.a)(e,[{key:"elementSize",get:function(){return this._cpu.length/this.strideInt}},{key:"destroy",value:function(){Object(b.b)(this.gpu,(function(e){return e.dispose()}))}},{key:"clear",value:function(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new z({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}},{key:"ensure",value:function(e){if(!(this.maxAvailableSpace()>=e)){var t=e*this.strideInt;if(t>this._cpu.length-this.fillPointer){Object(b.k)(this.gpu)&&(this.gpu=null);var i=Math.round(1.5*(this._cpu.length+t)),r=new Uint32Array(i),n=this._cpu.length/this.strideInt,s=i/this.strideInt;this.freeList.free(n,s-n),r.set(this._cpu),this._cpu=r}}}},{key:"set",value:function(e,t){this._cpu[e]!==t&&(this._cpu[e]=t,this.dirty.start=Math.min(e,this.dirty.start),this.dirty.end=Math.max(e,this.dirty.end))}},{key:"getBuffer",value:function(){if(!this._cpu2||this._cpu2.length!==this._cpu.length){var e=this._cpu.slice();this._cpu2=e}return this._cpu2.set(this._cpu),this._cpu2}},{key:"bufferSize",get:function(){return this._cpu.length/this.strideInt}},{key:"maxAvailableSpace",value:function(){return this.freeList.maxAvailableSpace()}},{key:"insert",value:function(e,t,i,r){var n=i*this.strideInt,s=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a=new Uint32Array(e,s,n),u=Object(b.v)(this.freeList.firstFit(i),"First fit region must be defined")*this.strideInt,o=n,c=u/this.strideInt-t;if(0!==r)for(var h=0;h<a.length;h++)a[h]+=r;return this._cpu.set(a,u),this.dirty.start=Math.min(this.dirty.start,u),this.dirty.end=Math.max(this.dirty.end,u+o),this.fillPointer=Math.max(this.fillPointer,u+o),c}},{key:"free",value:function(e,t,i){var r=e*this.strideInt,n=(e+t)*this.strideInt;if(!0===i)for(var s=e;s!==e+t;s++)this._cpu[s*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,r),this.dirty.end=Math.max(this.dirty.end,n),this.freeList.free(e,t)}},{key:"upload",value:function(e){if(this.dirty.end){if(Object(b.j)(this.gpu))return this.gpu=this._createBuffer(e),this.dirty.start=1/0,void(this.dirty.end=0);this.gpu.setSubData(this._cpu,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}},{key:"_createBuffer",value:function(e){return"index"===this.bufferType?T.a.createIndex(e,35048,this._cpu):T.a.createVertex(e,35048,this._cpu)}}]),e}(),L=i(950),B=function(){function e(t,i){Object(a.a)(this,e),this._indicesInvalid=!1,this.geometryType=t}return Object(u.a)(e,[{key:"destroy",value:function(){this._vao&&(this._vao.dispose(),this._vao=null)}},{key:"insert",value:function(e,t,i){if(e.records.byteLength){var r=e.stride;if(this._vertexBuffer&&this._indexBuffer){var n=4*e.indices.byteLength,s=e.vertices.byteLength/r;this._indexBuffer.ensure(n),this._vertexBuffer.ensure(s);var a=e.vertices,u=e.indices,o=L.a.from(e.records),c=this._vertexBuffer.insert(a,0,a.byteLength/r,0),h=this._indexBuffer.insert(u,0,u.byteLength/4,c);if(o.forEach((function(e){e.indexFrom+=h,e.vertexFrom+=c})),Object(b.v)(this._records,"Expected records to be defined").link(o),t)this._indicesInvalid=!0;else if(this._displayList)for(var l=o.getCursor();l.next();)this._displayList.addRecord(l)}else{var f=4*e.indices.byteLength,d=e.vertices.byteLength/r,_=r/Uint32Array.BYTES_PER_ELEMENT;this._records=L.a.from(e.records),this._indexBuffer=new V("index",f,1),this._vertexBuffer=new V("vertex",d,_),this._indexBuffer.insert(e.indices,0,e.indices.byteLength/4,0),this._vertexBuffer.insert(e.vertices,0,e.vertices.byteLength/r,0),t&&(this._indicesInvalid=!0)}}}},{key:"remove",value:function(e){if(!Object(b.j)(this._records)){var t,i=Object(y.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value,n=this._records.getCursor();if(n.lookup(r)){for(var s=n.indexFrom,a=n.vertexFrom,u=n.indexCount,o=n.vertexCount;n.next()&&n.id===r;)u+=n.indexCount,o+=n.vertexCount;this._indexBuffer.free(s,u),this._vertexBuffer.free(a,o,!0),this._records.delete(r)}}}catch(c){i.e(c)}finally{i.f()}}}},{key:"draw",value:function(e,t,i,r,n){if(this._vertexBuffer&&this._indexBuffer&&!Object(b.j)(this._records)){if((Object(b.j)(this._vertexBuffer.gpu)||Object(b.j)(this._indexBuffer.gpu))&&(this._vao&&(this._vao.dispose(),this._vao=null),this._vertexBuffer.gpu=null,this._indexBuffer.gpu=null),this._vertexBuffer.upload(e),this._indexBuffer.upload(e),!this._vao){var s=this._vertexBuffer.gpu,a=this._indexBuffer.gpu;if(!a||!s)return;this._vao=new C.a(e,i,t,{geometry:s},a)}var u=this._vao,o=r*Uint32Array.BYTES_PER_ELEMENT;e.bindVAO(u),e.drawElements(4,n,5125,o)}}},{key:"forEachCommand",value:function(e){if(!Object(b.j)(this._records)){if(this._sortIndices(this._records),!this._displayList){var t=this._cursorIndexOrder;this._displayList=A.from(this,this.geometryType,this._records.getCursor(),t)}this._displayList.forEach(e)}}},{key:"_sortIndices",value:function(e){if(this._indicesInvalid){this._indicesInvalid=!1;for(var t=0,i=e.getCursor(),r=this._indexBuffer.getBuffer(),n=[],s=[],a=[];i.next();)s.push(i.index),a.push(i.sortKey),n.push(i.id);s.sort((function(e,t){var i=a[t],r=a[e];return r===i?n[t]-n[e]:i-r}));for(var u=e.getCursor(),o=0,c=s;o<c.length;o++){var h=c[o];if(!u.seekIndex(h))throw new Error("Expected to find index");var l=u.indexFrom,f=u.indexCount;u.indexFrom=t;for(var d=0;d<f;d++)this._indexBuffer.set(t++,r[l+d])}this._cursorIndexOrder=s,this._displayList=null}}}]),e}(),P=0,D=function(e){Object(h.a)(i,e);var t=Object(l.a)(i);function i(e,r,n,s){var u;return Object(a.a)(this,i),(u=t.call(this,e,r,n)).instanceId=P++,u.patchCount=0,u._renderState={current:{geometry:new Map,metrics:null},next:null,swap:!1,swapFrames:0,locked:!1},u._patches=new p.a(100),u._bufferPatches=new p.a(100),u._lastCommitTime=0,u._lastMessageWasClear=!1,u.transforms.labelMat2d=Object(g.a)(),u._store=s,u}return Object(u.a)(i,[{key:"destroy",value:function(){Object(o.a)(Object(c.a)(i.prototype),"destroy",this).call(this),this._renderState.current.geometry.forEach((function(e){return e.destroy()}))}},{key:"labelMetrics",get:function(){return this._renderState.current.metrics}},{key:"hasData",get:function(){return!!this._renderState.current.geometry.size}},{key:"getGeometry",value:function(e){return this._renderState.current.geometry.get(e)}},{key:"setTransform",value:function(e,t){Object(o.a)(Object(c.a)(i.prototype),"setTransform",this).call(this,e,t);var r=this.transforms.labelMat2d,n=e.getScreenTransform(r,t),s=Object(O.a)();Object(x.t)(s,[this.x,this.y],n),Object(k.d)(r),Object(k.h)(r,r,s),Object(k.e)(r,e.viewMat2d,r)}},{key:"patch",value:function(e,t){if(this.patchCount++,!e.clear||!this._lastMessageWasClear){this._lastMessageWasClear=e.clear,e.clear&&this._patches.size>=50&&this._dropPatches();var i=e,r=i.addOrUpdate&&this.key.id!==i.addOrUpdate.tileKeyOrigin;t&&r?this._bufferPatches.enqueue(i):(i.sort=i.sort&&!t,this._patches.enqueue(i)),this.requestRender()}}},{key:"commit",value:function(e){if(this._lastCommitTime!==e.time){this._lastCommitTime=e.time;for(var t=0;t<4;t++)this._updateMesh(),this.isReady&&this._updateBufferMesh();this._renderState.swap&&(this._swapRenderStates(),this.requestRender())}}},{key:"lock",value:function(){this._renderState.locked=!0}},{key:"unlock",value:function(){this._renderState.locked=!1,this._flushUpdates(),this._swap()}},{key:"_swapRenderStates",value:function(){if(this._renderState.next){if(this._renderState.locked)return this._renderState.swap=!0,void this.requestRender();if(this._renderState.swap=!0,0===this._renderState.swapFrames)return this._renderState.swapFrames=8,void this.requestRender();1==this._renderState.swapFrames--?this._swap():this.requestRender()}}},{key:"_swap",value:function(){this._renderState.swap&&(this._renderState.swap=!1,Object(b.k)(this._renderState.next)&&(this._renderState.current.geometry.forEach((function(e){return e.destroy()})),this._renderState.current=this._renderState.next,this._renderState.next=null))}},{key:"_flushUpdates",value:function(){for(var e=this._patches.maxSize;this._patches.size&&e--;)this._updateMesh(),this._swap()}},{key:"_updateBufferMesh",value:function(){var e=this._bufferPatches.peek();if(!Object(b.k)(e)||!e.clear||null===this._renderState.next)for(;this._bufferPatches.size;){var t=this._bufferPatches.dequeue();Object(b.k)(t)&&this._patchBuffer(t)}}},{key:"_updateMesh",value:function(){var e=this._patches.peek();if(!Object(b.k)(e)||!e.clear||null===this._renderState.next){var t=this._patches.dequeue();if(Object(b.k)(t)){if(!0===t.clear){if(!this.isReady)return;return this._renderState.next,void(this._renderState.next={geometry:new Map,metrics:null})}this.requestRender(),this._patch(t),t.end&&(this.ready(),this._swapRenderStates())}}}},{key:"_patch",value:function(e){var t=this;Object(j.g)((function(i){t._remove(i,e.remove),t._insert(i,e,!1)}))}},{key:"_patchBuffer",value:function(e){var t=this;Object(j.g)((function(i){t._insert(i,e,!0)}))}},{key:"_insert",value:function(e,t,i){try{var r,n=Object(b.u)(this._renderState.next,this._renderState.current),s=null==(r=t.addOrUpdate)?void 0:r.data[e],a=n.geometry;if(Object(b.j)(s))return;a.has(e)||a.set(e,new B(e,this.stage)),a.get(e).insert(s,t.sort,i),e===m.d.LABEL&&this._insertLabelMetrics(t.type,s.metrics,t.clear)}catch(u){}}},{key:"_insertLabelMetrics",value:function(e,t,i){var r=Object(b.u)(this._renderState.next,this._renderState.current);if(!Object(b.j)(t)){var n=R.from(t);if(Object(b.j)(r.metrics))r.metrics=n;else{if("update"===e)for(var s=n.getCursor();s.next();)r.metrics.delete(s.id);r.metrics.link(n)}}}},{key:"_remove",value:function(e,t){var i=Object(b.u)(this._renderState.next,this._renderState.current).geometry.get(e);t&&t.length&&i&&(i.remove(t),this._removeLabelMetrics(t))}},{key:"_removeLabelMetrics",value:function(e){var t=Object(b.u)(this._renderState.next,this._renderState.current).metrics;if(!Object(b.j)(t)&&e.length){var i,r=Object(y.a)(e);try{for(r.s();!(i=r.n()).done;)for(var n=i.value;t.delete(n););}catch(s){r.e(s)}finally{r.f()}}}},{key:"_dropPatches",value:function(){for(var e=this,t=new Array,i=!1;this._patches.size;){var r=this._patches.dequeue();if(Object(b.j)(r))break;if(r.clear){if(i)break;i=!0}t.push(r)}this._patches.clear(),t.forEach((function(t){return e._patches.enqueue(t)}))}}]),i}(w.a),F=i(948),U=i(1150),q=i(939),N=i(35),Y=i(23),K=i(926),H=i(955),G=Object(d.a)("featurelayer-order-by-server-enabled"),X=function(e){Object(h.a)(i,e);var t=Object(l.a)(i);function i(e,r,n,s){var u;return Object(a.a)(this,i),(u=t.call(this,e))._pointToCallbacks=new Map,u._layer=n,u._layerView=r,u._onUpdate=s,u}return Object(u.a)(i,[{key:"renderChildren",value:function(e){this.attributeView.update(),this.hasAnimation&&e.painter.effects.integrate.draw(e,e.attributeView),Object(o.a)(Object(c.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"isUpdating",value:function(){return this.attributeView.isUpdating()}},{key:"hitTest",value:function(e,t){var i=[e,t],r=Object(Y.h)();return this._pointToCallbacks.set(i,r),this.requestRender(),r.promise}},{key:"onTileData",value:function(e,t){var i=G&&"orderBy"in this._layer&&this._layer.orderBy,r=(null==i?void 0:i.length)&&!i[0].valueExpression&&i[0].field,n=i&&this._layerView.orderByFields===r;e.patch(t,n),this.contains(e)||this.addChild(e),this.requestRender()}},{key:"onTileError",value:function(e){this.contains(e)||this.addChild(e)}},{key:"doRender",value:function(e){var t=this._layer,r=t.minScale,n=t.maxScale,s=e.state.scale;s<=(r||1/0)&&s>=n&&Object(o.a)(Object(c.a)(i.prototype),"doRender",this).call(this,e)}},{key:"onAttributeStoreUpdate",value:function(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this._onUpdate()}},{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"hasLabels",get:function(){if("sublayers"in this._layer)return this._layer.sublayers.some((function(e){return e.labelingInfo&&e.labelingInfo.length&&e.labelsVisible}));var e=this._layer.featureReduction,t=e&&"cluster"===e.type&&e.labelsVisible&&e.labelingInfo&&e.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!t}},{key:"prepareRenderPasses",value:function(e){var t=this,r=e.registerRenderPass({name:"label",brushes:[K.a.label],target:function(){return t.hasLabels?t.children:null},drawPhase:m.c.LABEL|m.c.LABEL_ALPHA}),n=e.registerRenderPass({name:"geometry",brushes:[K.a.fill,K.a.line,K.a.marker,K.a.text],target:function(){return t.children},enableDefaultDraw:function(){return!t._layerView.hasEffects},effects:[{apply:e.effects.outsideEffect,enable:function(){return t._layerView.hasEffects},args:function(){return t._layerView.effectLists.excluded}},{apply:e.effects.insideEffect,enable:function(){return t._layerView.hasEffects},args:function(){return t._layerView.effectLists.included}},{apply:e.effects.hittest,enable:function(){return!!t._pointToCallbacks.size},args:function(){return t._pointToCallbacks}}]}),s=e.registerRenderPass({name:"highlight",brushes:[K.a.fill,K.a.line,K.a.marker,K.a.text],target:function(){return t.children},drawPhase:m.c.HIGHLIGHT,enableDefaultDraw:function(){return!1},effects:[{apply:e.effects.highlight,enable:function(){return!!t._layerView.hasHighlight()}}]});return[].concat(Object(N.a)(Object(o.a)(Object(c.a)(i.prototype),"prepareRenderPasses",this).call(this,e)),[n,s,r])}}]),i}(H.a),Z=function(e){Object(h.a)(i,e);var t=Object(l.a)(i);function i(){return Object(a.a)(this,i),t.apply(this,arguments)}return Object(u.a)(i,[{key:"install",value:function(e){var t=this,i=new X(this.tileInfoView,this.layerView,this.layer,(function(){return t.notifyChange("updating")}));this.featuresView=i,e.addChild(i)}},{key:"uninstall",value:function(e){e.removeChild(this.featuresView),this.featuresView.destroy()}},{key:"isUpdating",value:function(){var e=Object(o.a)(Object(c.a)(i.prototype),"isUpdating",this).call(this),t=!this.featuresView||this.featuresView.isUpdating(),r=e||t;return Object(d.a)("esri-2d-log-updating")&&console.log("Updating SymbolTileRenderer ".concat(r,"\n  -> updatingTiles ").concat(e,"\n  -> updatingFeaturesView ").concat(t)),r}},{key:"hitTest",value:function(e,t){return this.featuresView.hitTest(e,t)}},{key:"supportsRenderer",value:function(e){return null!=e&&-1!==["simple","class-breaks","unique-value","dot-density","dictionary"].indexOf(e.type)}},{key:"onConfigUpdate",value:function(e){var t=null;if("visualVariables"in e){var i=(Object(F.a)(e).visualVariables||[]).map((function(e){var t=e.clone();return"normalizationField"in e&&(t.normalizationField=null),e.valueExpression&&"$view.scale"!==e.valueExpression&&(t.valueExpression=null,t.field="nop"),t}));t=Object(q.a)(i)}this.featuresView.setRendererInfo(e,t,this.layerView.effects)}},{key:"onTileData",value:function(e){var t=this.tiles.get(e.tileKey);t&&e.data&&this.featuresView.onTileData(t,e.data),this.layerView.view.labelManager.requestUpdate()}},{key:"onTileError",value:function(e){var t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileError(t)}},{key:"forceAttributeTextureUpload",value:function(){this.featuresView.attributeView.forceTextureUpload()}},{key:"lockGPUUploads",value:function(){this.featuresView.attributeView.lockTextureUpload(),this.tiles.forEach((function(e){return e.lock()}))}},{key:"unlockGPUUploads",value:function(){this.featuresView.attributeView.unlockTextureUpload(),this.tiles.forEach((function(e){return e.unlock()}))}},{key:"getMaterialItems",value:function(){var e=Object(s.a)(n.a.mark((function e(t){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.featuresView.getMaterialItems(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"invalidateLabels",value:function(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()}},{key:"createTile",value:function(e){var t=this.tileInfoView.getTileBounds(Object(v.l)(),e);return new D(e,t[0],t[3],this.featuresView.attributeView)}},{key:"disposeTile",value:function(e){this.featuresView.removeChild(e),e.destroy(),this.layerView.view.labelManager.requestUpdate()}}]),i}(U.a),W=Z=Object(f.a)([Object(_.a)("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],Z)},902:function(e,t,i){"use strict";i.d(t,"a",(function(){return L}));var r=i(12),n=i(3),s=i(4),a=i(47),u=i(44),o=i(6),c=i(7),h=(i(17),i(2)),l=i(267),f=i(926),d=i(896),_=i(31),v=i(20),y=i(16),p=i(691),b=i(21),k=i(14),g=i(326),x=i(33),O=i(42),m=i(493),j=i(246),w=i(883),E=i(92),R=y.a.getLogger("esri.views.2d.engine.webgl.Mesh2D"),S=function(e,t,i,r){for(var n=0,s=1;s<i;s++){var a=e[2*(t+s-1)],u=e[2*(t+s-1)+1];n+=(e[2*(t+s)]-a)*(e[2*(t+s)+1]+u)}return r?n>0:n<0},T=function(e,t){for(var i=e.coords,n=e.lengths,s=[],a=0,u=0;a<n.length;u+=n[a],a+=1){for(var o=u,c=[];a<n.length-1&&S(i,u+n[a],n[a+1],t);u+=n[a+=1])c.push(u+n[a]-o);var h,l=i.slice(2*o,2*(u+n[a])),f=Object(g.a)(l,c,2),d=Object(r.a)(f);try{for(d.s();!(h=d.n()).done;){var _=h.value;s.push(_+o)}}catch(v){d.e(v)}finally{d.f()}}return s},C=function(){function e(t,i,r){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object(n.a)(this,e),this._cache={},this.vertices=t,this.indices=i,this.primitiveType=r,this.isMapSpace=s}return Object(s.a)(e,[{key:"destroy",value:function(){for(var e in Object(h.k)(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose(),this._cache.vertexBuffers)Object(h.k)(this._cache.vertexBuffers[e])&&this._cache.vertexBuffers[e].dispose()}},{key:"elementType",get:function(){return function(e){switch(e.BYTES_PER_ELEMENT){case 1:return 5121;case 2:return 5123;case 4:return 5125;default:throw new v.a("Cannot get DataType of array")}}(this.indices)}},{key:"getIndexBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:35044;return this._cache.indexBuffer||(this._cache.indexBuffer=E.a.createIndex(e,t,this.indices)),this._cache.indexBuffer}},{key:"getVertexBuffers",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:35044;return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce((function(r,n){return Object(k.a)(Object(k.a)({},r),{},Object(b.a)({},n,E.a.createVertex(e,i,t.vertices[n])))}),{})),this._cache.vertexBuffers}}],[{key:"fromRect",value:function(t){var i=t.x,r=t.y,n=i+t.width,s=r+t.height;return e.fromScreenExtent({xmin:i,ymin:r,xmax:n,ymax:s})}},{key:"fromPath",value:function(t){for(var i=Object(m.f)(new j.a,t.path,!1,!1),r=i.coords,n=new Uint32Array(T(i,!0)),s=new Uint32Array(r.length/2),a=0;a<s.length;a++)s[a]=Object(w.a)(Math.floor(r[2*a]),Math.floor(r[2*a+1]));return new e({geometry:s},n,4)}},{key:"fromGeometry",value:function(t,i){var r=i.geometry.type;switch(r){case"polygon":return e.fromPolygon(t,i.geometry);case"extent":return e.fromMapExtent(t,i.geometry);default:return R.error(new v.a("mapview-bad-type","Unable to create a mesh from type ".concat(r),i)),e.fromRect({x:0,y:0,width:1,height:1})}}},{key:"fromPolygon",value:function(t,i){for(var r=Object(m.g)(new j.a,i,!1,!1),n=r.coords,s=new Uint32Array(T(r,!1)),a=new Uint32Array(n.length/2),u=Object(O.b)(),o=Object(O.b)(),c=0;c<a.length;c++)Object(x.s)(u,n[2*c],n[2*c+1]),t.toScreen(o,u),a[c]=Object(w.a)(Math.floor(o[0]),Math.floor(o[1]));return new e({geometry:a},s,4,!0)}},{key:"fromScreenExtent",value:function(t){var i=t.xmin,r=t.xmax,n=t.ymin,s=t.ymax;return new e({geometry:new Uint32Array([Object(w.a)(i,n),Object(w.a)(r,n),Object(w.a)(i,s),Object(w.a)(i,s),Object(w.a)(r,n),Object(w.a)(r,s)])},new Uint32Array([0,1,2,3,4,5]),4)}},{key:"fromMapExtent",value:function(t,i){var r=t.toScreen([0,0],[i.xmin,i.ymin]),n=Object(_.a)(r,2),s=n[0],a=n[1],u=t.toScreen([0,0],[i.xmax,i.ymax]),o=Object(_.a)(u,2),c=o[0],h=o[1];return new e({geometry:new Uint32Array([Object(w.a)(s,a),Object(w.a)(c,a),Object(w.a)(s,h),Object(w.a)(s,h),Object(w.a)(c,a),Object(w.a)(c,h)])},new Uint32Array([0,1,2,3,4,5]),4)}}]),e}(),M=i(115),z=y.a.getLogger("esri.views.2d.engine.webgl.ClippingInfo"),I=function(e){return parseFloat(e)/100},A=function(e){Object(o.a)(i,e);var t=Object(c.a)(i);function i(e,r){var s;return Object(n.a)(this,i),(s=t.call(this))._clip=r,s._cache={},s.stage=e,s._handle=r.watch("version",(function(){return s._invalidate()})),s.ready(),s}return Object(s.a)(i,[{key:"_destroyGL",value:function(){Object(h.k)(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null),Object(h.k)(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)}},{key:"destroy",value:function(){this._destroyGL(),this._handle.remove()}},{key:"getVAO",value:function(e,t,i,r){var n=Object(_.a)(t.size,2),s=n[0],a=n[1];if("geometry"!==this._clip.type&&this._lastWidth===s&&this._lastHeight===a||(this._lastWidth=s,this._lastHeight=a,this._destroyGL()),Object(h.j)(this._cache.vao)){var u=this._createMesh(t,this._clip),o=u.getIndexBuffer(e),c=u.getVertexBuffers(e);this._cache.mesh=u,this._cache.vao=new M.a(e,i,r,c,o)}return this._cache.vao}},{key:"_createTransforms",value:function(){return{dvs:Object(l.b)()}}},{key:"_invalidate",value:function(){this._destroyGL(),this.requestRender()}},{key:"_createScreenRect",value:function(e,t){var i=Object(_.a)(e.size,2),r=i[0],n=i[1],s="string"==typeof t.left?I(t.left)*r:t.left,a="string"==typeof t.right?I(t.right)*r:t.right,u="string"==typeof t.top?I(t.top)*n:t.top,o="string"==typeof t.bottom?I(t.bottom)*n:t.bottom,c=s,h=u;return{x:c,y:h,width:Math.max(r-a-c,0),height:Math.max(n-o-h,0)}}},{key:"_createMesh",value:function(e,t){switch(t.type){case"rect":return C.fromRect(this._createScreenRect(e,t));case"path":return C.fromPath(t);case"geometry":return C.fromGeometry(e,t);default:return z.error(new v.a("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),C.fromRect({x:0,y:0,width:1,height:1})}}}],[{key:"fromClipArea",value:function(e,t){return new i(e,t)}}]),i}(p.a),V=i(882),L=function(e){Object(o.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).name=e.constructor.name,e}return Object(s.a)(i,[{key:"clips",set:function(e){this._clips=e,this.children.forEach((function(t){return t.clips=e})),this._updateClippingInfo()}},{key:"_createTransforms",value:function(){return{dvs:Object(l.b)()}}},{key:"doRender",value:function(e){var t=this.createRenderParams(e),i=t.painter,r=t.globalOpacity,n=t.profiler,s=t.drawPhase===V.c.LABEL?1:r*this.computedOpacity;n.recordContainerStart(this.name),i.beforeRenderLayer(t,this._clippingInfos?255:0,s),this.updateTransforms(e.state),this.renderChildren(t),i.compositeLayer(t,s),n.recordContainerEnd()}},{key:"renderChildren",value:function(e){Object(h.j)(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(e.painter));var t,i=Object(r.a)(this.children);try{for(i.s();!(t=i.n()).done;){t.value.beforeRender(e)}}catch(c){i.e(c)}finally{i.f()}var n,s=Object(r.a)(this._renderPasses);try{for(s.s();!(n=s.n()).done;){var a=n.value;try{a.render(e)}catch(l){}}}catch(c){s.e(c)}finally{s.f()}var u,o=Object(r.a)(this.children);try{for(o.s();!(u=o.n()).done;){u.value.afterRender(e)}}catch(c){o.e(c)}finally{o.f()}}},{key:"createRenderParams",value:function(e){return e.requireFBO=this.requiresDedicatedFBO,e}},{key:"prepareRenderPasses",value:function(e){var t=this;return[e.registerRenderPass({name:"clip",brushes:[f.a.clip],target:function(){return t._clippingInfos},drawPhase:V.c.MAP|V.c.LABEL|V.c.LABEL_ALPHA|V.c.DEBUG|V.c.HIGHLIGHT})]}},{key:"updateTransforms",value:function(e){var t,i=Object(r.a)(this.children);try{for(i.s();!(t=i.n()).done;){t.value.setTransform(e)}}catch(n){i.e(n)}finally{i.f()}}},{key:"onAttach",value:function(){Object(a.a)(Object(u.a)(i.prototype),"onAttach",this).call(this),this._updateClippingInfo()}},{key:"onDetach",value:function(){Object(a.a)(Object(u.a)(i.prototype),"onDetach",this).call(this),this._updateClippingInfo()}},{key:"_updateClippingInfo",value:function(){var e=this;if(Object(h.k)(this._clippingInfos)&&(this._clippingInfos.forEach((function(e){return e.destroy()})),this._clippingInfos=null),this.stage){var t=this._clips;Object(h.k)(t)&&t.length&&(this._clippingInfos=t.items.map((function(t){return A.fromClipArea(e.stage,t)}))),this.requestRender()}}}]),i}(d.a)},913:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));var r=function(e,t){return e&&function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return t.warn.apply(t,["DEBUG:"].concat(i))}||function(){return null}},n=!1},924:function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var r=i(12),n=i(3),s=i(4),a=i(47),u=i(44),o=i(6),c=i(7),h=i(17),l=i(882),f=i(902),d=i(977),_=i(972),v=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},y=function(e){Object(o.a)(i,e);var t=Object(c.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this))._tileInfoView=e,r}return Object(s.a)(i,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(v),this.setStencilReference(),Object(a.a)(Object(u.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,r=Object(a.a)(Object(u.a)(i.prototype),"createRenderParams",this).call(this,e);return r.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,r.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),r}},{key:"prepareRenderPasses",value:function(e){var t=this,r=Object(a.a)(Object(u.a)(i.prototype),"prepareRenderPasses",this).call(this,e);return r.push(e.registerRenderPass({name:"stencil",brushes:[_.a],drawPhase:l.c.DEBUG|l.c.MAP|l.c.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),Object(h.a)("esri-tiles-debug")&&r.push(e.registerRenderPass({name:"tileInfo",brushes:[d.a],drawPhase:l.c.DEBUG,target:function(){return t.children}})),r}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,i=Object(r.a)(this.children);try{for(i.s();!(t=i.n()).done;){var n=t.value,s=this._tileInfoView.getTileResolution(n.key);n.setTransform(e,s)}}catch(a){i.e(a)}finally{i.f()}}},{key:"setStencilReference",value:function(){var e,t=1,i=Object(r.a)(this.children);try{for(i.s();!(e=i.n()).done;){e.value.stencilRef=t++}}catch(n){i.e(n)}finally{i.f()}}}]),i}(f.a)},939:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return l}));var r=i(14),n=i(12),s=i(2),a=i(30),u=i(886),o=i(881),c=i(882),h=i(900);function l(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function f(e){return e.map((function(e){return function(e){return{value:e.value,size:Object(a.j)(e.size)}}(e)}))}function d(e){if("string"==typeof e||"number"==typeof e)return Object(a.j)(e);var t=e;return{type:"size",expression:t.expression,stops:f(t.stops)}}var _=function(e){for(var t=[],i=[],r=f(e),n=r.length,s=0;s<6;s++){var u=r[Math.min(s,n-1)];t.push(u.value),i.push(null==u.size?o.m:Object(a.g)(u.size))}return{values:new Float32Array(t),sizes:new Float32Array(i)}};function v(e){var t=e&&e.length>0?{}:null,i=t?{}:null;if(!t)return{vvFields:t,vvRanges:i};var s,a=Object(n.a)(e);try{for(a.s();!(s=a.n()).done;){var u=s.value;if(u.field&&(t[u.type]=u.field),"size"===u.type){i.size||(i.size={});var o=u;switch(Object(h.a)(o)){case c.e.SIZE_MINMAX_VALUE:i.size.minMaxValue={minDataValue:o.minDataValue,maxDataValue:o.maxDataValue,minSize:d(o.minSize),maxSize:d(o.maxSize)};break;case c.e.SIZE_SCALE_STOPS:i.size.scaleStops={stops:f(o.stops)};break;case c.e.SIZE_FIELD_STOPS:if(o.levels){var l={};for(var v in o.levels)l[v]=_(o.levels[v]);i.size.fieldStops={type:"level-dependent",levels:l}}else i.size.fieldStops=Object(r.a)({type:"static"},_(o.stops));break;case c.e.SIZE_UNIT_VALUE:i.size.unitValue={unit:o.valueUnit,valueRepresentation:o.valueRepresentation}}}else if("color"===u.type)i.color=b(u);else if("opacity"===u.type)i.opacity=y(u);else if("rotation"===u.type){var p=u;i.rotation={type:p.rotationType}}}}catch(k){a.e(k)}finally{a.f()}return{vvFields:t,vvRanges:i}}function y(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;for(var i=e.stops,r=0;r<8;++r){var n=i[Math.min(r,i.length-1)];t.values[r]=n.value,t.opacities[r]=n.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var s=e.stops&&e.stops.length>=0&&e.stops[0].opacity,a=0;a<8;a++)t.values[a]=1/0,t.opacities[a]=s}return t}function p(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function b(e){if(Object(s.j)(e))return null;if(e.normalizationField)return null;var t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;t.field=e.field;for(var i=e.stops,r=0;r<8;++r){var n=i[Math.min(r,i.length-1)];t.values[r]=n.value,p(t.colors,r,n.color)}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var a=e.stops&&e.stops.length>=0&&e.stops[0].color,o=0;o<8;o++)t.values[o]=1/0,p(t.colors,o,a)}for(var c=0;c<32;c+=4)Object(u.b)(t.colors,c,!0);return t}},949:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i(31),n=i(47),s=i(44),a=i(6),u=i(7),o=i(3),c=i(4),h=i(145),l=i(70),f=i(267),d=i(33),_=i(283),v=i(881),y=i(700),p=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"acquire",value:function(e){return{refCount:1,version:-1,labelMat2d:Object(f.b)(),tileMat3:Object(f.b)(),dvs:Object(f.b)()}}},{key:"release",value:function(e){}}]),e}(),b=function(e){Object(a.a)(i,e);var t=Object(u.a)(i);function i(e,r,n){return Object(o.a)(this,i),t.call(this,e,r,n,v.D,v.D)}return Object(c.a)(i,[{key:"destroy",value:function(){Object(n.a)(Object(s.a)(i.prototype),"destroy",this).call(this),this._transforms&&i.TransformCache.release(this.key.hash)}},{key:"setTransform",value:function(e,t){if(e.version!==this.transforms.version){this.transforms.version=e.version;var i=t/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,s=e.toScreenNoRotation([0,0],[this.x,this.y]),a=Object(r.a)(s,2),u=a[0],o=a[1],c=this.width/this.rangeX*i,f=this.height/this.rangeY*i;Object(l.n)(n,c,0,0,0,f,0,u,o,1),Object(l.k)(this.transforms.dvs,e.displayViewMat3,n);var v=this.transforms.labelMat2d,y=e.getScreenTransform(v,t),p=Object(_.a)();Object(d.t)(p,[this.x,this.y],y),Object(h.d)(v),Object(h.h)(v,v,p),Object(h.e)(v,e.viewMat2d,v)}}},{key:"_createTransforms",value:function(){return i.TransformCache.acquire(this.key.hash)}}]),i}(y.a);b.TransformCache=new p},950:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(3),n=i(4),s=i(2),a=i(881),u=2147483647,o=function(){function e(t){Object(r.a)(this,e),this._head=t,this._cursor=t}return Object(n.a)(e,[{key:"size",value:function(){for(var e=this._cursor,t=0;e;)t+=e.size(),e=e._link;return t}},{key:"id",get:function(){return this._cursor.id},set:function(e){this._cursor.id=e}},{key:"materialKey",get:function(){return this._cursor.materialKey},set:function(e){this._cursor.materialKey=e}},{key:"insertAfter",get:function(){return this._cursor.insertAfter}},{key:"indexFrom",get:function(){return this._cursor.indexFrom},set:function(e){this._cursor.indexFrom=e}},{key:"indexCount",get:function(){return this._cursor.indexCount},set:function(e){this._cursor.indexCount=e}},{key:"vertexFrom",get:function(){return this._cursor.vertexFrom},set:function(e){this._cursor.vertexFrom=e}},{key:"vertexCount",get:function(){return this._cursor.vertexCount},set:function(e){this._cursor.vertexCount=e}},{key:"sortKey",get:function(){return this._cursor.sortKey},set:function(e){this._cursor.sortKey=e}},{key:"index",get:function(){return this._cursor._indexStart+this._cursor._index}},{key:"seekIndex",value:function(e){var t=e;for(this._cursor=this._head;this._cursor;){var i=this._cursor.size();if(t<i)return this._cursor._index=t,!0;t-=i,this._cursor=this._cursor._link}return!1}},{key:"forEach",value:function(e){for(var t=this.getCursor();t.next();)e(t)}},{key:"link",value:function(e){if(this._head){for(var t=this._head;t._link;)t=t._link;t._link=e._head,t._link._indexStart=t._indexStart+t.size()}else this._head=e._head}},{key:"getCursor",value:function(){return this.copy()}},{key:"lookup",value:function(e){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(e);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}},{key:"copy",value:function(){var t,i=new e(null==(t=this._head)?void 0:t.copy());if(!i._head)return i;for(var r=i._head,n=i._head._link;n;)r._link=n.copy(),n=(r=n)._link;return i}},{key:"next",value:function(){return!!this._cursor&&(!!this._cursor.next()||!!this._cursor._link&&(this._cursor=this._cursor._link,this.next()))}},{key:"peekId",value:function(){var e;return null!=(e=this._cursor.peekId())?e:this._cursor._link.peekId()}},{key:"delete",value:function(e){for(var t=this._head,i=null;t;){if(t.delete(e))return t.isEmpty()&&(Object(s.k)(i)&&(i._link=t._link),t===this._head&&(this._head=t._link),t===this._cursor&&(this._cursor=t._link)),!0;i=t,t=t._link}return!1}}],[{key:"from",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.byteLength/c.BYTES_PER_RECORD-i,n=new c(new Int32Array(t,i*c.BYTES_PER_RECORD,r*c.ELEMENTS_PER_RECORD));return new e(n)}}]),e}();o.ELEMENTS_PER_RECORD=a.d,o.BYTES_PER_RECORD=o.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT;var c=function(){function e(t){Object(r.a)(this,e),this._link=null,this._index=-1,this._indexStart=0,this._deletedCount=0,this._offsets={instance:null},this._packedRecords=t}return Object(n.a)(e,[{key:"delete",value:function(e){var t=this._index,i=this.lookup(e);if(i)for(this.id=u,++this._deletedCount;this.next()&&this.id===e;)this.id=u,++this._deletedCount;return this._index=t,i}},{key:"isEmpty",value:function(){return this._deletedCount===this.size()}},{key:"link",value:function(e){this._link?this._link.link(e):this._link=e}},{key:"lookup",value:function(e){if(Object(s.j)(this._offsets.instance)){this._offsets.instance=new Map;var t=this.copy();t._index=-1;for(var i=0;t.next();)t.id!==i&&(this._offsets.instance.set(t.id,t._index),i=t.id)}if(!this._offsets.instance.has(e))return!1;var r=this._index;return this._index=this._offsets.instance.get(e),this.id!==u||(this._index=r,!1)}},{key:"id",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD]=t}},{key:"materialKey",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+1]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+1]=t}},{key:"insertAfter",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+2]}},{key:"indexFrom",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+3]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+3]=t}},{key:"indexCount",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+4]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+4]=t}},{key:"vertexFrom",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+5]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+5]=t}},{key:"vertexCount",get:function(){return this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+6]},set:function(t){this._packedRecords[this._index*e.ELEMENTS_PER_RECORD+6]=t}},{key:"sortKey",get:function(){return this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*e.ELEMENTS_PER_RECORD+7]},set:function(t){this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*e.ELEMENTS_PER_RECORD+7]=t}},{key:"index",get:function(){return this._index}},{key:"size",value:function(){return this._packedRecords.length/e.ELEMENTS_PER_RECORD}},{key:"next",value:function(){for(;++this._index<this.size()&&this.id===u;);return this._index<this.size()}},{key:"peekId",value:function(){var t=(this._index+1)*e.ELEMENTS_PER_RECORD;return t>=this._packedRecords.length?0:this._packedRecords[t]}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this._packedRecords);return t._indexStart=this._indexStart,t._link=this._link,t._index=this._index,t._offsets=this._offsets,t._deletedCount=this._deletedCount,t}}],[{key:"from",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.byteLength/this.BYTES_PER_RECORD-i;return new e(new Int32Array(t,i*this.BYTES_PER_RECORD,r*this.ELEMENTS_PER_RECORD))}}]),e}();c.ELEMENTS_PER_RECORD=a.d,c.BYTES_PER_RECORD=c.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT},955:function(e,t,i){"use strict";i.d(t,"a",(function(){return P}));var r=i(12),n=i(8),s=i.n(n),a=i(15),u=i(3),o=i(4),c=i(47),h=i(44),l=i(6),f=i(7),d=i(23),_=i(500),v=i(20),y=i(17),p=i(16),b=i(2),k=(i(92),i(113)),g=(i(142),i(129),i(284),i(40),i(65)),x=(i(115),i(881)),O=i(885),m=i(913),j=p.a.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),w=Object(m.b)(m.a,j),E=function(e){return 2147483647&e},R=function(){function e(t,i,r){Object(u.a)(this,e),this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;var n=t.buffer,s=t.pixelType,a=t.textureOnly,o=Object(O.j)(s);this.shared=r,this.pixelType=s,this.size=i,this.textureOnly=a,a||(this.data=new o(Object(b.t)(n))),this._resetRange()}return Object(o.a)(e,[{key:"destroy",value:function(){var e=this;Object(b.b)(this._texture,(function(e){return e.dispose()}));var t=function(t){Object(b.b)(e._fbos[t],(function(e){"0"===t&&e.detachColorTexture(),e.dispose()})),e._fbos[t]=null};for(var i in this._fbos)t(i);this._texture=null}},{key:"_textureDesc",get:function(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}}},{key:"setData",value:function(e,t,i){var r=E(e),n=Object(b.t)(this.data),s=r*this.texelSize+t;!n||s>=n.length||(n[s]=i,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r))}},{key:"getData",value:function(e,t){if(Object(b.j)(this.data))return null;var i=E(e)*this.texelSize+t;return!this.data||i>=this.data.length?null:this.data[i]}},{key:"getTexture",value:function(e){var t=this;return Object(b.u)(this._texture,(function(){return t._initTexture(e)}))}},{key:"getFBO",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(Object(b.j)(this._fbos[t])){var i={colorTarget:0,depthStencilTarget:0},r=0===t?this.getTexture(e):this._textureDesc;this._fbos[t]=new k.a(e,i,r)}return this._fbos[t]}},{key:"locked",get:function(){return!(5121!==this.pixelType||!this.shared||this.textureOnly||!Object(y.a)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}},{key:"hasDirty",get:function(){var e=this.dirtyStart;return this.dirtyEnd>=e}},{key:"updateTexture",value:function(e,t){if(!this.locked){try{var i=this.dirtyStart,r=this.dirtyEnd;if(!this.hasDirty)return;this._resetRange();var n=Object(b.t)(this.data).buffer,s=this.getTexture(e),a=(i-i%this.size)/this.size,u=(r-r%this.size)/this.size,o=a,c=this.size,h=u,l=a*this.size*4,f=4*(c+h*this.size)-l,d=Object(O.j)(this.pixelType),_=new d(n,l*d.BYTES_PER_ELEMENT,f),y=this.size,p=h-o+1;if(p>this.size)return void j.error(new v.a("mapview-webgl","Out-of-bounds index when updating AttributeData"));s.updateData(0,0,o,y,p,_)}catch(k){}t()}}},{key:"update",value:function(e){var t=e.data,i=e.start,r=e.end;if(Object(b.k)(t))for(var n=this.data,s=i*this.texelSize,a=0;a<t.length;a++){var u=1<<a%this.texelSize;e.layout&u&&(n[s+a]=t[a])}this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,r)}},{key:"resize",value:function(e,t){var i=this.size;if(this.size=t,this.textureOnly)i!==this.size&&(this._lastTexture=this._texture,this._texture=null);else{var r=Object(O.j)(this.pixelType);this.destroy(),this.data=new r(Object(b.t)(e.buffer))}}},{key:"_resetRange",value:function(){this.dirtyStart=2147483647,this.dirtyEnd=0}},{key:"_initTexture",value:function(e){var t=new g.a(e,this._textureDesc,Object(b.u)(this.data,void 0));if(Object(b.k)(this._lastTexture)&&this._fbos[0]){var i=this._lastTexture.descriptor.width,r=this._lastTexture.descriptor.height,n=this._lastTexture.descriptor.dataType,s=this._lastTexture.descriptor.pixelFormat,a=this.getFBO(e),u=Object(O.k)(n),o=new(Object(O.j)(n))(new ArrayBuffer(i*r*u*this.texelSize)),c=e.getBoundFramebufferObject(),h=e.getViewport(),l=h.x,f=h.y,d=h.width,_=h.height;e.bindFramebuffer(a),a.readPixels(0,0,i,r,s,n,o),t.updateData(0,0,0,2*i,r/2,o),e.setViewport(l,f,d,_),e.bindFramebuffer(c)}return this.destroy(),this._texture=t,this._texture}}]),e}(),S=function(){function e(t){Object(u.a)(this,e),this._onUpdate=t,this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}return Object(o.a)(e,[{key:"initialize",value:function(e){var t=e.blocks,i=e.shared,r=e.size;if(this.shared=i,this.size=r,w("Initializing AttributeStoreView",e),Object(b.j)(this._data))this._data=Object(b.m)(t,(function(e){return new R(e,r,i)}));else for(var n=0;n<this._data.length;n++){var s=this._data[n],a=t[n];Object(b.k)(a)&&(Object(b.j)(s)?this._data[n]=new R(a,r,i):s.resize(a,r))}this._initialized=!0}},{key:"destroy",value:function(){Object(b.b)(this._data,(function(e){return Object(b.m)(e,(function(e){return e.destroy()}))})),Object(b.b)(this._defaultTexture,(function(e){return e.dispose()}))}},{key:"isUpdating",value:function(){var e=this._data;if(Object(b.j)(e))return!0;var t=Object(b.k)(this._pendingAttributeUpdate),i=t;return Object(y.a)("esri-2d-log-updating")&&console.log("Updating AttributeStoreView ".concat(i,"\n  -> hasPendingUpdate ").concat(t)),i}},{key:"getBlock",value:function(e){return Object(b.j)(this._data)?null:this._data[e]}},{key:"setLabelMinZoom",value:function(e,t){this.setData(e,0,1,t)}},{key:"getLabelMinZoom",value:function(e){return this.getData(e,0,1,255)}},{key:"getFilterFlags",value:function(e){return this.getData(e,0,0,0)}},{key:"getVVSize",value:function(e){return this.getData(e,x.b,0,0)}},{key:"getData",value:function(e,t,i,r){if(!this._data)return 0;var n=Object(b.t)(this._data)[t];if(Object(b.j)(n))return 0;var s=n.getData(e,i);return Object(b.k)(s)?s:r}},{key:"setData",value:function(e,t,i,r){var n=Object(b.t)(this._data)[t];Object(b.t)(n).setData(e,i,r)}},{key:"lockTextureUpload",value:function(){this._locked=!0}},{key:"unlockTextureUpload",value:function(){this._locked=!1}},{key:"forceTextureUpload",value:function(){this._forceNextUpload=!0}},{key:"requestUpdate",value:function(){var e=Object(a.a)(s.a.mark((function e(t){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._pendingAttributeUpdate){e.next=2;break}return e.abrupt("return",void j.error(new v.a("mapview-webgl","Tried to update attribute data with a pending update")));case 2:return i=Object(d.h)(),e.abrupt("return",(w("AttributeStoreView Update Requested",t),this._pendingAttributeUpdate={data:t,resolver:i},i.promise));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){if(this._initialized&&Object(b.k)(this._pendingAttributeUpdate)){for(var e=this._pendingAttributeUpdate,t=e.data,i=e.resolver,r=Object(b.t)(this._data),n=function(e){var i=t.blocks[e],n=r[e];Object(b.b)(n,(function(t){return Object(b.b)(i,(function(i){w("Updating block ".concat(e),i),t.update(i)}))}))},s=0;s<t.blocks.length;s++)n(s);this._pendingAttributeUpdate=null,i(),this._onUpdate()}}},{key:"bindTextures",value:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.update();var r=this._getDefaultTexture(e);if(!this._initialized)return e.bindTexture(r,x.q),void(i&&(e.bindTexture(r,x.r),e.bindTexture(r,x.s),e.bindTexture(r,x.t)));var n=Object(b.t)(this._data);this._locked&&!this._forceNextUpload||(Object(b.h)(n,(function(i){return i.updateTexture(e,(function(){return t._onUpdate()}))})),this._forceNextUpload=!1),e.bindTexture(Object(b.n)(n[0],r,(function(t){return t.getTexture(e)})),x.q),i&&(e.bindTexture(Object(b.n)(n[1],r,(function(t){return t.getTexture(e)})),x.r),e.bindTexture(Object(b.n)(n[2],r,(function(t){return t.getTexture(e)})),x.s),e.bindTexture(Object(b.n)(n[3],r,(function(t){return t.getTexture(e)})),x.t))}},{key:"_getDefaultTexture",value:function(e){if(Object(b.j)(this._defaultTexture)){this._defaultTexture=new g.a(e,{wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array(4))}return this._defaultTexture}}]),e}(),T=i(924),C=i(39),M=i(30),z=i(79),I=i(361),A=i(690);function V(e,t){var i=t.length;if(e<t[0].value||1===i)return t[0].size;for(var r=1;r<i;r++)if(e<t[r].value){var n=(e-t[r-1].value)/(t[r].value-t[r-1].value);return t[r-1].size+n*(t[r].size-t[r-1].size)}return t[i-1].size}function L(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(Object(b.j)(t))return e[i+0]=0,e[i+1]=0,e[i+2]=0,void(e[i+3]=0);var r=t.r,n=t.g,s=t.b,a=t.a;e[i+0]=r*a/255,e[i+1]=n*a/255,e[i+2]=s*a/255,e[i+3]=a}var B=function(){function e(){Object(u.a)(this,e),this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.ddColors=new Float32Array(32),this.ddBackgroundColor=new Float32Array(4),this.ddActiveDots=new Float32Array(8),this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1}}return Object(o.a)(e,[{key:"getSizeVVFieldStops",value:function(e){var t=this._vvSizeFieldStops;switch(t.type){case"static":return t;case"level-dependent":return Object(b.u)(t.levels[e],(function(){var i=1/0,r=0;for(var n in t.levels){var s=parseFloat(n),a=Math.abs(e-s);a<i&&(i=a,r=s)}if(i===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};var u=Math.pow(2,(e-r)/2),o=Object(b.t)(t.levels[r]),c=new Float32Array(o.values);return c[2]*=u,c[3]*=u,{sizes:Object(b.t)(o.sizes),values:c}}))}}},{key:"vvMaterialParameters",get:function(){return this._vvMaterialParameters}},{key:"update",value:function(e){Object(b.k)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}},{key:"setInfo",value:function(e,t,i){var r=this;Object(b.k)(i)&&i.forEach((function(e){return r._updateEffects(e)})),this._vvInfo=t,"dot-density"===e.type&&this._updateDotDensityInfo(e)}},{key:"getVariation",value:function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,oesTextureFloat:Object(A.a)().supportsTextureFloat}}},{key:"getVariationHash",value:function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1}},{key:"_updateEffects",value:function(e){Object(b.k)(e)&&e.filter&&e.filter.enabled&&(this.outsideLabelsVisible=e.excludedLabelsVisible)}},{key:"_updateVisualVariables",value:function(e,t){var i=this._vvMaterialParameters;if(i.vvOpacityEnabled=!1,i.vvSizeEnabled=!1,i.vvColorEnabled=!1,i.vvRotationEnabled=!1,e){var r=e.size;if(r){if(i.vvSizeEnabled=!0,r.minMaxValue){var n,s,a=r.minMaxValue;if(Object(O.n)(a.minSize)&&Object(O.n)(a.maxSize))if(Object(O.o)(a.minSize)&&Object(O.o)(a.maxSize))n=Object(M.g)(a.minSize),s=Object(M.g)(a.maxSize);else{var u=t.scale;n=Object(M.g)(V(u,a.minSize.stops)),s=Object(M.g)(V(u,a.maxSize.stops))}this.vvSizeMinMaxValue.set([a.minDataValue,a.maxDataValue,n,s])}if(r.scaleStops&&(this.vvSizeScaleStopsValue=Object(M.g)(V(t.scale,r.scaleStops.stops))),r.unitValue){var o=Object(z.f)(t.spatialReference)/I.a[r.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=o/t.resolution}r.fieldStops&&(this._vvSizeFieldStops=r.fieldStops)}var c=e.color;c&&(i.vvColorEnabled=!0,this.vvColorValues.set(c.values),this.vvColors.set(c.colors));var h=e.opacity;h&&(i.vvOpacityEnabled=!0,this.vvOpacityValues.set(h.values),this.vvOpacities.set(h.opacities));var l=e.rotation;l&&(i.vvRotationEnabled=!0,i.vvRotationType=l.type)}}},{key:"_updateDotDensityInfo",value:function(e){var t=e.attributes;this.ddDotValue=e.dotValue,this.ddDotScale=e.referenceScale,this.ddDotSize=e.dotSize,this.ddDotBlending=e.dotBlendingEnabled,this.ddSeed=e.seed;for(var i=0;i<x.e;i++){var r=i>=t.length?new C.a([0,0,0,0]):t[i].color;L(this.ddColors,r,4*i)}for(var n=0;n<8;n++)this.ddActiveDots[n]=n<e.attributes.length?1:0;L(this.ddBackgroundColor,e.backgroundColor)}}]),e}(),P=function(e){Object(l.a)(i,e);var t=Object(f.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this,e))._rendererInfo=new B,r._materialItemsRequestQueue=new _.a,r.attributeView=new S((function(){return r.onAttributeStoreUpdate()})),r}return Object(o.a)(i,[{key:"destroy",value:function(){this.removeAllChildren(),this.children.forEach((function(e){return e.destroy()})),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}},{key:"setRendererInfo",value:function(e,t,i){this._rendererInfo.setInfo(e,t,i),this.requestRender()}},{key:"getMaterialItems",value:function(){var e=Object(a.a)(s.a.mark((function e(t,i){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&0!==t.length){e.next=2;break}return e.abrupt("return",null);case 2:return r=Object(d.h)(),e.abrupt("return",(this._materialItemsRequestQueue.push({items:t,abortOptions:i,resolver:r}),this.requestRender(),r.promise));case 4:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"doRender",value:function(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0)for(var t=this._materialItemsRequestQueue.pop();t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop();Object(c.a)(Object(h.a)(i.prototype),"doRender",this).call(this,e)}},{key:"renderChildren",value:function(e){var t,n=Object(r.a)(this.children);try{for(n.s();!(t=n.n()).done;){t.value.commit(e)}}catch(s){n.e(s)}finally{n.f()}this._rendererInfo.update(e.state),Object(c.a)(Object(h.a)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=Object(c.a)(Object(h.a)(i.prototype),"createRenderParams",this).call(this,e);return t.rendererInfo=this._rendererInfo,t.attributeView=this.attributeView,t}},{key:"onAttributeStoreUpdate",value:function(){}},{key:"_processMaterialItemRequest",value:function(e,t){var i=this,r=t.items,n=t.abortOptions,s=t.resolver,a=e.painter,u=e.pixelRatio,o=r.map((function(e){return a.textureManager.rasterizeItem(e.symbol,u,e.glyphIds,n)}));Promise.all(o).then((function(e){if(i.stage){var t=e.map((function(e,t){return{id:r[t].id,mosaicItem:e}}));s.resolve(t)}else s.reject()}),s.reject)}}]),i}(T.a)},992:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i(12),n=i(3),s=i(4),a=i(2),u=function(){function e(t){Object(n.a)(this,e),this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}return Object(s.a)(e,[{key:"entries",get:function(){return this._buffer}},{key:"enqueue",value:function(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}},{key:"dequeue",value:function(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}},{key:"peek",value:function(){return 0===this.size?null:this._buffer[this._start]}},{key:"find",value:function(e){if(0===this.size)return null;var t,i=Object(r.a)(this._buffer);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(Object(a.k)(n)&&e(n))return n}}catch(s){i.e(s)}finally{i.f()}return null}},{key:"clear",value:function(e){for(var t=this.dequeue();Object(a.k)(t);)e&&e(t),t=this.dequeue()}}]),e}()}}]);
//# sourceMappingURL=77.5c4d5374.chunk.js.map