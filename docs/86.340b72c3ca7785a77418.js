(function(){var e={"esri/geometry/geometryEngineAsync":1484,"esri/arcade/functions/geomasync":1693,"esri/arcade/arcadeAsyncRuntime":2054},n=this||window,t=n.webpackJsonp=n.webpackJsonp||[];t.registerAbsMids?t.registerAbsMids(e):(t.absMidsWaiting=t.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[86,95],{1484:function(e,n,t){var r,o;r=[t.dj.c(e.i),n,t(0),t(28),t(238)],void 0===(o=function(e,n,t,r,o){function a(e){var n;return Array.isArray(e)?null===(n=e[0])||void 0===n?void 0:n.spatialReference:null==e?void 0:e.spatialReference}function i(e){return e?Array.isArray(e)?e.map(i):e.toJSON?e.toJSON():e:e}function u(e){return Array.isArray(e)?e.map((function(e){return r.fromJSON(e)})):r.fromJSON(e)}var c;function s(){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(e){return c||(c=o.open("geometryEngineWorker",{strategy:"distributed"})),[2,c]}))}))}function l(e,n){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,s()];case 1:return[2,t.sent().invoke("executeGEOperation",{operation:e,parameters:i(n)})]}}))}))}function f(e){return"xmin"in e?e.center:"x"in e?e:e.extent.center}Object.defineProperty(n,"__esModule",{value:!0}),n.extendedSpatialReferenceInfo=function(e){return l("extendedSpatialReferenceInfo",[e])},n.clip=function(e,n){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("clip",[a(e),e,n])];case 1:return[2,u(t.sent())]}}))}))},n.cut=function(e,n){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("cut",[a(e),e,n])];case 1:return[2,u(t.sent())]}}))}))},n.contains=function(e,n){return l("contains",[a(e),e,n])},n.crosses=function(e,n){return l("crosses",[a(e),e,n])},n.distance=function(e,n,t){return l("distance",[a(e),e,n,t])},n.equals=function(e,n){return l("equals",[a(e),e,n])},n.intersects=function(e,n){return l("intersects",[a(e),e,n])},n.touches=function(e,n){return l("touches",[a(e),e,n])},n.within=function(e,n){return l("within",[a(e),e,n])},n.disjoint=function(e,n){return l("disjoint",[a(e),e,n])},n.overlaps=function(e,n){return l("overlaps",[a(e),e,n])},n.relate=function(e,n,t){return l("relate",[a(e),e,n,t])},n.isSimple=function(e){return l("isSimple",[a(e),e])},n.simplify=function(e){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(n){switch(n.label){case 0:return[4,l("simplify",[a(e),e])];case 1:return[2,u(n.sent())]}}))}))},n.convexHull=function(e,n){return void 0===n&&(n=!1),t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("convexHull",[a(e),e,n])];case 1:return[2,u(t.sent())]}}))}))},n.difference=function(e,n){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("difference",[a(e),e,n])];case 1:return[2,u(t.sent())]}}))}))},n.symmetricDifference=function(e,n){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("symmetricDifference",[a(e),e,n])];case 1:return[2,u(t.sent())]}}))}))},n.intersect=function(e,n){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("intersect",[a(e),e,n])];case 1:return[2,u(t.sent())]}}))}))},n.union=function(e,n){return void 0===n&&(n=null),t.__awaiter(this,void 0,void 0,(function(){var r;return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("union",[a(r=function(e,n){var t;return Array.isArray(e)?t=e:((t=[]).push(e),null!=n&&t.push(n)),t}(e,n)),r])];case 1:return[2,u(t.sent())]}}))}))},n.offset=function(e,n,r,o,i,c){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("offset",[a(e),e,n,r,o,i,c])];case 1:return[2,u(t.sent())]}}))}))},n.buffer=function(e,n,r,o){return void 0===o&&(o=!1),t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("buffer",[a(e),e,n,r,o])];case 1:return[2,u(t.sent())]}}))}))},n.geodesicBuffer=function(e,n,r,o,i,c){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("geodesicBuffer",[a(e),e,n,r,o,i,c])];case 1:return[2,u(t.sent())]}}))}))},n.nearestCoordinate=function(e,n,o){return void 0===o&&(o=!0),t.__awaiter(this,void 0,void 0,(function(){var i;return t.__generator(this,(function(u){switch(u.label){case 0:return[4,l("nearestCoordinate",[a(e),e,n,o])];case 1:return i=u.sent(),[2,t.__assign(t.__assign({},i),{coordinate:r.Point.fromJSON(i.coordinate)})]}}))}))},n.nearestVertex=function(e,n){return t.__awaiter(this,void 0,void 0,(function(){var o;return t.__generator(this,(function(i){switch(i.label){case 0:return[4,l("nearestVertex",[a(e),e,n])];case 1:return o=i.sent(),[2,t.__assign(t.__assign({},o),{coordinate:r.Point.fromJSON(o.coordinate)})]}}))}))},n.nearestVertices=function(e,n,o,i){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(u){switch(u.label){case 0:return[4,l("nearestVertices",[a(e),e,n,o,i])];case 1:return[2,u.sent().map((function(e){return t.__assign(t.__assign({},e),{coordinate:r.Point.fromJSON(e.coordinate)})}))]}}))}))},n.rotate=function(e,n,r){return t.__awaiter(this,void 0,void 0,(function(){var o,a,i,u;return t.__generator(this,(function(t){switch(t.label){case 0:if(null==e)throw new Error("Illegal Argument Exception");return o=e.spatialReference,r=null!=r?r:f(e),u=(i=e.constructor).fromJSON,[4,l("rotate",[o,e,n,r])];case 1:return(a=u.apply(i,[t.sent()])).spatialReference=o,[2,a]}}))}))},n.flipHorizontal=function(e,n){return t.__awaiter(this,void 0,void 0,(function(){var r,o,a,i;return t.__generator(this,(function(t){switch(t.label){case 0:if(null==e)throw new Error("Illegal Argument Exception");return r=e.spatialReference,n=null!=n?n:f(e),i=(a=e.constructor).fromJSON,[4,l("flipHorizontal",[r,e,n])];case 1:return(o=i.apply(a,[t.sent()])).spatialReference=r,[2,o]}}))}))},n.flipVertical=function(e,n){return t.__awaiter(this,void 0,void 0,(function(){var r,o,a,i;return t.__generator(this,(function(t){switch(t.label){case 0:if(null==e)throw new Error("Illegal Argument Exception");return r=e.spatialReference,n=null!=n?n:f(e),i=(a=e.constructor).fromJSON,[4,l("flipVertical",[r,e,n])];case 1:return(o=i.apply(a,[t.sent()])).spatialReference=r,[2,o]}}))}))},n.generalize=function(e,n,r,o){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("generalize",[a(e),e,n,r,o])];case 1:return[2,u(t.sent())]}}))}))},n.densify=function(e,n,r){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("densify",[a(e),e,n,r])];case 1:return[2,u(t.sent())]}}))}))},n.geodesicDensify=function(e,n,r,o){return void 0===o&&(o=0),t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,l("geodesicDensify",[a(e),e,n,r,o])];case 1:return[2,u(t.sent())]}}))}))},n.planarArea=function(e,n){return l("planarArea",[a(e),e,n])},n.planarLength=function(e,n){return l("planarLength",[a(e),e,n])},n.geodesicArea=function(e,n,t){return l("geodesicArea",[a(e),e,n,t])},n.geodesicLength=function(e,n,t){return l("geodesicLength",[a(e),e,n,t])}}.apply(null,r))||(e.exports=o)},1693:function(e,n,t){var r,o;r=[t.dj.c(e.i),n,t(129),t(1522),t(1396),t(1579),t(49),t(126),t(1484),t(418),t(50),t(174),t(309),t(29)],void 0===(o=function(e,n,t,r,o,a,i,u,c,s,l,f,d,h){function g(e){return 0===t.version.indexOf("4.")?f.fromExtent(e):new f({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function p(e){if(o.pcCheck(e,2,2),e[0]instanceof u&&e[1]instanceof u);else if(e[0]instanceof u&&null===e[1]);else if(e[1]instanceof u&&null===e[0]);else if(null!==e[0]||null!==e[1])throw new Error("Illegal Argument")}Object.defineProperty(n,"__esModule",{value:!0}),n.registerFunctions=function(e){"async"===e.mode&&(e.functions.disjoint=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null===t[0]||null===t[1]||c.disjoint(t[0],t[1])}))},e.functions.intersects=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.intersects(t[0],t[1])}))},e.functions.touches=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.touches(t[0],t[1])}))},e.functions.crosses=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.crosses(t[0],t[1])}))},e.functions.within=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.within(t[0],t[1])}))},e.functions.contains=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.contains(t[0],t[1])}))},e.functions.overlaps=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.overlaps(t[0],t[1])}))},e.functions.equals=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return o.pcCheck(t,2,2),t[0]===t[1]||(t[0]instanceof u&&t[1]instanceof u?c.equals(t[0],t[1]):!(!o.isDate(t[0])||!o.isDate(t[1]))&&t[0].getTime()===t[1].getTime())}))},e.functions.relate=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,3,3),t[0]instanceof u&&t[1]instanceof u)return c.relate(t[0],t[1],o.toString(t[2]));if(t[0]instanceof u&&null===t[1])return!1;if(t[1]instanceof u&&null===t[0])return!1;if(null===t[0]&&null===t[1])return!1;throw new Error("Illegal Argument")}))},e.functions.intersection=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null===t[0]||null===t[1]?null:c.intersect(t[0],t[1])}))},e.functions.union=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,a){var i=[];if(0===(a=o.autoCastFeatureToGeometry(a)).length)throw new Error("Function called with wrong number of Parameters");if(1===a.length)if(o.isArray(a[0])){for(var s=o.autoCastFeatureToGeometry(a[0]),l=0;l<s.length;l++)if(null!==s[l]){if(!(s[l]instanceof u))throw new Error("Illegal Argument");i.push(s[l])}}else{if(!o.isImmutableArray(a[0])){if(a[0]instanceof u)return o.fixSpatialReference(r.cloneGeometry(a[0]),n.spatialReference);if(null===a[0])return null;throw new Error("Illegal Argument")}var f=o.autoCastFeatureToGeometry(a[0].toArray());for(l=0;l<f.length;l++)if(null!==f[l]){if(!(f[l]instanceof u))throw new Error("Illegal Argument");i.push(f[l])}}else for(l=0;l<a.length;l++)if(null!==a[l]){if(!(a[l]instanceof u))throw new Error("Illegal Argument");i.push(a[l])}return 0===i.length?null:c.union(i)}))},e.functions.difference=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null===t[1]?r.cloneGeometry(t[0]):null===t[0]?null:c.difference(t[0],t[1])}))},e.functions.symmetricdifference=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null===t[0]&&null===t[1]?null:null===t[0]?r.cloneGeometry(t[1]):null===t[1]?r.cloneGeometry(t[0]):c.symmetricDifference(t[0],t[1])}))},e.functions.clip=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,2),!(t[1]instanceof i)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");return null===t[1]?null:c.clip(t[0],t[1])}))},e.functions.cut=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,2),!(t[1]instanceof d)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return[];if(!(t[0]instanceof u))throw new Error("Illegal Argument");return null===t[1]?[r.cloneGeometry(t[0])]:c.cut(t[0],t[1])}))},e.functions.area=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,a){if(o.pcCheck(a,1,2),null===(a=o.autoCastFeatureToGeometry(a))[0])return 0;if(o.isFeatureSet(a[0]))return a[0].sumArea(r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)),!1,n.abortSignal).then((function(e){if(n.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e}));if(o.isArray(a[0])||o.isImmutableArray(a[0])){var i=o.autoCastArrayOfPointsToPolygon(a[0],n.spatialReference);return null===i?0:c.planarArea(i,r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)))}if(!(a[0]instanceof u))throw new Error("Illegal Argument");return c.planarArea(a[0],r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)))}))},e.functions.areageodetic=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,a){if(o.pcCheck(a,1,2),null===(a=o.autoCastFeatureToGeometry(a))[0])return 0;if(o.isFeatureSet(a[0]))return a[0].sumArea(r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)),!0,n.abortSignal).then((function(e){if(n.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e}));if(o.isArray(a[0])||o.isImmutableArray(a[0])){var i=o.autoCastArrayOfPointsToPolygon(a[0],n.spatialReference);return null===i?0:c.geodesicArea(i,r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)))}if(!(a[0]instanceof u))throw new Error("Illegal Argument");return c.geodesicArea(a[0],r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)))}))},e.functions.length=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,a){if(o.pcCheck(a,1,2),null===(a=o.autoCastFeatureToGeometry(a))[0])return 0;if(o.isFeatureSet(a[0]))return a[0].sumLength(r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)),!1,n.abortSignal).then((function(e){if(n.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e}));if(o.isArray(a[0])||o.isImmutableArray(a[0])){var i=o.autoCastArrayOfPointsToPolyline(a[0],n.spatialReference);return null===i?0:c.planarLength(i,r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)))}if(!(a[0]instanceof u))throw new Error("Illegal Argument");return c.planarLength(a[0],r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)))}))},e.functions.lengthgeodetic=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,a){if(o.pcCheck(a,1,2),null===(a=o.autoCastFeatureToGeometry(a))[0])return 0;if(o.isFeatureSet(a[0]))return a[0].sumLength(r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)),!0,n.abortSignal).then((function(e){if(n.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e}));if(o.isArray(a[0])||o.isImmutableArray(a[0])){var i=o.autoCastArrayOfPointsToPolyline(a[0],n.spatialReference);return null===i?0:c.geodesicLength(i,r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)))}if(!(a[0]instanceof u))throw new Error("Illegal Argument");return c.geodesicLength(a[0],r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)))}))},e.functions.distance=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,a){a=o.autoCastFeatureToGeometry(a),o.pcCheck(a,2,3);var i=a[0];(o.isArray(a[0])||o.isImmutableArray(a[0]))&&(i=o.autoCastArrayOfPointsToMultiPoint(a[0],n.spatialReference));var s=a[1];if((o.isArray(a[1])||o.isImmutableArray(a[1]))&&(s=o.autoCastArrayOfPointsToMultiPoint(a[1],n.spatialReference)),!(i instanceof u))throw new Error("Illegal Argument");if(!(s instanceof u))throw new Error("Illegal Argument");return c.distance(i,s,r.convertLinearUnitsToCode(o.defaultUndefined(a[2],-1)))}))},e.functions.distancegeodetic=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3);var a=t[0],i=t[1];if(!(a instanceof l))throw new Error("Illegal Argument");if(!(i instanceof l))throw new Error("Illegal Argument");var u=new d({paths:[],spatialReference:a.spatialReference});return u.addPath([a,i]),c.geodesicLength(u,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1)))}))},e.functions.densify=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");if(a<=0)throw new Error("Illegal Argument");return t[0]instanceof f||t[0]instanceof d?c.densify(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]instanceof i?c.densify(g(t[0]),a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]}))},e.functions.densifygeodetic=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");if(a<=0)throw new Error("Illegal Argument");return t[0]instanceof f||t[0]instanceof d?c.geodesicDensify(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]instanceof i?c.geodesicDensify(g(t[0]),a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]}))},e.functions.generalize=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,4),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");return c.generalize(t[0],a,o.toBoolean(o.defaultUndefined(t[2],!0)),r.convertLinearUnitsToCode(o.defaultUndefined(t[3],-1)))}))},e.functions.buffer=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");return 0===a?r.cloneGeometry(t[0]):c.buffer(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1)))}))},e.functions.buffergeodetic=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");return 0===a?r.cloneGeometry(t[0]):c.geodesicBuffer(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1)))}))},e.functions.offset=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,6),null===t[0])return null;if(!(t[0]instanceof f||t[0]instanceof d))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");var i=o.toNumber(o.defaultUndefined(t[4],10));if(isNaN(i))throw new Error("Illegal Argument");var u=o.toNumber(o.defaultUndefined(t[5],0));if(isNaN(u))throw new Error("Illegal Argument");return c.offset(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1)),o.toString(o.defaultUndefined(t[3],"round")).toLowerCase(),i,u)}))},e.functions.rotate=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3);var r=t[0];if(null===r)return null;if(!(r instanceof u))throw new Error("Illegal Argument");r instanceof i&&(r=f.fromExtent(r));var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");var s=o.defaultUndefined(t[2],null);if(null===s)return c.rotate(r,a);if(s instanceof l)return c.rotate(r,a,s);throw new Error("Illegal Argument")}))},e.functions.centroid=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,c){if(c=o.autoCastFeatureToGeometry(c),o.pcCheck(c,1,1),null===c[0])return null;var h=c[0];if((o.isArray(c[0])||o.isImmutableArray(c[0]))&&(h=o.autoCastArrayOfPointsToMultiPoint(c[0],n.spatialReference)),null===h)return null;if(!(h instanceof u))throw new Error("Illegal Argument");return h instanceof l?o.fixSpatialReference(r.cloneGeometry(c[0]),n.spatialReference):h instanceof f?h.centroid:h instanceof d?a.centroidPolyline(h):h instanceof s?a.centroidMultiPoint(h):h instanceof i?h.center:null}))},e.functions.multiparttosinglepart=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,a){a=o.autoCastFeatureToGeometry(a),o.pcCheck(a,1,1);var g=[];if(null===a[0])return null;if(!(a[0]instanceof u))throw new Error("Illegal Argument");return a[0]instanceof l||a[0]instanceof i?[o.fixSpatialReference(r.cloneGeometry(a[0]),n.spatialReference)]:c.simplify(a[0]).then((function(e){if(e instanceof f){for(var t=[],i=[],u=0;u<e.rings.length;u++)if(e.isClockwise(e.rings[u])){var c=h.fromJSON({rings:[e.rings[u]],hasZ:!0===e.hasZ,hazM:!0===e.hasM,spatialReference:e.spatialReference.toJSON()});t.push(c)}else i.push({ring:e.rings[u],pt:e.getPoint(u,0)});for(var l=0;l<i.length;l++)for(var p=0;p<t.length;p++)if(t[p].contains(i[l].pt)){t[p].addRing(i[l].ring);break}return t}if(e instanceof d){var v=[];for(u=0;u<e.paths.length;u++){var m=h.fromJSON({paths:[e.paths[u]],hasZ:!0===e.hasZ,hazM:!0===e.hasM,spatialReference:e.spatialReference.toJSON()});v.push(m)}return v}if(a[0]instanceof s){var y=o.fixSpatialReference(r.cloneGeometry(a[0]),n.spatialReference);for(u=0;u<y.points.length;u++)g.push(y.getPoint(u));return g}return null}))}))},e.functions.issimple=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,1,1),null===t[0])return!0;if(!(t[0]instanceof u))throw new Error("Illegal Argument");return c.isSimple(t[0])}))},e.functions.simplify=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,1,1),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");return c.simplify(t[0])}))})}}.apply(null,r))||(e.exports=o)},2054:function(e,n,t){var r,o;r=[t.dj.c(e.i),n,t(1519),t(1578),t(1415),t(1457),t(1637),t(1576),t(1489),t(1396),t(1521),t(1401),t(1638),t(1693),t(1639),t(1641),t(1642),t(1644),t(4),t(49),t(126),t(418),t(50),t(174),t(309),t(40)],void 0===(o=function(e,n,t,r,o,a,i,u,c,s,l,f,d,h,g,p,v,m,y,w,E,N,b,A,I,T){function S(e){return e instanceof Error?y.reject(e):y.reject(new Error(e))}function C(e){return y.resolve(e)}function R(e,n){for(var t=[],r=0;r<n.arguments.length;r++)t.push(_(e,n.arguments[r]));return y.all(t)}function F(e,n,t){return y.create((function(r,o){R(e,n).then((function(a){try{r(t(e,n,a))}catch(e){o(e)}}),o)}))}function O(e,n,t){try{return R(e,n).then((function(r){try{var o=t(e,n,r);return(a=o)&&"function"==typeof a.then?o:y.resolve(o)}catch(e){return S(e)}var a}))}catch(e){return S(e)}}function _(e,n){try{switch(n.type){case"VariableDeclarator":return function(e,n){try{var t=null;return t=null===n.init?y.resolve(null):_(e,n.init),null!==e.localScope?t.then((function(t){return y.create((function(r){if(t===s.voidOperation&&(t=null),"Identifier"!==n.id.type)throw new Error("Can only assign a regular variable");var o=n.id.name.toLowerCase();e.localScope[o]={value:t,valueset:!0,node:n.init},r(s.voidOperation)}))})):t.then((function(t){return y.create((function(r){if("Identifier"!==n.id.type)throw new Error("Can only assign a regular variable");var o=n.id.name.toLowerCase();t===s.voidOperation&&(t=null),e.globalScope[o]={value:t,valueset:!0,node:n.init},r(s.voidOperation)}))}))}catch(e){return S(e)}}(e,n);case"VariableDeclaration":return function e(n,t,r){return y.create((function(o,a){r>=t.declarations.length?o(s.voidOperation):_(n,t.declarations[r]).then((function(){r===t.declarations.length-1?o(s.voidOperation):e(n,t,r+1).then((function(){o(s.voidOperation)}),a)}),a)}))}(e,n,0);case"BlockStatement":return function(e,n){try{return function e(n,t,r){try{return r>=t.body.length?y.resolve(s.voidOperation):y.create((function(o,a){_(n,t.body[r]).then((function(i){try{i instanceof s.ReturnResult||i===s.breakResult||i===s.continueResult||r===t.body.length-1?o(i):e(n,t,r+1).then(o,a)}catch(e){a(e)}}),a)}))}catch(e){return S(e)}}(e,n,0)}catch(e){return S(e)}}(e,n);case"FunctionDeclaration":return function(e,n){try{var t=n.id.name.toLowerCase();return e.globalScope[t]={valueset:!0,node:null,value:new i(n,e)},y.resolve(s.voidOperation)}catch(e){return S(e)}}(e,n);case"ReturnStatement":return function(e,n){return y.create((function(t,r){null===n.argument?t(new s.ReturnResult(s.voidOperation)):_(e,n.argument).then((function(e){try{t(new s.ReturnResult(e))}catch(e){r(e)}}),r)}))}(e,n);case"IfStatement":return function(e,n){return y.create((function(t,r){"AssignmentExpression"!==n.test.type&&"UpdateExpression"!==n.test.type?_(e,n.test).then((function(o){try{!0===o?_(e,n.consequent).then(t,r):!1===o?null!==n.alternate?_(e,n.alternate).then(t,r):t(s.voidOperation):r(new Error(l.nodeErrorMessage(n.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION")))}catch(e){r(e)}}),r):r(new Error(l.nodeErrorMessage(n.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))}))}(e,n);case"ExpressionStatement":return function(e,n){try{return"AssignmentExpression"===n.expression.type?_(e,n.expression):(n.expression.type,_(e,n.expression).then((function(e){return y.create((function(n){e===s.voidOperation?n(s.voidOperation):n(new s.ImplicitResult(e))}))})))}catch(e){return y.reject(e)}}(e,n);case"UpdateExpression":return function(e,n){try{var t=n.argument;if("MemberExpression"===t.type){var r={t:null};return _(e,t.object).then((function(n){var o=null;return r.t=n,!0===t.computed?o=_(e,t.property):"Identifier"===t.property.type&&(o=y.resolve(t.property.name)),o})).then((function(e){return y.create((function(t){var i,u=r.t;if(s.isArray(u)){if(!s.isNumber(e))throw new Error("Invalid Parameter");if(e<0&&(e=u.length+e),e<0||e>=u.length)throw new Error("Assignment outside of array bounds");i=s.toNumber(u[e]),u[e]="++"===n.operator?i+1:i-1}else if(u instanceof o){if(!1===s.isString(e))throw new Error("Dictionary accessor must be a string");if(!0!==u.hasField(e))throw new Error("Invalid Parameter");i=s.toNumber(u.field(e)),u.setField(e,"++"===n.operator?i+1:i-1)}else{if(!(u instanceof a))throw s.isImmutableArray(u)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===s.isString(e))throw new Error("Feature accessor must be a string");if(!0!==u.hasField(e))throw new Error("Invalid Parameter");i=s.toNumber(u.field(e)),u.setField(e,"++"===n.operator?i+1:i-1)}!1===n.prefix?t(i):t("++"===n.operator?i+1:i-1)}))}))}return y.create((function(t,r){var o,a="Identifier"===n.argument.type?n.argument.name.toLowerCase():"";if(!a)throw new Error("Invalid identifier");return null!==e.localScope&&void 0!==e.localScope[a]?(o=s.toNumber(e.localScope[a].value),e.localScope[a]={value:"++"===n.operator?o+1:o-1,valueset:!0,node:n},void(!1===n.prefix?t(o):t("++"===n.operator?o+1:o-1))):void 0!==e.globalScope[a]?(o=s.toNumber(e.globalScope[a].value),e.globalScope[a]={value:"++"===n.operator?o+1:o-1,valueset:!0,node:n},void(!1===n.prefix?t(o):t("++"===n.operator?o+1:o-1))):void r(new Error("Variable not recognised"))}))}catch(e){return y.reject(e)}}(e,n);case"AssignmentExpression":return function(e,n){return y.create((function(t,r){var i=n.left;if("MemberExpression"===i.type)_(e,n.right).then((function(u){try{_(e,i.object).then((function(c){try{var l=null;if(!0===i.computed)l=_(e,i.property);else{if("Identifier"!==i.property.type)throw new Error("Expected computed or identifier for assignemnt target");l=y.resolve(i.property.name)}l.then((function(e){try{if(s.isArray(c)){if(!s.isNumber(e))throw new Error("Invalid Parameter");if(e<0&&(e=c.length+e),e<0||e>c.length)throw new Error("Assignment outside of array bounds");if(e===c.length){if("="!==n.operator)throw new Error("Invalid Parameter");c[e]=k(u,n.operator,c[e],n)}else c[e]=k(u,n.operator,c[e],n)}else if(c instanceof o){if(!1===s.isString(e))throw new Error("Dictionary accessor must be a string");if(!0===c.hasField(e))c.setField(e,k(u,n.operator,c.field(e),n));else{if("="!==n.operator)throw new Error("Invalid Parameter");c.setField(e,k(u,n.operator,null,n))}}else{if(!(c instanceof a))throw s.isImmutableArray(c)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===s.isString(e))throw new Error("Feature accessor must be a string");if(!0===c.hasField(e))c.setField(e,k(u,n.operator,c.field(e),n));else{if("="!==n.operator)throw new Error("Invalid Parameter");c.setField(e,k(u,n.operator,null,n))}}t(s.voidOperation)}catch(e){r(e)}}),r)}catch(e){r(e)}}),r)}catch(e){r(e)}}),r);else{var u=i.name.toLowerCase();if(null!==e.localScope&&void 0!==e.localScope[u])return void _(e,n.right).then((function(o){try{e.localScope[u]={value:k(o,n.operator,e.localScope[u].value,n),valueset:!0,node:n.right},t(s.voidOperation)}catch(e){r(e)}}),r);void 0!==e.globalScope[u]?_(e,n.right).then((function(o){try{e.globalScope[u]={value:k(o,n.operator,e.globalScope[u].value,n),valueset:!0,node:n.right},t(s.voidOperation)}catch(e){r(e)}}),r):r(new Error("Cannot assign undeclared variable"))}}))}(e,n);case"ForStatement":return function(e,n){try{return null!==n.init?_(e,n.init).then((function(){return y.create((function(t,r){var o={testResult:!0,lastAction:s.voidOperation};M(e,n,o,(function(e){t(e)}),(function(e){r(e)}),0)}))})):y.create((function(t,r){var o={testResult:!0,lastAction:s.voidOperation};M(e,n,o,(function(e){t(e)}),(function(e){r(e)}),0)}))}catch(e){return y.reject(e)}}(e,n);case"ForInStatement":return function(e,n){return y.create((function(t,r){_(e,n.right).then((function(i){try{("VariableDeclaration"===n.left.type?_(e,n.left):y.resolve()).then((function(){try{var u="";if("VariableDeclaration"===n.left.type){var c=n.left.declarations[0].id;"Identifier"===c.type&&(u=c.name)}else"Identifier"===n.left.type&&(u=n.left.name);if(!u)throw new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDVARIABLE"));u=u.toLowerCase();var f=null;if(null!==e.localScope&&void 0!==e.localScope[u]&&(f=e.localScope[u]),null===f&&void 0!==e.globalScope[u]&&(f=e.globalScope[u]),null===f)return void r(new Error(l.nodeErrorMessage(n,"RUNTIME","VARIABLENOTDECLARED")));s.isArray(i)||s.isString(i)?x(e,n,i,{reject:r,resolve:t},f):s.isImmutableArray(i)?function(e,n,t,r,o,a){try{if(void 0===a&&(a="i"),0===t.length)return void r.resolve(s.voidOperation);!function e(n,t,r,o,a,i,u,c,l){try{if(r.length()<=a)return void u(s.voidOperation);o.value="k"===i?r.get(a):a,_(n,t.body).then((function(f){f instanceof s.ReturnResult?u(f):f===s.breakResult?u(s.voidOperation):++l>100?(l=0,setTimeout((function(){e(n,t,r,o,a+1,i,u,c,l)}),0)):e(n,t,r,o,a+1,i,u,c,l)}),(function(e){c(e)}))}catch(e){c(e)}}(e,n,t,o,0,a,(function(e){r.resolve(e)}),(function(e){r.reject(e)}),0)}catch(e){r.reject(e)}}(e,n,i,{reject:r,resolve:t},f):i instanceof o||i instanceof a?function(e,n,t,r,o){try{x(e,n,t.keys(),r,o,"k")}catch(e){r.reject(e)}}(e,n,i,{reject:r,resolve:t},f):s.isFeatureSet(i)?function e(n,t,r,o,i,u,c,l){try{n.next().then((function(f){try{if(null===f)u(s.voidOperation);else{var d=a.createFromGraphicLikeObject(f.geometry,f.attributes,o);d._underlyingGraphic=f,i.value=d,_(t,r.body).then((function(a){try{a===s.breakResult?u(s.voidOperation):a instanceof s.ReturnResult?u(a):++l>100?(l=0,setTimeout((function(){e(n,t,r,o,i,u,c,l)}),0)):e(n,t,r,o,i,u,c,l)}catch(e){c(e)}}),(function(e){c(e)}))}}catch(e){c(e)}}),(function(e){c(e)}))}catch(e){c(e)}}(i.iterator(e.abortSignal),e,n,i,f,(function(e){t(e)}),(function(e){r(e)}),0):x(e,n,[],{reject:r,resolve:t},f)}catch(e){r(e)}}),r)}catch(e){r(e)}}),r)}))}(e,n);case"BreakStatement":return y.resolve(s.breakResult);case"EmptyStatement":return y.resolve(s.voidOperation);case"ContinueStatement":return y.resolve(s.continueResult);case"TemplateElement":return function(e,n){return y.resolve(n.value?n.value.cooked:"")}(0,n);case"TemplateLiteral":return function(e,n){return y.create((function(t){var r=[];f.reduceArrayWithPromises(n.expressions,(function(n,t,o,a){return _(e,t).then((function(e){r[o]=s.toString(e)}))})).then((function(){for(var e="",o=0,a=0,i=n.quasis;a<i.length;a++){var u=i[a];e+=u.value?u.value.cooked:"",!1===u.tail&&(e+=r[o]?r[o]:"",o++)}t(e)}))}))}(e,n);case"Identifier":return D(e,n);case"MemberExpression":return function(e,n){try{return _(e,n.object).then((function(t){try{return null===t?y.reject(new Error(l.nodeErrorMessage(n,"RUNTIME","NOTFOUND"))):!1===n.computed?"Identifier"===n.property.type?t instanceof o||t instanceof a?y.resolve(t.field(n.property.name)):t instanceof E?y.resolve(L(t,n.property.name,e,n)):y.reject(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE"))):y.reject(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE"))):_(e,n.property).then((function(r){return y.create((function(i,u){if(t instanceof o||t instanceof a)s.isString(r)?i(t.field(r)):u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")));else if(t instanceof E)s.isString(r)?i(L(t,r,e,n)):u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")));else if(s.isArray(t))if(s.isNumber(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=t.length+r),r>=t.length||r<0)throw new Error(l.nodeErrorMessage(n,"RUNTIME","OUTOFBOUNDS"));i(t[r])}else u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")));else if(s.isImmutableArray(t))if(s.isNumber(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=t.length()+r),r>=t.length()||r<0)throw new Error(l.nodeErrorMessage(n,"RUNTIME","OUTOFBOUNDS"));i(t.get(r))}else u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")));else if(s.isString(t))if(s.isNumber(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=t.length+r),r>=t.length||r<0)throw new Error(l.nodeErrorMessage(n,"RUNTIME","OUTOFBOUNDS"));i(t[r])}else u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")));else u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")))}))}))}catch(e){return S(e)}}))}catch(e){return S(e)}}(e,n);case"Literal":return C(n.value);case"CallExpression":return function(e,n){try{return"Identifier"!==n.callee.type?S(l.nodeErrorMessage(n,"RUNTIME","ONLYNODESSUPPORTED")):null!==e.localScope&&void 0!==e.localScope[n.callee.name.toLowerCase()]?(t=e.localScope[n.callee.name.toLowerCase()]).value instanceof s.NativeFunction?t.value.fn(e,n):t.value instanceof i?J(e,n,t.value.definition):S(l.nodeErrorMessage(n,"RUNTIME","NOTAFUNCTION")):void 0!==e.globalScope[n.callee.name.toLowerCase()]?(t=e.globalScope[n.callee.name.toLowerCase()]).value instanceof s.NativeFunction?t.value.fn(e,n):t.value instanceof i?J(e,n,t.value.definition):S(l.nodeErrorMessage(n,"RUNTIME","NOTAFUNCTION")):S(l.nodeErrorMessage(n,"RUNTIME","NOTFOUND"));var t}catch(e){return S(e)}}(e,n);case"UnaryExpression":return function(e,n){try{return _(e,n.argument).then((function(e){return y.create((function(t,r){s.isBoolean(e)&&"!"===n.operator?t(!e):"-"===n.operator?t(-1*s.toNumber(e)):"+"===n.operator?t(1*s.toNumber(e)):"~"===n.operator?t(~s.toNumber(e)):r(new Error(l.nodeErrorMessage(n,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR")))}))}))}catch(e){return S(e)}}(e,n);case"BinaryExpression":return function(e,n){try{return y.all([_(e,n.left),_(e,n.right)]).then((function(e){return y.create((function(t,r){var o=e[0],a=e[1];switch(n.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":t(s.binaryOperator(s.toNumber(o),s.toNumber(a),n.operator));case"==":t(s.equalityTest(o,a));break;case"!=":t(!s.equalityTest(o,a));break;case"<":case">":case"<=":case">=":t(s.greaterThanLessThan(o,a,n.operator));break;case"+":s.isString(o)||s.isString(a)?t(s.toString(o)+s.toString(a)):t(s.toNumber(o)+s.toNumber(a));break;case"-":t(s.toNumber(o)-s.toNumber(a));break;case"*":t(s.toNumber(o)*s.toNumber(a));break;case"/":t(s.toNumber(o)/s.toNumber(a));break;case"%":t(s.toNumber(o)%s.toNumber(a));break;default:r(new Error(l.nodeErrorMessage(n,"RUNTIME","OPERATORNOTRECOGNISED")))}}))}))}catch(e){return S(e)}}(e,n);case"LogicalExpression":return function(e,n){return y.create((function(t,r){"AssignmentExpression"!==n.left.type&&"UpdateExpression"!==n.left.type?"AssignmentExpression"!==n.right.type&&"UpdateExpression"!==n.right.type?_(e,n.left).then((function(o){try{if(!s.isBoolean(o))throw new Error(l.nodeErrorMessage(n,"RUNTIME","ONLYBOOLEAN"));switch(n.operator){case"||":!0===o?t(o):_(e,n.right).then((function(e){try{if(!s.isBoolean(e))throw new Error(l.nodeErrorMessage(n,"RUNTIME","ONLYORORAND"));t(e)}catch(e){r(e)}}),r);break;case"&&":!1===o?t(o):_(e,n.right).then((function(e){try{if(!s.isBoolean(e))throw new Error(l.nodeErrorMessage(n,"RUNTIME","ONLYORORAND"));t(e)}catch(e){r(e)}}),r);break;default:throw new Error(l.nodeErrorMessage(n,"RUNTIME","ONLYORORAND"))}}catch(e){r(e)}}),r):r(new Error(l.nodeErrorMessage(n.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):r(new Error(l.nodeErrorMessage(n.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))}))}(e,n);case"ConditionalExpression":return S(l.nodeErrorMessage(n,"RUNTIME","NOTSUPPORTED"));case"ArrayExpression":return function(e,n){try{for(var t=[],r=0;r<n.elements.length;r++)t.push(_(e,n.elements[r]));return y.all(t).then((function(e){return y.create((function(t,r){for(var o=0;o<e.length;o++){if(s.isFunctionParameter(e[o]))return void r(new Error(l.nodeErrorMessage(n,"RUNTIME","FUNCTIONCONTEXTILLEGAL")));e[o]===s.voidOperation&&(e[o]=null)}t(e)}))}))}catch(e){return S(e)}}(e,n);case"ObjectExpression":return function(e,n){try{for(var t=[],r=0;r<n.properties.length;r++)t.push(_(e,n.properties[r]));return y.all(t).then((function(e){return y.create((function(n){for(var t={},r=0;r<e.length;r++){var a=e[r];if(s.isFunctionParameter(a.value))throw new Error("Illegal Argument");if(!1===s.isString(a.key))throw new Error("Illegal Argument");a.value===s.voidOperation?t[a.key.toString()]=null:t[a.key.toString()]=a.value}var i=new o(t);i.immutable=!1,n(i)}))}))}catch(e){return S(e)}}(e,n);case"Property":return function(e,n){try{return _(e,n.value).then((function(t){return y.create((function(r){"Identifier"===n.key.type?r({key:n.key.name,value:t}):_(e,n.key).then((function(e){r({key:e,value:t})}))}))}))}catch(e){return y.reject(e)}}(e,n);default:return S(l.nodeErrorMessage(n,"RUNTIME","UNREOGNISED"))}}catch(e){return S(e)}}function U(e,n,t){try{return _(e,n.body).then((function(r){try{return t.lastAction=r,t.lastAction===s.breakResult||t.lastAction instanceof s.ReturnResult?(t.testResult=!1,y.resolve(t)):null!==n.update?_(e,n.update).then((function(){return y.resolve(t)})):y.resolve(t)}catch(e){return y.reject(e)}}))}catch(e){return y.reject(e)}}function M(e,n,t,r,o,a){try{(function(e,n,t){try{return null!==n.test?_(e,n.test).then((function(r){try{return!0===e.abortSignal.aborted?y.reject(new Error("Cancelled")):(t.testResult=r,!1===t.testResult?y.resolve(t):!0!==t.testResult?y.reject(new Error(l.nodeErrorMessage(n,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))):U(e,n,t))}catch(e){return y.reject(e)}})):U(e,n,t)}catch(e){return y.reject(e)}})(e,n,t).then((function(){try{!0===t.testResult?++a>100?(a=0,setTimeout((function(){M(e,n,t,r,o,a)}),0)):M(e,n,t,r,o,a):t.lastAction instanceof s.ReturnResult?r(t.lastAction):r(s.voidOperation)}catch(e){o(e)}}),(function(e){o(e)}))}catch(e){o(e)}}function x(e,n,t,r,o,a){try{if(void 0===a&&(a="i"),0===t.length)return void r.resolve(s.voidOperation);!function e(n,t,r,o,a,i,u,c,l,f){try{if(o<=i)return void c(s.voidOperation);a.value="k"===u?r[i]:i,_(n,t.body).then((function(d){try{d instanceof s.ReturnResult?c(d):d===s.breakResult?c(s.voidOperation):++f>100?(f=0,setTimeout((function(){e(n,t,r,o,a,i+1,u,c,l,f)}),0)):e(n,t,r,o,a,i+1,u,c,l,f)}catch(e){l(e)}}),(function(e){l(e)}))}catch(e){l(e)}}(e,n,t,t.length,o,0,a,(function(e){r.resolve(e)}),(function(e){r.reject(e)}),0)}catch(e){r.reject(e)}}function k(e,n,t,r){switch(n){case"=":return e===s.voidOperation?null:e;case"/=":return s.toNumber(t)/s.toNumber(e);case"*=":return s.toNumber(t)*s.toNumber(e);case"-=":return s.toNumber(t)-s.toNumber(e);case"+=":return s.isString(t)||s.isString(e)?s.toString(t)+s.toString(e):s.toNumber(t)+s.toNumber(e);case"%=":return s.toNumber(t)%s.toNumber(e);default:throw new Error(l.nodeErrorMessage(r,"RUNTIME","OPERATORNOTRECOGNISED"))}}Object.defineProperty(n,"__esModule",{value:!0});var P=0;function L(e,n,t,r){var a;switch(n=n.toLowerCase()){case"hasz":var i=e.hasZ;return void 0!==i&&i;case"hasm":var s=e.hasM;return void 0!==s&&s;case"spatialreference":var f=e.spatialReference._arcadeCacheId;if(void 0===f){var d=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(d=!1),d&&(P++,e.spatialReference._arcadeCacheId=P,f=P)}var h=new o({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==f&&(h._arcadeCacheId="SPREF"+f.toString()),h}switch(e.type){case"extent":switch(n){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":var g=e[n];return void 0!==g?g:null;case"type":return"Extent"}break;case"polygon":switch(n){case"rings":return void 0===(a=e.cache._arcadeCacheId)&&(a=++P,e.cache._arcadeCacheId=a),new u(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,a);case"type":return"Polygon"}break;case"point":switch(n){case"x":case"y":case"z":case"m":return void 0!==e[n]?e[n]:null;case"type":return"Point"}break;case"polyline":switch(n){case"paths":return void 0===(a=e.cache._arcadeCacheId)&&(a=++P,e.cache._arcadeCacheId=a),new u(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,a);case"type":return"Polyline"}break;case"multipoint":switch(n){case"points":return void 0===(a=e.cache._arcadeCacheId)&&(a=++P,e.cache._arcadeCacheId=a),new c(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,a,1);case"type":return"Multipoint"}}throw new Error(l.nodeErrorMessage(r,"RUNTIME","PROPERTYNOTFOUND"))}function D(e,n){return y.create((function(t,r){var o=n.name.toLowerCase();if(null===e.localScope||void 0===e.localScope[o])if(void 0===e.globalScope[o])r(new Error(l.nodeErrorMessage(n,"RUNTIME","VARIABLENOTFOUND")));else{var a=e.globalScope[o];!0===a.valueset?t(a.value):null!==a.d?a.d.then(t,r):(a.d=_(e,a.node),a.d.then((function(e){try{a.value=e,a.valueset=!0,t(e)}catch(e){r(e)}}),r))}else{var i=e.localScope[o];!0===i.valueset?t(i.value):null!==i.d?i.d.then(t,r):(i.d=_(e,i.node),i.d.then((function(e){try{i.value=e,i.valueset=!0,t(e)}catch(e){r(e)}}),r))}}))}var G={};function j(e){return null===e?"":s.isArray(e)||s.isImmutableArray(e)?"Array":s.isDate(e)?"Date":s.isString(e)?"String":s.isBoolean(e)?"Boolean":s.isNumber(e)?"Number":e instanceof r?"Attachment":e instanceof t?"Portal":e instanceof o?"Dictionary":e instanceof a?"Feature":e instanceof b?"Point":e instanceof A?"Polygon":e instanceof I?"Polyline":e instanceof N?"Multipoint":e instanceof w?"Extent":s.isFunctionParameter(e)?"Function":s.isFeatureSet(e)?"FeatureSet":s.isFeatureSetCollection(e)?"FeatureSetCollection":e===s.voidOperation?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function B(e,n){var t=e.length,r=Math.floor(t/2);return n||(n=function(e,n){return e<n?-1:e===n?0:1}),0===t?[]:1===t?[e[0]]:function(e,n,t){for(var r=[];e.length>0||n.length>0;)if(e.length>0&&n.length>0){var o=t(e[0],n[0]);isNaN(o)&&(o=1),o<=0?(r.push(e[0]),e=e.slice(1)):(r.push(n[0]),n=n.slice(1))}else e.length>0?(r.push(e[0]),e=e.slice(1)):n.length>0&&(r.push(n[0]),n=n.slice(1));return r}(B(e.slice(0,r),n),B(e.slice(r,t),n),n)}function V(e,n,t){try{var r=e.body;if(t.length!==e.params.length)return S(new Error("Invalid Parameter calls to function."));for(var o=0;o<t.length;o++){var a=e.params[o];"Identifier"===a.type&&(n.localScope[a.name.toLowerCase()]={d:null,value:t[o],valueset:!0,node:null})}return _(n,r).then((function(e){return y.create((function(n,t){e instanceof s.ReturnResult?n(e.value):e!==s.breakResult?e!==s.continueResult?e instanceof s.ImplicitResult?n(e.value):n(e):t(new Error("Cannot Continue from a Function")):t(new Error("Cannot Break from a Function"))}))}))}catch(e){return y.reject(e)}}function J(e,n,t){return O(e,n,(function(n,r,o){var a={spatialReference:e.spatialReference,services:e.services,console:e.console,lrucache:e.lrucache,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:e.depthCounter+1};if(a.depthCounter>64)throw new Error("Exceeded maximum function depth");return V(t,a,o)}))}function q(e){return function(){var n={abortSignal:e.context.abortSignal,spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,services:e.context.services,localScope:{},globalScope:e.context.globalScope,depthCounter:e.context.depthCounter+1};if(n.depthCounter>64)throw new Error("Exceeded maximum function depth");return V(e.definition,n,arguments)}}d.registerFunctions(G,F),m.registerFunctions(G,F),p.registerFunctions(G,F),g.registerFunctions(G,F),v.registerFunctions(G,F),h.registerFunctions({functions:G,compiled:!1,signatures:null,failDefferred:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:F,standardFunctionAsync:O}),G.typeof=function(e,n){return F(e,n,(function(e,n,t){s.pcCheck(t,1,1);var r=j(t[0]);if("Unrecognised Type"===r)throw new Error("Unrecognised Type");return r}))},G.iif=function(e,n){return y.create((function(t,r){s.pcCheck(null===n.arguments?[]:n.arguments,3,3),_(e,n.arguments[0]).then((function(o){try{if(!1===s.isBoolean(o))return void r(new Error("IF Function must have a boolean test condition"));y.all([_(e,n.arguments[1]),_(e,n.arguments[2])]).then((function(e){t(o?e[0]:e[1])}),r)}catch(e){r(e)}}),r)}))},G.decode=function(e,n){return y.create((function(t,r){n.arguments.length<2?r(new Error("Missing Parameters")):2!==n.arguments.length?(n.arguments.length-1)%2!=0?_(e,n.arguments[0]).then((function(o){try{(function e(n,t,r,o){return y.create((function(a,i){_(n,t.arguments[r]).then((function(u){try{if(s.equalityTest(u,o))return void _(n,t.arguments[r+1]).then(a,i);var c=t.arguments.length-r;return 1===c?void _(n,t.arguments[r]).then(a,i):(2===c&&a(null),3===c?void _(n,t.arguments[r+2]).then(a,i):void e(n,t,r+2,o).then(a,i))}catch(e){i(e)}}),i)}))})(e,n,1,o).then(t,r)}catch(e){r(e)}}),r):r(new Error("Must have a default value result.")):_(e,n.arguments[1]).then(t,r)}))},G.when=function(e,n){try{return n.arguments.length<3?S("Missing Parameters"):n.arguments.length%2==0?S("Must have a default value result."):_(e,n.arguments[0]).then((function(t){return y.create((function(r,o){!1!==s.isBoolean(t)?function e(n,t,r,o){return y.create((function(a,i){!0===o?_(n,t.arguments[r+1]).then(a,i):3==t.arguments.length-r?_(n,t.arguments[r+2]).then(a,i):_(n,t.arguments[r+2]).then((function(o){try{if(!1===s.isBoolean(o))return void i(new Error("WHEN needs boolean test conditions"));e(n,t,r+2,o).then(a,i)}catch(e){i(e)}}))}))}(e,n,0,t).then(r,o):o(new Error("WHEN needs boolean test conditions"))}))}))}catch(e){return S(e)}},G.sort=function(e,n){return O(e,n,(function(e,n,t){s.pcCheck(t,1,2);var r,o=t[0];if(s.isImmutableArray(o)&&(o=o.toArray()),!1===s.isArray(o))return S(Error("Illegal Argument"));if(t.length>1)return!1===s.isFunctionParameter(t[1])?S(Error("Illegal Argument")):function e(n,t){try{var r=n.length,o=Math.floor(r/2);return 0===r?y.resolve([]):1===r?y.resolve([n[0]]):y.create((function(a,i){var u=[e(n.slice(0,o),t),e(n.slice(o,r),t)];y.all(u).then((function(e){try{(function e(n,t,r,o){return y.create((function(a,i){var u=o;n.length>0||t.length>0?n.length>0&&t.length>0?r(n[0],t[0]).then((function(c){try{isNaN(c)&&(c=1),c<=0?(u.push(n[0]),n=n.slice(1)):(u.push(t[0]),t=t.slice(1)),e(n,t,r,o).then(a,i)}catch(e){i(e)}}),i):n.length>0?(u.push(n[0]),n=n.slice(1),e(n,t,r,o).then(a,i)):t.length>0&&(u.push(t[0]),t=t.slice(1),e(n,t,r,o).then(a,i)):a(o)}))})(e[0],e[1],t,[]).then(a,i)}catch(e){i(e)}}),i)}))}catch(n){return S(n)}}(r=o,q(t[1]));if(0===(r=o).length)return y.resolve([]);for(var a={},i=0;i<r.length;i++){var u=j(r[i]);""!==u&&(a[u]=!0)}if(!0===a.Array||!0===a.Dictionary||!0===a.Feature||!0===a.Point||!0===a.Polygon||!0===a.Polyline||!0===a.Multipoint||!0===a.Extent||!0===a.Function)return y.resolve(r.slice(0));var c=0,l="";for(var f in a)c++,l=f;return c>1||"String"===l?r=B(r,(function(e,n){if(null==e||e===s.voidOperation)return null==n||n===s.voidOperation?0:1;if(null==n||n===s.voidOperation)return-1;var t=s.toString(e),r=s.toString(n);return t<r?-1:t===r?0:1})):"Number"===l?r=B(r,(function(e,n){return e-n})):"Boolean"===l?r=B(r,(function(e,n){return e===n?0:n?-1:1})):"Date"===l&&(r=B(r,(function(e,n){return n-e}))),y.resolve(r)}))};var Y={failDefferred:S,resolveDeffered:C,fixSpatialReference:s.fixSpatialReference,parseArguments:R,standardFunction:F,standardFunctionAsync:O,evaluateIdentifier:D,arcadeCustomFunction:q};for(var z in G)G[z]={value:new s.NativeFunction(G[z]),valueset:!0,node:null};var H=function(){};function Z(e){console.log(e)}(H.prototype=G).infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},H.prototype.pi={value:Math.PI,valueset:!0,node:null},n.functionHelper=Y,n.extend=function(e){for(var n={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:F,standardFunctionAsync:O,failDefferred:S,evaluateIdentifier:D,arcadeCustomFunctionHandler:q},t=0;t<e.length;t++)e[t].registerFunctions(n);for(var r in n.functions)G[r]={value:new s.NativeFunction(n.functions[r]),valueset:!0,node:null},H.prototype[r]=G[r];for(t=0;t<n.signatures.length;t++)l.addFunctionDeclaration(n.signatures[t],"async")},n.executeScript=function(e,n){var t=n.spatialReference;null==t&&(t=new T({wkid:102100}));var r=function(e,n){var t=new H;null==e&&(e={}),null==n&&(n={});var r=new o({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});for(var i in r.immutable=!1,t.textformatting={value:r,valueset:!0,node:null},n)t[i]={value:new s.NativeFunction(n[i]),native:!0,valueset:!0,node:null};for(var i in e)e[i]&&"esri.Graphic"===e[i].declaredClass?t[i]={value:a.createFromGraphic(e[i]),valueset:!0,node:null}:t[i]={value:e[i],valueset:!0,node:null};return t}(n.vars,n.customfunctions);return _({spatialReference:t,services:n.services,abortSignal:void 0===n.abortSignal||null===n.abortSignal?{aborted:!1}:n.abortSignal,globalScope:r,console:n.console?n.console:Z,lrucache:n.lrucache,localScope:null,depthCounter:1},e.body[0].body).then((function(e){return y.create((function(n,t){e instanceof s.ReturnResult&&(e=e.value),e instanceof s.ImplicitResult&&(e=e.value),e===s.voidOperation&&(e=null),e!==s.breakResult?e!==s.continueResult?e instanceof s.NativeFunction||e instanceof i?t(new Error("Cannot return FUNCTION")):n(e):t(new Error("Cannot return CONTINUE")):t(new Error("Cannot return BREAK"))}))}))},n.extractFieldLiterals=function(e,n){return void 0===n&&(n=!1),l.findFieldLiterals(e)},n.validateScript=function(e,n){return l.validateScript(e,n,"full")},n.referencesMember=function(e,n){return l.referencesMember(e,n)},n.referencesFunction=function(e,n){return l.referencesFunction(e,n)},n.findFunctionCalls=function(e){return l.findFunctionCalls(e)}}.apply(null,r))||(e.exports=o)}}]);