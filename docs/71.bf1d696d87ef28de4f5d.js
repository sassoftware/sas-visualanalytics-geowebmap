(function(){var e={"esri/views/3d/layers/BaseDynamicLayerView3D":1370,"esri/views/3d/layers/support/projectExtentUtils":1410,"esri/views/3d/webgl-engine/shaders/ImageMaterial.glsl":1431,"esri/views/3d/layers/DynamicLayerView3D":1478,"esri/views/3d/layers/support/overlayImageUtils":1479,"esri/views/3d/webgl-engine/materials/ImageMaterial":1480,"esri/views/3d/webgl-engine/shaders/ImageMaterialTechnique":1481},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{1370:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(1478)],void 0===(n=function(e,t,r,i,n){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),r.__decorate([i.subclass("esri.views.3d.layers.BaseDynamicLayerView3D")],t)}(n)}.apply(null,i))||(e.exports=n)},1410:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4),r(46),r(239)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,a=e.layer.fullExtent,o=a&&a.spatialReference;return o?o.equals(t)?r.resolve(a.clone()):i.canProject(o,t)?r.resolve(i.project(a,t)):e.view.state.isLocal?n.projectGeometry(a,t,e.layer.portalItem).then((function(t){return!e.destroyed&&t?t:void 0})).catch((function(){return null})):r.resolve(null):r.resolve(null)}}.apply(null,i))||(e.exports=n)},1431:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(44),r(64),r(148),r(10),r(51)],void 0===(n=function(e,t,r,i,n,a,o,s){var l,u;Object.defineProperty(t,"__esModule",{value:!0}),t.build=function(e){var t=new s.ShaderBuilder;return t.include(n.Transform,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(o.glsl(l||(l=r.__makeTemplateObject(["\n    void main(void) {\n      vpos = position;\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "],["\n    void main(void) {\n      vpos = position;\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])))),t.include(i.Slice,e),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),t.fragment.code.add(o.glsl(u||(u=r.__makeTemplateObject(["\n    void main() {\n      discardBySlice(vpos);\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n    }\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n    }\n    "])),o.glsl.float(a.defaultMaskAlphaCutoff))),t}}.apply(null,i))||(e.exports=n)},1478:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(72),r(5),r(4),r(4),r(13),r(1),r(49),r(34),r(680),r(1479),r(1410),r(77),r(191),r(149),r(1480),r(678),r(679)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,c,d,h,p,g,f,m,y,v,_){var w=n.getLogger("esri.views.3d.layers.DynamicLayerView3D"),x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.drapeSourceType=0,t.hasDraped=!0,t.fullExtentInLocalViewSpatialReference=null,t.maximumDataResolution=null,t._images=new Array,t._extents=new Array,t._overlayExtents=new Array,t.updateWhenStationary=!0,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(p.toViewIfLocal(this).then((function(t){return e._set("fullExtentInLocalViewSpatialReference",t)}))),this.updatingHandles.add(this,"suspended",(function(){return e._suspendedChangeHandler()})),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((function(){e._isScaleRangeActive()&&e.notifyChange("suspended")}),(function(){}))),this._isScaleRangeLayer()&&this.updatingHandles.add(this.layer,"scaleRangeId",(function(){return e.notifyChange("suspended")})),"local"===this.view.viewingMode&&this.updatingHandles.add(this.view.basemapTerrain,"extent",(function(){return e._overlayExtents.forEach((function(t,r){return e._updateImageExtent(r)}))}))},t.prototype.destroy=function(){this.clear()},t.prototype.setDrapingExtent=function(e,t,r,i,n,a){this._overlayExtents[e]={extent:c.create(t),spatialReference:r,resolution:i,renderLocalOrigin:n,pixelRatio:a},this._updateImageExtent(e)},t.prototype._updateImageExtent=function(e){var t=this._overlayExtents[e],r=this._clippedExtent(t.extent,b),i=h.computeImageExportSize(t.extent,r,t.resolution),n=t.pixelRatio*this.view.pixelRatio;if("imageMaxWidth"in this.layer||"imageMaxHeight"in this.layer){var o=this.layer.imageMaxWidth,s=this.layer.imageMaxHeight;if(i.width>o){var l=o/i.width;i.height=Math.floor(i.height*l),i.width=o,n*=l}i.height>s&&(l=s/i.height,i.width=Math.floor(i.width*l),i.height=s,n*=l)}var u=this._extents[e];u&&c.equals(u.extent,r)&&!this._imageSizeDiffers(r,u.imageSize,i)||(this._extents[e]={extent:c.create(r),spatialReference:t.spatialReference,imageSize:i,pixelRatio:n},this.suspended||this._fetch(e).catch((function(e){a.isAbortError(e)||w.error(e)})))},t.prototype.clear=function(){for(var e=0;e<this._images.length;e++)this._clearImage(e)},t.prototype.doRefresh=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i;return r.__generator(this,(function(r){switch(r.label){case 0:if(this.suspended)return[2];for(t=[],i=0;i<this._extents.length;i++)this._extents[i]&&t.push(this._fetch(i,e));return[4,a.eachAlways(t)];case 1:return r.sent(),[2]}}))}))},t.prototype.canResume=function(){if(!e.prototype.canResume.call(this))return!1;if(this._isScaleRangeLayer()){var t=this.layer,r=t.minScale,i=t.maxScale;if(r>0||i>0){var n=this.view.scale;if(n<i||r>0&&n>r)return!1}}return!0},t.prototype.isUpdating=function(){return this._images.some((function(e){return!!e.loadingPromise}))},t.prototype.processResult=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t),[2]}))}))},t.prototype.findExtentInfoAt=function(e){for(var t=0,r=this._extents;t<r.length;t++){var i=r[t],n=i.extent;if(new u(n[0],n[1],n[2],n[3],i.spatialReference).contains(e))return i}return null},t.prototype.getFetchOptions=function(){},t.prototype.redraw=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n=this;return r.__generator(this,(function(a){switch(a.label){case 0:return[4,i.forEach(this._images,(function(i,a){return r.__awaiter(n,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return i?[4,e(i,t)]:[2];case 1:return r.sent(),this._createStageObjects(a,i.image),this.emit("draped-data-change"),[2]}}))}))}))];case 1:return a.sent(),[2]}}))}))},t.prototype._imageSizeDiffers=function(e,t,r){if(!this.maximumDataResolution)return!0;if(g.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;var i=c.width(e)/this.maximumDataResolution.x,n=c.height(e)/this.maximumDataResolution.y,a=i/t.width,o=n/t.height,s=i/r.width,l=n/r.height,u=Math.abs(a-s),d=Math.abs(o-l);return u>1.5||d>1.5},t.prototype._fetch=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,l,d,h,p,g,f,m=this;return r.__generator(this,(function(y){switch(y.label){case 0:return this.suspended?[2]:(i=this._overlayExtents[e],n=this._extents[e],s=n.extent,l=new u(s[0],s[1],s[2],s[3],n.spatialReference),this._images[e]||(this._images[e]={texture:null,material:null,rendergeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:c.create(s)}),(d=this._images[e]).loadingAbortController&&(d.loadingAbortController.abort(),d.loadingAbortController=null),0===l.width||0===l.height?(this._clearImage(e),[2]):(h=a.createAbortController(),d.loadingAbortController=h,a.onAbort(t,(function(){return h.abort()})),p=h.signal,g=this._waitFetchReady(p).then((function(){var e=r.__assign(r.__assign({requestAsImageElement:!0,pixelRatio:i.pixelRatio},m.getFetchOptions()),{signal:p}),t=n.imageSize,a=t.height,o=t.width;return m.layer.fetchImage(l,o,a,e)})).then((function(e){if(o.isAborted(p))throw w.warnOnce("A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true."),o.createAbortError();return m.processResult(d,e)})),d.loadingPromise=g,a.always(g,(function(){g===d.loadingPromise&&(d.loadingPromise=null,d.loadingAbortController=null)})),f=g.then((function(){c.set(d.renderExtent,s),m._createStageObjects(e,d.image),m.notifyChange("updating"),m.emit("draped-data-change")})).catch((function(e){throw e&&!a.isAbortError(e)&&w.error(e),m.notifyChange("updating"),e})),this.notifyChange("updating"),[4,f]));case 1:return y.sent(),[2]}}))}))},t.prototype.notifyGraphicUpdate=function(){},t.prototype._clearImage=function(e){var t=this._images[e],r=this.view._stage;t&&(t.rendergeometry&&(this.view.basemapTerrain.overlayManager.renderer.removeGeometries([t.rendergeometry],this,2),t.rendergeometry=null),t.texture&&(r.remove(4,t.texture.id),t.texture=null),t.material&&(r.remove(3,t.material.id),t.material=null),t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null)},t.prototype._createStageObjects=function(e,t){var r=this.view._stage,i=this._images[e];i.texture&&(r.remove(4,i.texture.id),i.texture=null),t?(i.texture=new m(t,"dynamicLayer",{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:33071,t:33071}}),r.add(4,i.texture)):i.material&&(r.remove(3,i.material.id),i.material=null),!i.material&&i.texture?(i.material=new y({transparent:!0,textureId:i.texture.id},"dynamicLayer"),r.add(3,i.material)):i.material&&t&&i.material.setParameterValues({textureId:i.texture.id});var n=this.view.basemapTerrain.overlayManager.renderer;if(i.material){var a=void 0,o=this._overlayExtents[e].renderLocalOrigin;if(0===e)a=h.createGeometryForExtent(i.renderExtent,-1);else{if(1!==e)return void console.error("DynamicLayerView3D._createStageObjects: Invalid extent idx");var s=this._images[0].renderExtent;if(!s)return;a=h.createOuterImageGeometry(s,i.renderExtent,-1)}var l=new f(a);l.material=i.material,l.origin=o,n.addGeometries([l],this,2),i.rendergeometry&&n.removeGeometries([i.rendergeometry],this,2),i.rendergeometry=l}else i.rendergeometry&&(n.removeGeometries([i.rendergeometry],this,2),i.rendergeometry=null)},t.prototype._isScaleRangeLayer=function(){return"minScale"in this.layer&&"maxScale"in this.layer},t.prototype._isScaleRangeActive=function(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)},t.prototype._clippedExtent=function(e,t){if("local"!==this.view.viewingMode)return c.set(t,e);var r=this.view.basemapTerrain,i=r.extent;return r.ready&&i?c.intersection(e,i,t):c.set(t,e)},t.prototype._suspendedChangeHandler=function(){this.suspended?(this.clear(),this.emit("draped-data-change")):this.refresh()},t.prototype._waitFetchReady=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this.updateWhenStationary?[4,s.whenOnce(this.view,"stationary",e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},r.__decorate([l.property()],t.prototype,"layer",void 0),r.__decorate([l.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),r.__decorate([l.property({type:Boolean})],t.prototype,"hasDraped",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"fullExtentInLocalViewSpatialReference",void 0),r.__decorate([l.property()],t.prototype,"updating",void 0),r.__decorate([l.subclass("esri.views.3d.layers.DynamicLayerView3D")],t)}(_.RefreshableLayerView(d.LayerView3D(v))),b=c.create();return x}.apply(null,i))||(e.exports=n)},1479:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(34),r(102),r(189),r(18)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){var r=[[e[0],e[1],t],[e[2],e[1],t],[e[2],e[3],t],[e[0],e[3],t]];return n.createSquareGeometry(r)}Object.defineProperty(t,"__esModule",{value:!0}),t.computeImageExportSize=function(e,t,i){var n=r.width(e)/r.height(e),a={width:i,height:i};return n>1.0001?a.height=i/n:n<.9999&&(a.width=i*n),a.width=Math.round(a.width/(r.width(e)/r.width(t))),a.height=Math.round(a.height/(r.height(e)/r.height(t))),a},t.createGeometryForExtent=o,t.createOuterImageGeometry=function(e,t,n){if(!r.intersects(e,t))return o(t,n);for(var l=[e[1]-t[1],Math.min(e[3],t[3])-Math.max(e[1],t[1]),t[3]-e[3],123456],u=[e[0]-t[0],Math.min(e[2],t[2])-Math.max(e[0],t[0]),t[2]-e[2],123456],c=t[2]-t[0],d=t[3]-t[1],h=u[0]>0&&u[2]>0?3:2,p=l[0]>0&&l[2]>0?3:2,g=(p+1)*(h+1),f=new Float64Array(3*g),m=new Float32Array(2*g),y=new Uint32Array(6*(p*h-1)),v=0,_=0,w=0,x=0,b=0,S=0;S<4;S++){var C=l[S];if(!(C<=0)){for(var P=0,E=0;E<4;E++){var O=u[E];O<=0||(f[_++]=t[0]+P,f[_++]=t[1]+v,f[_++]=n,m[w++]=P/c,m[w++]=v/d,E<3&&S<3&&(1!==E||1!==S)&&(y[b++]=x,y[b++]=x+1,y[b++]=x+h+1,y[b++]=x+1,y[b++]=x+h+2,y[b++]=x+h+1),x++,P+=O)}v+=C}}var D={};D[a.VertexAttrConstants.POSITION]={size:3,data:f},D[a.VertexAttrConstants.NORMAL]={size:3,data:s},D[a.VertexAttrConstants.UV0]={size:2,data:m};for(var A={},M=new Uint32Array(y.length),R=0;R<M.length;R++)M[R]=0;return A[a.VertexAttrConstants.POSITION]=y,A[a.VertexAttrConstants.NORMAL]=M,A[a.VertexAttrConstants.UV0]=y,new i.GeometryData(D,A)};var s=new Float32Array([0,0,1])}.apply(null,i))||(e.exports=n)},1480:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(435),r(109),r(317),r(58),r(58),r(130),r(1481)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u){var c=function(e){function t(t,r){var i=e.call(this,r)||this;return i.supportsEdges=!0,i.techniqueConfig=new u.ImageMaterialTechniqueConfiguration,i.params=s.copyParameters(t,h),i}return r.__extends(t,e),t.prototype.setParameterValues=function(e){o.updateParameters(this.params,e)&&this.parametersChanged()},t.prototype.getParameters=function(){return this.params},t.prototype.getTechniqueConfig=function(e){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig},t.prototype.intersect=function(e,t,r,i,n,a,o){s.intersectTriangleGeometry(e,t,i,n,a,void 0,o)},t.prototype.getGLMaterial=function(e){return 0===e.output||4===e.output?new d(e):void 0},t.prototype.createBufferWriter=function(){return new a.DefaultBufferWriter(a.PositionUVLayout)},t.prototype.createRenderer=function(e,t){return new l(e,t,this)},t}(n.Material),d=function(e){function t(t){var i=e.call(this,r.__assign(r.__assign({},t),t.material.getParameters()))||this;return i.updateParameters(),i}return r.__extends(t,e),t.prototype.updateParameters=function(){var e=this.material.getParameters();this.updateTexture(e.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(u.ImageMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)},t.prototype.beginSlot=function(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)},t.prototype._updateOccludeeState=function(e){e.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())},t.prototype.ensureParameters=function(e){0===this.output&&this._updateOccludeeState(e)},t.prototype.bind=function(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.getParameters(),t)},t.prototype.getPipelineState=function(e,t){return t?this.technique.opaqueOccludeeState:this.technique.pipeline},t}(i),h={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0};return c}.apply(null,i))||(e.exports=n)},1481:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(44),r(64),r(52),r(55),r(59),r(43),r(150),r(1431),r(45),r(41),r(41),r(14)],void 0===(n=function(e,t,i,n,a,o,s,l,u,c,d,h,p,g){Object.defineProperty(t,"__esModule",{value:!0});var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(t,e),t.prototype.initializeProgram=function(e){var r=t.shader.get(),i=this.configuration,n=r.build({slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new h(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),u.Default3D)},t.prototype.bindPass=function(e,t,r){this.program.setUniform1f("opacity",t.opacity)},t.prototype.bindDraw=function(e){a.Transform.bindUniforms(this.program,e),n.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},t.prototype.initializePipeline=function(){var e=this.configuration,t=0===e.output&&e.transparent?p.simpleBlendingParams(1,771):null,r=function(r){return g.makePipelineState({blending:t,polygonOffset:e.polygonOffset&&m,culling:(i=e.cullFace,0!==i&&{face:1===i?1028:1029,mode:2305}),depthTest:c.depthCompareLess,depthWrite:e.writeDepth&&g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?c.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?r?c.stencilToolMaskBaseParams:c.stencilBaseAllZerosParams:null});var i};return this._occludeeState=r(!0),r(!1)},Object.defineProperty(t.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!0,configurable:!0}),t.shader=new o.ReloadableShaderModule(d,(function(){return new Promise((function(e,t){Promise.resolve().then(function(){var t=[r(1431)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))})),t}(s.ShaderTechnique);t.ImageMaterialTechnique=f;var m={factor:1,units:1},y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.transparent=!1,t.polygonOffset=!1,t.writeDepth=!0,t.sceneHasOcludees=!1,t}return i.__extends(t,e),i.__decorate([l.parameter({count:7})],t.prototype,"output",void 0),i.__decorate([l.parameter({count:3})],t.prototype,"cullFace",void 0),i.__decorate([l.parameter()],t.prototype,"slicePlaneEnabled",void 0),i.__decorate([l.parameter()],t.prototype,"sliceHighlightDisabled",void 0),i.__decorate([l.parameter()],t.prototype,"transparent",void 0),i.__decorate([l.parameter()],t.prototype,"polygonOffset",void 0),i.__decorate([l.parameter()],t.prototype,"writeDepth",void 0),i.__decorate([l.parameter()],t.prototype,"sceneHasOcludees",void 0),t}(l.ShaderTechniqueConfiguration);t.ImageMaterialTechniqueConfiguration=y}.apply(null,i))||(e.exports=n)}}]);