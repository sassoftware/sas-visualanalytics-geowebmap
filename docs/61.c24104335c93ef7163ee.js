(function(){var e={"esri/views/2d/layers/ImageryTileLayerView2D":1357,"esri/views/layers/support/ClipArea":1389,"esri/views/2d/layers/LayerView2D":1391,"esri/views/layers/support/ClipRect":1392,"esri/views/layers/support/Geometry":1393,"esri/views/layers/support/Path":1394,"esri/layers/support/rasterDatasets/RawBlockCache":1665,"esri/layers/support/rasterDatasets/EphemeralBlockCache":1666},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{1357:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(0),r(28),r(91),r(25),r(5),r(2),r(4),r(15),r(13),r(1),r(1423),r(172),r(1665),r(1456),r(1491),r(675),r(1391),r(688),r(695),r(705),r(1767),r(678),r(679),r(1418)],void 0===(s=function(e,t,r,i,s,o,n,a,l,u,c,h,p,d,y,f,_,m,g,b,v,w,x,R,P,k){var I=n.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),C=[0,0];return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._tileStrategy=null,t._tileInfoView=null,t._fetchQueue=null,t._blockCacheRegistryUrl=null,t._blockCacheRegistryId=null,t._bitmapView=null,t._emptyTilePixelBlock=null,t._previousSrcResolution=null,t._needBlockCacheUpdate=!1,t._globalSymbolizerParams=null,t._symbolizerParams=null,t._abortController=null,t._globalUpdateRequested=!1,t.useWebGLForProcessing=null,t.datumTransformation=null,t.layer=null,t._redrawDebounced=l.debounce((function(e){return t._redrawImage(e)}),2e3),t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this.updateFullExtent();this.addResolvingPromise(e)},Object.defineProperty(t.prototype,"useProgressiveUpdate",{get:function(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")},set:function(e){var t=this;this._tileStrategy&&this.useProgressiveUpdate!==e&&(this._tileStrategy.destroy(),this._bitmapView.removeAllChildren(),this._tileStrategy=new w({cachePolicy:e?"keep":"purge",resampling:!1,acquireTile:function(e){return t.acquireTile(e)},releaseTile:function(e){return t.releaseTile(e)},cacheSize:e?40:0,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.requestUpdate())},enumerable:!0,configurable:!0}),t.prototype.hitTest=function(e,t){if(this.suspended)return l.resolve(null);var r=this.view.toMap(u.createScreenPoint(e,t));return l.resolve(new s({attributes:{},geometry:r}))},t.prototype.update=function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var t=!this.useProgressiveUpdate||this._needBlockCacheUpdate;if(this.layer.raster&&t){var r=e.state,s=r.extent,o=r.resolution,n=this._previousViewResolution===o?this._previousSrcResolution:_.projectResolution(new i.Point({x:o,y:o,spatialReference:this.view.spatialReference}),this.layer.spatialReference,this.fullExtent,this.datumTransformation),a=s.toJSON?s:i.Extent.fromJSON(s);y.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,a,o,n,this.layer.raster.ioConfig.sampling),this._previousViewResolution!==o&&(this._previousViewResolution=o,null!=this._symbolizerParams&&this._updateSymbolizerParams()),this._previousSrcResolution=n,this._needBlockCacheUpdate=!1}this.notifyChange("updating")},t.prototype.attach=function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),null==this.useWebGLForProcessing&&(this.useWebGLForProcessing=this.layer.symbolizer.canRenderInWebGL),o("esri-webgl-texture-float")&&o("esri-webgl-color-buffer-float")||(this.useWebGLForProcessing=!1),this.layer.raster&&(this.layer.raster.ioConfig.allowPartialFill=!0);var t=this._createTileInfo();this._set("tileInfo",t),this._tileInfoView=new b(t,this.fullExtent),this._fetchQueue=new v({tileInfoView:this._tileInfoView,concurrency:10,process:function(t,r){return e.fetchTile(t,r)}}),this._tileStrategy=new w({cachePolicy:this.useProgressiveUpdate?"keep":"purge",resampling:!1,acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},cacheSize:this.useProgressiveUpdate?40:0,tileInfoView:this._tileInfoView}),this._bitmapView=new m.RasterTileContainer(this._tileInfoView),this.container.addChild(this._bitmapView),this.handles.add([c.watch(this,["layer.interpolation","layer.bandIds","layer.renderer"],(function(){return e._redrawDebounced().catch((function(e){l.isAbortError(e)||I.error(e)}))})),c.watch(this,["layer.multidimensionalDefinition"],this.refreshDebounced)],"attach"),this._updateBlockCacheRegistry()},t.prototype.detach=function(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,y.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId)},t.prototype.moveStart=function(){this.requestUpdate()},t.prototype.viewChange=function(){this.requestUpdate()},t.prototype.moveEnd=function(){var e=this;!this.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=l.createAbortController(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((function(){e._globalUpdateRequested=!1,e.requestUpdate()}))),this.requestUpdate()},t.prototype.createFetchPopupFeaturesQueryGeometry=function(e,t){return k.createQueryGeometry(e,t,this.view)},t.prototype.doRefresh=function(){return r.__awaiter(this,void 0,void 0,(function(){var e=this;return r.__generator(this,(function(t){return this.updateRequested||this.suspended||(this._updateSymbolizerParams(),this._updateBlockCacheRegistry(),this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((function(t){return e._enqueueTileFetch(t)})),this.notifyChange("updating")),[2]}))}))},t.prototype.isUpdating=function(){return this._fetchQueue.length>0||this._globalUpdateRequested},t.prototype.acquireTile=function(e){var t,r,i=this._bitmapView.createTile(e),s=i.bitmap;return t=this._tileInfoView.getTileCoords(C,i.key),s.x=t[0],s.y=t[1],s.resolution=this._tileInfoView.getTileResolution(i.key),r=this._tileInfoView.tileInfo.size,s.width=r[0],s.height=r[1],this._enqueueTileFetch(i),this.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate,i},t.prototype.releaseTile=function(e){var t=this;this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",(function(){e.destroy(),t.requestUpdate()})),this.requestUpdate()},t.prototype.fetchTile=function(e,t){var r=!a.isNone(t)&&t.signal,i={tileInfo:this.tileInfo,signal:a.unwrap(r),registryId:this._blockCacheRegistryId,requestRawData:this.useWebGLForProcessing,srcResolution:this._previousSrcResolution,datumTransformation:this.datumTransformation};return this.layer.fetchTile(e.level,e.row,e.col,i)},t.prototype._createTileInfo=function(){var e=this.view.spatialReference,t=new i.Point({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:e}),r=d.create({spatialReference:e,size:512});return(0===r.origin.x||r.origin.x>t.x)&&(r.origin=t),r},t.prototype._enqueueTileFetch=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var t,i,s,o,n,a,u,c,h=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(this._fetchQueue.has(e.key.id))return[2];r.label=1;case 1:return r.trys.push([1,13,,14]),[4,this._fetchQueue.push(e.key)];case 2:if(t=r.sent(),i=this.layer.bandIds,s=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams,!this._globalUpdateRequested||this.moving||0!==this._fetchQueue.length)return[3,7];s=!1,r.label=3;case 3:return r.trys.push([3,5,,6]),[4,this._redrawImage(this._abortController&&this._abortController.signal)];case 4:return r.sent(),[3,6];case 5:return o=r.sent(),l.isAbortError(o)&&I.error(o),[3,6];case 6:this._globalUpdateRequested=!1,r.label=7;case 7:return this.useWebGLForProcessing&&!this.hasTilingEffects&&null==this._symbolizerParams&&this._updateSymbolizerParams(),t&&t.pixelBlock?this.useWebGLForProcessing?[3,9]:(n={extent:t.extent,pixelBlock:t.pixelBlock},[4,this.layer.applyRenderer(n,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null)]):[3,11];case 8:return a=r.sent(),e.bitmap.rawPixelData=n,e.bitmap.source=a,[3,10];case 9:e.bitmap.source=t.pixelBlock,r.label=10;case 10:return e.bitmap.symbolizerParameters=this.useWebGLForProcessing?this._globalSymbolizerParams||this._symbolizerParams:null,!e.bitmap.transformGrid&&this.useWebGLForProcessing&&(e.bitmap.transformGrid=t.transformGrid),[3,12];case 11:u=this._createEmptyTilePixelBlock(),e.bitmap.source=u,e.bitmap.symbolizerParameters=this.useWebGLForProcessing?this._symbolizerParams:null,e.bitmap.transformGrid=null,r.label=12;case 12:return e.bitmap.bandIds=i,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.bitmap.interpolation=this._getLayerInterpolation(),e.bitmap.suspended=s,e.bitmap.invalidateTexture(),e.once("attach",(function(){return h.requestUpdate()})),this._bitmapView.addChild(e),[3,14];case 13:return c=r.sent(),l.isAbortError(c)||I.error(c),[3,14];case 14:return this.requestUpdate(),[2]}}))}))},t.prototype._redrawImage=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,s=this;return r.__generator(this,(function(o){switch(o.label){case 0:return this.layer.updateRenderer(),this.hasTilingEffects?[4,this._updateGlobalSymbolizerParams(e)]:[3,2];case 1:return o.sent(),[3,3];case 2:this._updateSymbolizerParams(),this._globalSymbolizerParams=null,o.label=3;case 3:return t=this.layer.bandIds,i=this._bitmapView.children.map((function(e){return r.__awaiter(s,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return this.useWebGLForProcessing?[3,2]:(i=e.bitmap,[4,this.layer.applyRenderer(e.bitmap.rawPixelData,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null)]);case 1:i.source=r.sent(),r.label=2;case 2:return e.bitmap.symbolizerParameters=this.useWebGLForProcessing?this._globalSymbolizerParams||this._symbolizerParams:null,e.bitmap.bandIds=t,e.bitmap.interpolation=this._getLayerInterpolation(),e.bitmap.suspended=!1,[2]}}))}))})),[4,l.eachAlways(i)];case 4:return o.sent(),this.container.requestRender(),[2]}}))}))},t.prototype._createEmptyTilePixelBlock=function(){if(!this._emptyTilePixelBlock){var e=this._tileInfoView.tileInfo.size[0],t=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new p({width:e,height:t,pixels:[new Uint8Array(e*t)],mask:new Uint8Array(e*t),pixelType:"u8"})}return this._emptyTilePixelBlock},t.prototype._updateGlobalSymbolizerParams=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:return t={srcResolution:this._previousSrcResolution,registryId:this._blockCacheRegistryId,signal:e},[4,this.layer.fetchPixels(this.view.extent,this.view.width,this.view.height,t)];case 1:return(i=r.sent())&&i.pixelBlock?(s=this.layer.symbolizer.generateWebGLParameters({pixelBlock:f.extractBands(i.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousViewResolution,y:this._previousViewResolution},bandIds:this.layer.bandIds}),!this.useWebGLForProcessing&&s&&"stretch"===s.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(s.factor=s.factor.map((function(e){return 255*e})),s.outMin=Math.round(255*s.outMin),s.outMax=Math.round(255*s.outMax)),this._globalSymbolizerParams=s,[2]):[2]}}))}))},t.prototype._updateSymbolizerParams=function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousViewResolution,y:this._previousViewResolution},bandIds:this.layer.bandIds})},t.prototype._updateBlockCacheRegistry=function(){var e=this.layer,t=e.url,r=e.rasterInfo,i=e.multidimensionalDefinition,s=e.raster,o=i&&r&&r.multidimensionalInfo?t+"?sliceId="+s.getSliceIndex(i):t;o!==this._blockCacheRegistryUrl&&(null==this._blockCacheRegistryUrl&&y.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=y.register(o,this.layer.raster.rasterInfo),this._blockCacheRegistryUrl=o)},t.prototype._getLayerInterpolation=function(){var e=this.layer.renderer.type;return"raster-colormap"===e||"unique-value"===e||"class-breaks"===e?"nearest":this.layer.interpolation},r.__decorate([h.property()],t.prototype,"useProgressiveUpdate",null),r.__decorate([h.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],t)}(x.ImageryTileLayerView(P.RefreshableLayerView(g.LayerView2DMixin(R))))}.apply(null,i))||(e.exports=s)},1389:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(0),r(7),r(1)],void 0===(s=function(e,t,r,i,s){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),r.__decorate([s.subclass("esri.views.layers.support.ClipArea")],t)}(i.JSONSupport)}.apply(null,i))||(e.exports=s)},1391:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(0),r(23),r(143),r(13),r(1),r(675),r(1389),r(1392),r(1393),r(1394)],void 0===(s=function(e,t,r,i,s,o,n,a,l,u,c,h){Object.defineProperty(t,"__esModule",{value:!0});var p=i.ofType({key:"type",base:l,typeMap:{rect:u,path:h,geometry:c}});t.LayerView2DMixin=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clips=new p,t.moving=!1,t.attached=!1,t.lastUpdateId=-1,t.updateRequested=!1,t}return r.__extends(t,e),t.prototype.initialize=function(){var e,t=this;this.container||(this.container=new a.Container),this.handles.add([o.init(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),o.init(this,["layer.opacity","container"],(function(){var e,r;t.container&&(t.container.opacity=null!==(r=null===(e=t.layer)||void 0===e?void 0:e.opacity)&&void 0!==r?r:1)}),!0),o.init(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),this.container.clips=this.clips,(null===(e=this.view)||void 0===e?void 0:e.whenLayerView)?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))},t.prototype.destroy=function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1,this.layer=null,this.view=null},Object.defineProperty(t.prototype,"updating",{get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0}),t.prototype.isVisibleAtScale=function(e){var t=!0,r=this.layer,i=r.minScale,s=r.maxScale;if(null!=i&&null!=s){var o=!i,n=!s;!o&&e<=i&&(o=!0),!n&&e>=s&&(n=!0),t=o&&n}return t},t.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())},t.prototype.processUpdate=function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1},t.prototype.isUpdating=function(){return!1},t.prototype.isRendering=function(){return!1},t.prototype.canResume=function(){return!!e.prototype.canResume.call(this)&&this.isVisibleAtScale(this.view.scale)},r.__decorate([n.property({type:p,set:function(e){var t=s.referenceSetter(e,this._get("clips"),p);this._set("clips",t)}})],t.prototype,"clips",void 0),r.__decorate([n.property()],t.prototype,"moving",void 0),r.__decorate([n.property()],t.prototype,"attached",void 0),r.__decorate([n.property()],t.prototype,"container",void 0),r.__decorate([n.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),r.__decorate([n.property({readOnly:!0})],t.prototype,"updateParameters",void 0),r.__decorate([n.property()],t.prototype,"updateRequested",void 0),r.__decorate([n.property({dependsOn:["attached","updateRequested","suspended"]})],t.prototype,"updating",null),r.__decorate([n.property()],t.prototype,"view",void 0),r.__decorate([n.subclass("esri.views.2d.layers.LayerView2D")],t)}(e)}}.apply(null,i))||(e.exports=s)},1392:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(0),r(1),r(1389)],void 0===(s=function(e,t,r,i,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="rect",t.left=null,t.right=null,t.top=null,t.bottom=null,t}var s;return r.__extends(t,e),s=t,t.prototype.clone=function(){return new s({left:this.left,right:this.right,top:this.top,bottom:this.bottom})},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),r.__decorate([i.property({type:[Number,String],json:{write:!0}})],t.prototype,"left",void 0),r.__decorate([i.property({type:[Number,String],json:{write:!0}})],t.prototype,"right",void 0),r.__decorate([i.property({type:[Number,String],json:{write:!0}})],t.prototype,"top",void 0),r.__decorate([i.property({type:[Number,String],json:{write:!0}})],t.prototype,"bottom",void 0),r.__decorate([i.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],t.prototype,"version",null),s=r.__decorate([i.subclass("esri.views.layers.support.ClipRect")],t)}(s)}.apply(null,i))||(e.exports=s)},1393:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(0),r(28),r(1),r(126),r(29),r(1389)],void 0===(s=function(e,t,r,i,s,o,n,a){var l={base:o,key:"type",typeMap:{extent:i.Extent,polygon:i.Polygon}};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="geometry",t.geometry=null,t}var i;return r.__extends(t,e),i=t,Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i({geometry:this.geometry.clone()})},r.__decorate([s.property({types:l,json:{read:n.fromJSON,write:!0}})],t.prototype,"geometry",void 0),r.__decorate([s.property({readOnly:!0,dependsOn:["geometry"]})],t.prototype,"version",null),i=r.__decorate([s.subclass("esri.views.layers.support.Geometry")],t)}(a)}.apply(null,i))||(e.exports=s)},1394:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(0),r(1),r(1389)],void 0===(s=function(e,t,r,i,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="path",t.path=[],t}return r.__extends(t,e),Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),r.__decorate([i.property({type:[[[Number]]],json:{write:!0}})],t.prototype,"path",void 0),r.__decorate([i.property({readOnly:!0,dependsOn:["path"]})],t.prototype,"version",null),r.__decorate([i.subclass("esri.views.layers.support.Path")],t)}(s)}.apply(null,i))||(e.exports=s)},1665:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(28),r(1666),r(1491)],void 0===(s=function(e,t,r,i,s){Object.defineProperty(t,"__esModule",{value:!0});var o=new Map,n=new i;t.register=function(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(o.has(e)){var i=o.get(e);return i.push(r),i.length-1}return o.set(e,[r]),0},t.unregister=function(e,t){o.has(e)&&(o.get(e)[t]=null)},t.deleteRaster=function(e){o.delete(e)},t.decreaseRefCount=function(e,t,r){if(!o.has(e))return null==t?n.decreaseRefCount(e,r):0;var i=o.get(e);if(null==i[t])return n.decreaseRefCount(e,r);var s=i[t].cache;if(s.has(r)){var a=s.get(r);if(a.refCount--,0===a.refCount){s.delete(r);for(var l=0;l<i.length;l++)i[l]&&i[l].cache.has(r)&&i[l].cache.delete(r);a.controller&&a.controller.abort()}return a.refCount}return 0},t.getBlock=function(e,t,r){if(!o.has(e))return null==t?n.getBlock(e,r):null;var i=o.get(e);if(null==i[t]){for(var s=0;s<i.length;s++)if(i[s]&&i[s].cache.has(r))return(a=i[s].cache.get(r)).refCount++,a.block;return n.getBlock(e,r)}var a,l=i[t].cache;if(l.has(r))return(a=l.get(r)).refCount++,a.block;for(s=0;s<i.length;s++)if(s!==t&&i[s]&&i[s]&&i[s].cache.has(r)){var u=i[s].cache.get(r);return u.refCount++,l.set(r,u),u.block}return null},t.putBlock=function(e,t,r,i,s){if(void 0===s&&(s=null),o.has(e)){var a=o.get(e);null!=a[t]?a[t].cache.set(r,{refCount:1,block:i,controller:s}):n.putBlock(e,r,i,s)}else null==t&&n.putBlock(e,r,i,s)},t.deleteBlock=function(e,t,r){if(o.has(e)){var i=o.get(e);null!=i[t]?i[t].cache.delete(r):n.deleteBlock(e,r)}else null==t&&n.deleteBlock(e,r)},t.update=function(e,t,i,n,a,l,u){void 0===u&&(u=null);var c=function(e,t){if(!o.has(e))return null;var r=o.get(e);return null==r[t]?null:r[t]}(e,t),h=c.extent,p=c.cache,d=c.rasterInfo,y=i.clone().normalize();if(i=y[0],!h||h.xmin!==i.xmin||h.xmax!==i.xmax||h.ymin!==i.ymin||h.ymax!==i.ymax){var f=d.spatialReference,_=s.projectExtent(i,f,u),m=new r.Point({x:n,y:n,spatialReference:i.spatialReference});if(null!==a||(a=s.projectResolution(m,f,i,u))){var g=s.snapPyramid(a,d,l||"closest"),b=g.pyramidLevel,v=g.pyramidResolution;if(!g.excessiveReading){for(var w=Math.floor((_.xmin-d.storageInfo.origin.x)/v.x),x=Math.floor((d.storageInfo.origin.y-_.ymax)/v.y),R=Math.ceil((_.xmax-_.xmin)/v.x-.1),P=Math.ceil((_.ymax-_.ymin)/v.y-.1),k=b>0?d.storageInfo.pyramidBlockWidth:d.storageInfo.blockWidth,I=b>0?d.storageInfo.pyramidBlockHeight:d.storageInfo.blockHeight,C=Math.floor(w/k),S=Math.floor(x/I),z=Math.floor((w+R-1)/k),U=Math.floor((x+P-1)/I),T=new Set,B=S-1;B<=U+1;B++)for(var V=C-1;V<=z+1;V++)T.add(b+"/"+B+"/"+V);p.forEach((function(e,t){T.has(t)||p.delete(t)})),c.extent={xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax}}}}}}.apply(null,i))||(e.exports=s)},1666:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(67)],void 0===(s=function(e,t,r){return function(){function e(e,t){void 0===e&&(e=15e3),void 0===t&&(t=5e3),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}return e.prototype.decreaseRefCount=function(e,t){var r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){var s=i.get(r);return s.refCount--,s.refCount<=0&&(i.delete(r),s.controller&&s.controller.abort()),s.refCount}return 0},e.prototype.getBlock=function(e,t){var r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){var s=i.get(r);return s.ts=Date.now(),s.refCount++,i.delete(r),i.set(r,s),s.block}return null},e.prototype.putBlock=function(e,t,r,i){void 0===i&&(i=null);var s=this._cachedBlocks,o=e+"/"+t;if(s.has(o)){var n=s.get(o);n.ts=Date.now(),n.refCount++}else s.set(o,{block:r,ts:Date.now(),refCount:1,controller:i});this.trim(),this.updateTimer()},e.prototype.deleteBlock=function(e,t){var r=this._cachedBlocks,i=e+"/"+t;r.has(i)&&r.delete(i)},e.prototype.updateMaxSize=function(e){this._size=e,this.trim()},e.prototype.empty=function(){this._cachedBlocks.clear(),this.clearTimer()},e.prototype.getCurrentSize=function(){return this._cachedBlocks.size},e.prototype.updateTimer=function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var i=r.pairsOfMap(t),s=Date.now(),o=0;o<i.length&&i[o][1].ts<=s-e._duration;o++)t.delete(i[o][0]);0===t.size&&e.clearTimer()}),this._interval)}},e.prototype.trim=function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=r.pairsOfMap(e),i=0;i<t.length-this._size;i++)e.delete(t[i][0])},e.prototype.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)},e}()}.apply(null,i))||(e.exports=s)}}]);