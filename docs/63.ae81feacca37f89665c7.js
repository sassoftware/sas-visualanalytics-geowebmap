(function(){var e={"esri/views/3d/layers/VectorTileLayerView3D":1381,"esri/views/2d/engine/vectorTiles/RectangleBinPack":1531,"esri/views/2d/engine/vectorTiles/TileHandler":1668,"esri/views/2d/engine/vectorTiles/GlyphMosaic":1669,"esri/views/2d/engine/vectorTiles/GlyphSource":1670,"esri/views/2d/engine/vectorTiles/SpriteMosaic":1671,"esri/views/2d/engine/vectorTiles/FadeRecorder":1672,"esri/views/2d/engine/vectorTiles/VTLPainter3D":2011},t=this||window,i=t.webpackJsonp=t.webpackJsonp||[];i.registerAbsMids?i.registerAbsMids(e):(i.absMidsWaiting=i.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{1381:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(4),i(13),i(1),i(771),i(1668),i(2011),i(680),i(712),i(96),i(678)],void 0===(n=function(e,t,i,r,n,s,a,o,h,l,u,c,p){return function(e){function t(t){return e.call(this,t)||this}return i.__extends(t,e),t.prototype.initialize=function(){var e=this,t=c.test.force512VTL?this.layer.tileInfo:this.layer.compatibleTileInfo256,i=this._getTileInfoSupportError(t,this.layer.fullExtent);if(i)this.addResolvingPromise(r.reject(i));else{var s=n.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then((function(){var t,i=e.view.basemapTerrain.tilingScheme,r=i.pixelSize;e.schemaHelper=new a(r,e.view.spatialReference.isGeographic),t=256===r?e.layer.compatibleTileInfo256:e.view.spatialReference.isGeographic?e.layer.compatibleTileInfo512:e.layer.tileInfo;var n=e._getTileInfoCompatibilityError(t,i);if(n)throw n;e._set("tileInfo",t)})),l=r.createAbortController();this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid,(function(t){return e.tileHandler.releaseVectorTile(t)}));var u=this.view.resourceController.scheduler;this.tileHandler=new o.TileHandler(this.layer,this.view.pixelRatio,!1,null,this._memCache,!1);var p=this.tileHandler.start({signal:l.signal,scheduler:u}),d=this.tileHandler.spriteMosaic;d.then((function(t){return e.painter=new h.default(t,e.tileHandler.glyphMosaic)})),p.then((function(){return l=null}));var _=function(){l&&l.abort(),l=r.createAbortController(),e._memCache.clear();var t=new o.TileHandler(e.layer,e.view.pixelRatio,!1,null,e._memCache,!1),i=t.start({signal:l.signal,scheduler:u}),n=t.spriteMosaic;i.then((function(){return l=null})),e.updatingHandles.addPromise(r.all([i,n]).then((function(i){var r=i[1],n=e.tileHandler,s=e.painter;e.painter=new h.default(r,t.glyphMosaic),e.tileHandler=t,e.emit("data-changed"),n.destroy(),s&&s.dispose()})))};this.updatingHandles.add(this,"layer.currentStyleInfo",_),this.updatingHandles.add(this,"view.pixelRatio",_);var g=r.all([s,p,d]);this.addResolvingPromise(g)}},t.prototype.destroy=function(){this._memCache&&(this._memCache.destroy(),this._memCache=null),this.painter&&(this.painter.dispose(),this.painter=null),this.tileHandler&&(this.tileHandler.destroy(),this.tileHandler=null)},Object.defineProperty(t.prototype,"dataLevelRange",{get:function(){var e=this.tileInfo.lods,t=e[0].scale,i=e[e.length-1].scale,r=this.levelRangeFromScaleRange(t,i);return 1===r.minLevel&&256===this.tileInfo.size[0]&&(r.minLevel=0),r},enumerable:!0,configurable:!0}),i.__decorate([s.property({aliasOf:"layer.fullExtent"})],t.prototype,"fullExtent",void 0),i.__decorate([s.property()],t.prototype,"layer",void 0),i.__decorate([s.property()],t.prototype,"tileInfo",void 0),i.__decorate([s.property()],t.prototype,"dataLevelRange",null),i.__decorate([s.property()],t.prototype,"updatingProgressValue",void 0),i.__decorate([s.subclass("esri.views.3d.layers.VectorTileLayerView3D")],t)}(u.TiledLayerView3D(l.LayerView3D(p)))}.apply(null,r))||(e.exports=n)},1531:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1424)],void 0===(n=function(e,t,i){return function(){function e(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new i.default(0,0,e,t))}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.allocate=function(e,t){if(e>this._width||t>this._height)return new i.default;for(var r=null,n=-1,s=0;s<this._free.length;++s){var a=this._free[s];e<=a.width&&t<=a.height&&(null===r||a.y<=r.y&&a.x<=r.x)&&(r=a,n=s)}return null===r?new i.default:(this._free.splice(n,1),r.width<r.height?(r.width>e&&this._free.push(new i.default(r.x+e,r.y,r.width-e,t)),r.height>t&&this._free.push(new i.default(r.x,r.y+t,r.width,r.height-t))):(r.width>e&&this._free.push(new i.default(r.x+e,r.y,r.width-e,r.height)),r.height>t&&this._free.push(new i.default(r.x,r.y+t,e,r.height-t))),new i.default(r.x,r.y,e,t))},e.prototype.release=function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)},e}()}.apply(null,r))||(e.exports=n)},1668:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(33),i(25),i(708),i(2),i(315),i(4),i(238),i(34),i(442),i(693),i(1669),i(1670),i(1671),i(740),i(175)],void 0===(n=function(e,t,i,r,n,s,a,o,h,l,u,c,p,d,_,g,f,y){Object.defineProperty(t,"__esModule",{value:!0});var v=new s(10),m=new Map,w=function(){function e(e,t,i,r,n,s){this._vectorTileLayer=e,this.devicePixelRatio=t,this.allowUpdates=i,this._container=r,this._memCache=n,this._enableCachingWorkerTiles=s,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._updateToAbortController=new Map,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map}return e.prototype.destroy=function(){this._updateToAbortController&&this._updateToAbortController.forEach((function(e){return e.abort()})),this._ongoingTileRequests&&this.abortAll(),this._connection&&(this._connection.close(),this._connection=null),this._vectorTileLayer=null,this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)},Object.defineProperty(e.prototype,"spriteMosaic",{get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0}),e.prototype.start=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r,s,a,o,u=this;return i.__generator(this,(function(c){for(s in t=this._vectorTileLayer.sourceNameToSource,r=[],t)r.push(this._fetchTileMap(t[s],e));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,e),this._spriteSourcePromise.then((function(e){u._spriteMosaic=new g(1024,1024,250),u._spriteMosaic.setSpriteSource(e),n("stable-symbol-rendering")&&u._spriteMosaic.preloadSpriteItems()})),a=this._vectorTileLayer.styleRepository,o=new _(a.glyphs),this._glyphMosaic=new d(1024,1024,o),this._broadcastPromise=l.open("WorkerTileHandler",{client:this,scheduler:e.scheduler,signal:e.signal}).then((function(t){return u._connection=t,h.all(u._connection.broadcast("setLayers",{style:a.styleJSON,enableCachingTiles:u._enableCachingWorkerTiles},i.__assign({},e)))})),[2,h.all(r)]}))}))},e.prototype.updateStyle=function(){return i.__awaiter(this,void 0,void 0,(function(){var e,t=this;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this._broadcastPromise];case 1:return i.sent(),this._updateToAbortController.forEach((function(e){return e.abort()})),this._updateToAbortController.clear(),e=this._vectorTileLayer.styleRepository,this._broadcastPromise=h.create((function(i,r){h.all(t._connection.broadcast("updateStyle",e.styleJSON)).then(i,r)})),[2,this._broadcastPromise]}}))}))},e.prototype.abortTileUpdate=function(e){this._updateToAbortController.has(e)&&(this._updateToAbortController.get(e).abort(),this._updateToAbortController.delete(e))},e.prototype.updateTile=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,s,a,o=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this.allowUpdates&&e.isReady?[4,this._broadcastPromise]:[2];case 1:return i.sent(),r=Math.round(p.degToByte(t.state.rotation)),e.rotation===r?[2,null]:(s=e.key,this._updateToAbortController.has(s.id)&&((n=this._updateToAbortController.get(s.id)).abort(),this._updateToAbortController.delete(s.id)),n=h.createAbortController(),e.rotation=r,a=e.client.invoke("updateSymbols",{key:e.id,rotation:r},{signal:n.signal}).then((function(t){o._updateToAbortController.delete(s.id),e.isReady&&e.updateSymbolData(t)})).catch((function(e){h.isAbortError(e)||o._updateToAbortController.delete(s.id)})),this._updateToAbortController.set(e.id,n),[2,a])}}))}))},e.prototype.updateTileData=function(e){for(var t,i=e.tileId,r=this._container.children,n=0;n<r.length;n++)if((t=r[n]).id===i){t.updateTileData(e.tileData);break}},e.prototype.getVectorTile=function(e,t,r,n){return i.__awaiter(this,void 0,void 0,(function(){var s,l,p,d,_,g,f;return i.__generator(this,(function(i){switch(i.label){case 0:return s=new y(e,t,r,0),a.isSome(this._memCache)&&(l=this._memCache.get(s.id),a.isSome(l))?(l.reference(),[2,l]):[4,this._getVectorTileData(s)];case 1:return p=i.sent(),h.throwIfAborted(n),a.isSome(this._memCache)&&(d=this._memCache.get(s.id),a.isSome(d))?(d.reference(),[2,d]):this._vectorTileLayer?(_=this._vectorTileLayer.tileInfo,g=_.getTileBounds(u.create(),s),f=new c.VectorTile(s,this._vectorTileLayer.styleRepository,g,[512,512],0,!1),p&&p.tileData?(f.setData(p.tileData,p.client),a.isSome(this._memCache)&&(f.reference(),this._memCache.put(f.key.id,f,f.getMemoryUsage()*f.referenced,o.MIN_PRIORITY))):f.setData(null,null),[2,f]):[2,null]}}))}))},e.prototype.releaseVectorTile=function(e){a.isNone(this._memCache)||e.release()||this._memCache.updateSize(e.key.id,e,e.getMemoryUsage()*e.referenced)},e.prototype.fetchTileData=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,s,a;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this._getRefKeys(e,t)];case 1:for(a in r=i.sent(),n=this._vectorTileLayer.sourceNameToSource,s=[],n)s.push(a);return[2,this._getSourcesData(s,r,t)]}}))}))},e.prototype.parseTileData=function(e,t,r){return i.__awaiter(this,void 0,void 0,(function(){var s,a,o,h,l,u,c,d,_=this;return i.__generator(this,(function(g){switch(g.label){case 0:return(s=e&&e.data)?(a=s.sourceName2DataAndRefKey,o=s.transferList,0===Object.keys(a).length?[2,null]:[4,this._broadcastPromise]):[2,null];case 1:return g.sent(),h=Math.round(p.degToByte(t)),[4,this._connection.getAvailableClient()];case 2:return[4,(l=g.sent()).invoke("createTileAndParse",{key:e.key.id,rotation:h,cacheTile:this.allowUpdates,sourceName2DataAndRefKey:a},i.__assign(i.__assign({},r),{transferList:o})).catch((function(){return _._enableCachingWorkerTiles&&l.invoke("destructTileData",e.key.id).catch((function(){})),null}))];case 3:if(u=g.sent(),n("esri-vector-tiles-debug")){for(d in c={},a)c[d]=a[d].refKey;return[2,{tileData:u,client:l,refKeys:c}]}return[2,{tileData:u,client:l}]}}))}))},Object.defineProperty(e.prototype,"updating",{get:function(){return this._ongoingTileRequests.size>0},enumerable:!0,configurable:!0}),e.prototype.abortAll=function(){this._ongoingRequestToController.forEach((function(e){return e.abort()})),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()},e.prototype.getSprites=function(e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return[4,this._spriteSourcePromise];case 1:return t.sent(),[2,this._spriteMosaic.getSpriteItems(e)]}}))}))},e.prototype.getGlyphs=function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)},e.prototype.getStyleRepository=function(){return this._vectorTileLayer.styleRepository},e.prototype._getTilePayload=function(e,t,n){return i.__awaiter(this,void 0,void 0,(function(){var s,a,o,h;return i.__generator(this,(function(l){switch(l.label){case 0:return s=y.pool.acquire(e.id),a=this._vectorTileLayer.sourceNameToSource,o=a[t],h=o.getSourceTileUrl(s.level,s.row,s.col),y.pool.release(s),[4,r(h,i.__assign({responseType:"array-buffer"},n))];case 1:return[2,{protobuff:l.sent().data,sourceName:t}]}}))}))},e.prototype._fetchTileMap=function(e,t){if(e.capabilities.operations.supportsTileMap&&e.tileIndex)return h.resolve();if(!e.tileMapURL)return h.resolve();var i=v.get(e.tileMapURL);if(i)return e.tileIndex=i,h.resolve();if(m.has(e.tileMapURL))return m.get(e.tileMapURL).then((function(t){e.tileIndex=new f(t.data)}));var n=r(e.tileMapURL,t);return n.then((function(t){e.tileIndex=new f(t.data),m.delete(e.tileMapURL),v.put(e.tileMapURL,e.tileIndex)})),m.set(e.tileMapURL,n),n},e.prototype._getRefKeys=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,s,a,o;return i.__generator(this,(function(i){for(s in r=this._vectorTileLayer.sourceNameToSource,n=new Array,r)a=r[s],o=a.getRefKey(e,t),n.push(o);return[2,h.eachAlways(n)]}))}))},e.prototype._getSourcesData=function(e,t,r){return i.__awaiter(this,void 0,void 0,(function(){var n,s,a,o,l,u,c;return i.__generator(this,(function(i){switch(i.label){case 0:for(n=[],u=0;u<t.length;u++)null==t[u].value||null==e[u]?n.push(null):(s=this._getTilePayload(t[u].value,e[u],r),n.push(s));return[4,h.eachAlways(n)];case 1:for(a=i.sent(),o={},l=[],u=0;u<a.length;u++)a[u].value&&a[u].value&&a[u].value.protobuff&&a[u].value.protobuff.byteLength>0&&(c=t[u].value.id,o[a[u].value.sourceName]={refKey:c,protobuff:a[u].value.protobuff},l.push(a[u].value.protobuff));return[2,{sourceName2DataAndRefKey:o,transferList:l}]}}))}))},e.prototype._getVectorTileData=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r,n,s,a=this;return i.__generator(this,(function(i){return t=e.id,this._ongoingTileRequests.has(t)?[2,this._ongoingTileRequests.get(t)]:(r=new AbortController,n={signal:r.signal},s=this._getParsedVectorTileData(e,n).then((function(e){return a._ongoingTileRequests.delete(t),a._ongoingRequestToController.delete(t),e})).catch((function(){return a._ongoingTileRequests.delete(t),a._ongoingRequestToController.delete(t),null})),this._ongoingTileRequests.set(t,s),this._ongoingRequestToController.set(t,r),[2,s])}))}))},e.prototype._getParsedVectorTileData=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this.fetchTileData(e,t)];case 1:return r=i.sent(),[2,this.parseTileData({key:e,data:r},0,t)]}}))}))},e}();t.TileHandler=w}.apply(null,r))||(e.exports=n)},1669:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(25),i(4),i(125),i(1531),i(1424)],void 0===(n=function(e,t,i,r,n,s,a){var o;return function(){function e(e,t,r){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,!o&&i("stable-symbol-rendering")&&(o=new Set),this.width=e,this.height=t,this._glyphSource=r,this._binPack=new s(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(void 0)}return e.prototype.getGlyphItems=function(e,t){for(var n=this,h=[],l=this._glyphSource,u=new Set,c=0,p=t;c<p.length;c++){var d=p[c],_=Math.floor(d*(1/256));u.add(_)}var g=[];return u.forEach((function(t){if(t<=256){var i=e+t;if(n._rangePromises.has(i))g.push(n._rangePromises.get(i));else{var r=l.getRange(e,t).then((function(){n._rangePromises.delete(i)}),(function(){n._rangePromises.delete(i)}));n._rangePromises.set(i,r),g.push(r)}}})),r.all(g).then((function(){var r,c=n._glyphIndex[e];if(c||(c={},n._glyphIndex[e]=c),i("stable-symbol-rendering")){o.clear();for(var p=0,d=t;p<d.length;p++){var _=d[p];o.add(_)}var g=[];u.forEach((function(e){g.push(e)})),g.sort(),r=[];for(var f=0,y=g;f<y.length;f++)for(var v=y[f],m=0;m<256;++m)r.push(256*v+m)}else r=t;for(var w=0,b=r;w<b.length;w++){var T=c[_=b[w]];if(T)i("stable-symbol-rendering")&&!o.has(_)||(h[_]={sdf:!0,rect:T.rect,metrics:T.metrics,page:T.page,code:_});else{var x=l.getGlyph(e,_);if(x&&x.metrics){var S=x.metrics,R=void 0;if(0===S.width)R=new a.default(0,0,0,0);else{var C=S.width+6,P=S.height+6,M=C%4?4-C%4:4,L=P%4?4-P%4:4;1===M&&(M=5),1===L&&(L=5),(R=n._binPack.allocate(C+M,P+L)).isEmpty&&(n._dirties[n._currentPage]||(n._glyphData[n._currentPage]=null),n._currentPage=n._glyphData.length,n._glyphData.push(new Uint8Array(n.width*n.height)),n._dirties.push(!0),n._textures.push(void 0),n._binPack=new s(n.width-4,n.height-4),R=n._binPack.allocate(C+M,P+L));var k=n._glyphData[n._currentPage],I=x.bitmap,D=void 0,A=void 0;if(I)for(var z=0;z<P;z++){D=C*z,A=n.width*(R.y+z+1)+R.x;for(var U=0;U<C;U++)k[A+U+1]=I[D+U]}}c[_]={rect:R,metrics:S,tileIDs:null,page:n._currentPage},i("stable-symbol-rendering")&&!o.has(_)||(h[_]={sdf:!0,rect:R,metrics:S,page:n._currentPage,code:_}),n._dirties[n._currentPage]=!0}}}return h}))},e.prototype.removeGlyphs=function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var n in i)if((r=i[n]).tileIDs.delete(e),0===r.tileIDs.size){for(var s=this._glyphData[r.page],a=r.rect,o=void 0,h=void 0,l=0;l<a.height;l++)for(o=this.width*(a.y+l)+a.x,h=0;h<a.width;h++)s[o+h]=0;delete i[n],this._dirties[r.page]=!0}}}},e.prototype.bind=function(e,t,i,r){void 0===r&&(r=0),this._textures[i]||(this._textures[i]=new n.Texture(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var s=this._textures[i];s.setSamplingMode(t),this._dirties[i]&&s.setData(this._glyphData[i]),e.bindTexture(s,r),this._dirties[i]=!1},e.prototype.dispose=function(){this._binPack=null;for(var e=0,t=this._textures;e<t.length;e++){var i=t[e];i&&i.dispose()}this._textures.length=0},e}()}.apply(null,r))||(e.exports=n)},1670:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(33),i(25),i(715),i(4)],void 0===(n=function(e,t,i,r,n,s){var a=function(){function e(e){if(this._metrics=[],this._bitmaps=[],e)for(;e.next();)switch(e.tag()){case 1:for(var t=e.getMessage();t.next();)switch(t.tag()){case 3:for(var i=t.getMessage(),r=void 0,n=void 0,s=void 0,a=void 0,o=void 0,h=void 0,l=void 0;i.next();)switch(i.tag()){case 1:r=i.getUInt32();break;case 2:n=i.getBytes();break;case 3:s=i.getUInt32();break;case 4:a=i.getUInt32();break;case 5:o=i.getSInt32();break;case 6:h=i.getSInt32();break;case 7:l=i.getUInt32();break;default:i.skip()}i.release(),r&&(this._metrics[r]={width:s,height:a,left:o,top:h,advance:l},this._bitmaps[r]=n);break;default:t.skip()}t.release();break;default:e.skip()}}return e.prototype.getMetrics=function(e){return this._metrics[e]},e.prototype.getBitmap=function(e){return this._bitmaps[e]},e}(),o=function(){function e(){this._ranges=[]}return e.prototype.getRange=function(e){return this._ranges[e]},e.prototype.addRange=function(e,t){this._ranges[e]=t},e}();return function(){function e(e){this._glyphInfo={},this._baseURL=e}return e.prototype.getRange=function(e,t){var o=this._getFontStack(e);if(r("stable-symbol-rendering")&&t>0)return o.addRange(t,new a),s.resolve();if(o.getRange(t))return s.resolve();var h=256*t,l=h+255,u=this._baseURL.replace("{fontstack}",e).replace("{range}",h+"-"+l);return i(u,{responseType:"array-buffer"}).then((function(e){o.addRange(t,new a(new n(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){o.addRange(t,new a)}))},e.prototype.getGlyph=function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var n=i.getRange(r);if(n)return{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}}}},e.prototype._getFontStack=function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new o),t},e}()}.apply(null,r))||(e.exports=n)},1671:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(125),i(1531),i(1424)],void 0===(n=function(e,t,i,r,n){return function(){function e(e,t,i){void 0===i&&(i=0),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(e<=0||t<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,i>0&&(this._maxItemSize=i),this._binPack=new r(e-4,t-4)}return e.prototype.getWidth=function(e){return e>=this._size.length?-1:this._size[e][0]},e.prototype.getHeight=function(e){return e>=this._size.length?-1:this._size[e][1]},e.prototype.setSpriteSource=function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new r(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),n=new Uint32Array(t*i);this._mosaicsData[0]=n,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e},e.prototype.getSpriteItem=function(e,t){void 0===t&&(t=!1);var i=this._mosaicRects[e];if(i)return i;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;var r=this._sprites.getSpriteInfo(e);if(!r||!r.width||!r.height||r.width<0||r.height<0)return null;var n=r.width,s=r.height,a=this._allocateImage(n,s),o=a[0],h=a[1],l=a[2];return o.width<=0?null:(this._copy(o,r,h,l,t),i={rect:o,width:n,height:s,sdf:r.sdf,simplePattern:!1,pixelRatio:r.pixelRatio,page:h},this._mosaicRects[e]=i,i)},e.prototype.preloadSpriteItems=function(){for(var e=0,t=this._sprites.spriteNames;e<t.length;e++){var i=t[e];this.getSpriteItem(i,!0)}},e.prototype.getSpriteItems=function(e){for(var t={},i=0,r=e;i<r.length;i++){var n=r[i];t[n]=this.getSpriteItem(n)}return t},e.prototype.getMosaicItemPosition=function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;if(!r)return null;r.width=i.width,r.height=i.height;var n=i.width,s=i.height;return{size:[i.width,i.height],tl:[(r.x+2)/this._size[i.page][0],(r.y+2)/this._size[i.page][1]],br:[(r.x+2+n)/this._size[i.page][0],(r.y+2+s)/this._size[i.page][1]],page:i.page}},e.prototype.bind=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this._textures[r]||(this._textures[r]=new i.Texture(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[r][0],height:this._size[r][1]},new Uint8Array(this._mosaicsData[r].buffer)));var s=this._textures[r];s.setSamplingMode(t),this._dirties[r]&&s.setData(new Uint8Array(this._mosaicsData[r].buffer)),e.bindTexture(s,n),this._dirties[r]=!1},e._copyBits=function(e,t,i,r,n,s,a,o,h,l,u){var c=r*t+i,p=o*s+a;if(u){p-=s;for(var d=-1;d<=l;c=((++d+l)%l+r)*t+i,p+=s)for(var _=-1;_<=h;_++)n[p+_]=e[c+(_+h)%h]}else for(d=0;d<l;d++){for(_=0;_<h;_++)n[p+_]=e[c+_];c+=t,p+=s}},e.prototype._copy=function(t,i,r,n,s,a){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var o=new Uint32Array(a?a.buffer:this._sprites.image.buffer),h=this._mosaicsData[r];h&&o||console.error("Source or target images are uninitialized!");var l=a?i.width:this._sprites.width;e._copyBits(o,l,i.x,i.y,h,n[0],t.x+2,t.y+2,i.width,i.height,s),this._dirties[r]=!0}},e.prototype._allocateImage=function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var s=new n.default(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[s,this._mosaicsData.length-1,[e,t]]}var a=e%4?4-e%4:4,o=t%4?4-t%4:4;1===a&&(a=5),1===o&&(o=5);var h=this._binPack.allocate(e+a,t+o);return h.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new r(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[h,this._currentPage,[this._pageWidth,this._pageHeight]]},e.prototype.dispose=function(){this._binPack=null,this._mosaicRects={};for(var e=0,t=this._textures;e<t.length;e++){var i=t[e];i&&i.dispose()}this._textures.length=0},e}()}.apply(null,r))||(e.exports=n)},1672:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.FadeProperties=function(e,t,i,r){this.fadeSpeed=e,this.minfadeLevel=t,this.maxfadeLevel=i,this.fadeChange=r};var i=function(){function e(e,t){void 0===e&&(e=300),void 0===t&&(t=!1),this._levelSnapshots=[],this._duration=e,this._ignoreSpeed=t}return e.prototype.recordLevel=function(e){var t=performance.now(),i=this._levelSnapshots;0===i.length&&(i.push({level:e,now:0}),i.push({level:e,now:0})),2!==i.length&&i[0].level===e||i.push({level:e,now:t})},e.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var e=this._duration,t=this._levelSnapshots,i=t.length,r=t[i-1],n=-1;i>n+1&&t[n+1].now+e<r.now;)n++;for(n<0&&(n=0);n<i;n++)if(t[n].level!==r.level)return!0;return!1},e.prototype.getFadeValues=function(){for(var e=this._duration,t=performance.now(),i=this._levelSnapshots;i.length>3&&i[1].now+e<t;)i.shift();i[1].now+e<t&&(i[0].level=i[1].level);var r=i[0].level,n=i[i.length-1],s=n.level,a=Math.min(r,s),o=Math.max(r,s),h=(n.level-i[1].level)/((n.now-i[1].now)/e),l=(t-n.now)/e*h;return this._ignoreSpeed?{fadeSpeed:0,minfadeLevel:a,maxfadeLevel:o,fadeChange:0}:{fadeSpeed:h,minfadeLevel:a,maxfadeLevel:o,fadeChange:l}},e}();t.FadeRecorder=i}.apply(null,r))||(e.exports=n)},2011:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(675),i(1672),i(1724)],void 0===(n=function(e,t,i,r,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.spriteMosaic=e,this.glyphMosaic=t,this._brushCache=new Map,this.fadeRecorder=new r.FadeRecorder(300,!0),this.brushNameToCtor={vtlBackground:i.brushes.VTLBackground,vtlFill:i.brushes.VTLFill,vtlLine:i.brushes.VTLLine,vtlCircle:i.brushes.VTLCircle,vtlSymbol:i.brushes.VTLSymbol}}return e.prototype.dispose=function(){this._brushCache&&(this._brushCache.forEach((function(e){return e.dispose()})),this._brushCache=null),this._programCache&&(this._programCache.dispose(),this._programCache=null)},e.prototype.setContext=function(e){this._programCache||(this._programCache=new n.default(e))},e.prototype.drawTile=function(e,t,i){var r=this,n=e.context,s=e.fadeRecorder,a=i.layers;i.backgroundBucketIds.length>0&&(e.renderPass="background",i.backgroundBucketIds.forEach((function(n){return r._renderStyleLayer(n,e,t,i,!0)}))),s.recordLevel(e.displayLevel),t.commitChanges(),n.setBlendingEnabled(!1),n.setDepthTestEnabled(!0),n.setDepthWriteEnabled(!0),n.setDepthFunction(515),e.renderPass="opaque";for(var o=a.length-1;o>=0;o--)this._renderStyleLayer(o,e,t,i,!1);for(n.setDepthWriteEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent",o=0;o<a.length;o++)this._renderStyleLayer(o,e,t,i,!1);for(n.setDepthTestEnabled(!1),e.renderPass="symbol",o=0;o<a.length;o++)this._renderStyleLayer(o,e,t,i,!1);n.bindVAO()},e.prototype._renderStyleLayer=function(e,t,i,r,n){if(void 0===n&&(n=!1),n||i.layerData[e]){var s=t.renderPass,a=r.layers[e];if(void 0!==a){var o;switch(a.type){case 0:if("background"!==s)return;o="vtlBackground";break;case 1:if("opaque"!==s&&"translucent"!==t.renderPass)return;o="vtlFill";break;case 2:if("translucent"!==s)return;o="vtlLine";break;case 4:if("symbol"!==s)return;o="vtlCircle";break;case 3:if("symbol"!==s)return;o="vtlSymbol"}var h=t.displayLevel;void 0!==a.minzoom&&a.minzoom>h+1e-6||void 0!==a.maxzoom&&a.maxzoom<=h-1e-6||(t.styleLayerId=e,t.styleLayer=a,this.drawWithBrush(t,i,o))}}},e.prototype.drawWithBrush=function(e,t,i){if(!this._brushCache.has(i)){var r=this.brushNameToCtor[i];this._brushCache.set(i,new r)}this._brushCache.get(i).drawMany(e,[t])},e.prototype.getVectorTileProgramCach=function(){return this._programCache},e}();t.default=s}.apply(null,r))||(e.exports=n)}}]);